"use strict";(self.webpackChunkpockedeck_battler=self.webpackChunkpockedeck_battler||[]).push([[807],{807:(G,I,m)=>{m.r(I),m.d(I,{CombatModule:()=>Io});var g=m(6814),E=m(6223),k=m(2827),q=m(7388),w=m(1076),Tt=m(7582),J=m(8645),kt=m(7394),O=m(7715),e=(m(6232),m(9468)),Et=(m(1631),m(9773));const Pt=e.GuJ,Zt=Symbol("__destroy"),tt=Symbol("__decoratorApplied");function et(i){return"string"==typeof i?Symbol(`__destroy__${i}`):Zt}function nt(i,n){i[n]||(i[n]=new J.x)}function ot(i,n){i[n]&&(i[n].next(),i[n].complete(),i[n]=null)}function it(i){i instanceof kt.w0&&i.unsubscribe()}function rt(i,n){return function(){if(i&&i.call(this),ot(this,et()),n.arrayName&&function Nt(i){Array.isArray(i)&&i.forEach(it)}(this[n.arrayName]),n.checkProperties)for(const t in this)n.blackList?.includes(t)||it(this[t])}}Symbol("CheckerHasBeenSet");function L(i,n){return t=>{const o=et(n);"string"==typeof n?function Ft(i,n,t){const o=i[n];nt(i,t),i[n]=function(){o.apply(this,arguments),ot(this,t),i[n]=o}}(i,n,o):nt(i,o);const r=i[o];return t.pipe((0,Et.R)(r))}}var Ht=m(4352),Lt=m(9360),jt=m(8251),A=m(4664),$=m(2096),zt=m(8504),M=m(6306),P=m(7398),h=m(3107);const Wt=[0,2e3,1e4,3e4,null];class lt{constructor(n){this._retryDelays=void 0!==n?[...n,null]:Wt}nextRetryDelayInMilliseconds(n){return this._retryDelays[n.previousRetryCount]}}var v=m(5861);let U=(()=>{class i{}return i.Authorization="Authorization",i.Cookie="Cookie",i})();class ht{constructor(n,t,o){this.statusCode=n,this.statusText=t,this.content=o}}class F{get(n,t){return this.send({...t,method:"GET",url:n})}post(n,t){return this.send({...t,method:"POST",url:n})}delete(n,t){return this.send({...t,method:"DELETE",url:n})}getCookieString(n){return""}}class Bt extends F{constructor(n,t){super(),this._innerClient=n,this._accessTokenFactory=t}send(n){var t=this;return(0,v.Z)(function*(){let o=!0;t._accessTokenFactory&&(!t._accessToken||n.url&&n.url.indexOf("/negotiate?")>0)&&(o=!1,t._accessToken=yield t._accessTokenFactory()),t._setAuthorizationHeader(n);const r=yield t._innerClient.send(n);return o&&401===r.statusCode&&t._accessTokenFactory?(t._accessToken=yield t._accessTokenFactory(),t._setAuthorizationHeader(n),yield t._innerClient.send(n)):r})()}_setAuthorizationHeader(n){n.headers||(n.headers={}),this._accessToken?n.headers[U.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&n.headers[U.Authorization]&&delete n.headers[U.Authorization]}getCookieString(n){return this._innerClient.getCookieString(n)}}class Z extends Error{constructor(n,t){const o=new.target.prototype;super(`${n}: Status code '${t}'`),this.statusCode=t,this.__proto__=o}}class j extends Error{constructor(n="A timeout occurred."){const t=new.target.prototype;super(n),this.__proto__=t}}class T extends Error{constructor(n="An abort occurred."){const t=new.target.prototype;super(n),this.__proto__=t}}class Kt extends Error{constructor(n,t){const o=new.target.prototype;super(n),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=o}}class Vt extends Error{constructor(n,t){const o=new.target.prototype;super(n),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=o}}class Gt extends Error{constructor(n,t){const o=new.target.prototype;super(n),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=o}}class qt extends Error{constructor(n){const t=new.target.prototype;super(n),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class Xt extends Error{constructor(n,t){const o=new.target.prototype;super(n),this.innerErrors=t,this.__proto__=o}}var a=m(4351),u=m(8974);class te extends F{constructor(n){if(super(),this._logger=n,typeof fetch>"u"){const t=require;this._jar=new(t("tough-cookie").CookieJar),this._fetchType=t("node-fetch"),this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind((0,u.E9)());if(typeof AbortController>"u"){const t=require;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}send(n){var t=this;return(0,v.Z)(function*(){if(n.abortSignal&&n.abortSignal.aborted)throw new T;if(!n.method)throw new Error("No method defined.");if(!n.url)throw new Error("No url defined.");const o=new t._abortControllerType;let r;n.abortSignal&&(n.abortSignal.onabort=()=>{o.abort(),r=new T});let c,s=null;n.timeout&&(s=setTimeout(()=>{o.abort(),t._logger.log(a.i.Warning,"Timeout from HTTP request."),r=new j},n.timeout)),""===n.content&&(n.content=void 0),n.content&&(n.headers=n.headers||{},n.headers["Content-Type"]=(0,u.eP)(n.content)?"application/octet-stream":"text/plain;charset=UTF-8");try{c=yield t._fetchType(n.url,{body:n.content,cache:"no-cache",credentials:!0===n.withCredentials?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...n.headers},method:n.method,mode:"cors",redirect:"follow",signal:o.signal})}catch(d){throw r||(t._logger.log(a.i.Warning,`Error from HTTP request. ${d}.`),d)}finally{s&&clearTimeout(s),n.abortSignal&&(n.abortSignal.onabort=null)}if(!c.ok){const d=yield pt(c,"text");throw new Z(d||c.statusText,c.status)}const p=yield pt(c,n.responseType);return new ht(c.status,c.statusText,p)})()}getCookieString(n){let t="";return u.t4.isNode&&this._jar&&this._jar.getCookies(n,(o,r)=>t=r.join("; ")),t}}function pt(i,n){let t;switch(n){case"arraybuffer":t=i.arrayBuffer();break;case"text":default:t=i.text();break;case"blob":case"document":case"json":throw new Error(`${n} is not supported.`)}return t}class ee extends F{constructor(n){super(),this._logger=n}send(n){return n.abortSignal&&n.abortSignal.aborted?Promise.reject(new T):n.method?n.url?new Promise((t,o)=>{const r=new XMLHttpRequest;r.open(n.method,n.url,!0),r.withCredentials=void 0===n.withCredentials||n.withCredentials,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),""===n.content&&(n.content=void 0),n.content&&((0,u.eP)(n.content)?r.setRequestHeader("Content-Type","application/octet-stream"):r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const s=n.headers;s&&Object.keys(s).forEach(c=>{r.setRequestHeader(c,s[c])}),n.responseType&&(r.responseType=n.responseType),n.abortSignal&&(n.abortSignal.onabort=()=>{r.abort(),o(new T)}),n.timeout&&(r.timeout=n.timeout),r.onload=()=>{n.abortSignal&&(n.abortSignal.onabort=null),r.status>=200&&r.status<300?t(new ht(r.status,r.statusText,r.response||r.responseText)):o(new Z(r.response||r.responseText||r.statusText,r.status))},r.onerror=()=>{this._logger.log(a.i.Warning,`Error from HTTP request. ${r.status}: ${r.statusText}.`),o(new Z(r.statusText,r.status))},r.ontimeout=()=>{this._logger.log(a.i.Warning,"Timeout from HTTP request."),o(new j)},r.send(n.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class ne extends F{constructor(n){if(super(),typeof fetch<"u"||u.t4.isNode)this._httpClient=new te(n);else{if(!(typeof XMLHttpRequest<"u"))throw new Error("No usable HttpClient found.");this._httpClient=new ee(n)}}send(n){return n.abortSignal&&n.abortSignal.aborted?Promise.reject(new T):n.method?n.url?this._httpClient.send(n):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(n){return this._httpClient.getCookieString(n)}}var y=function(i){return i[i.None=0]="None",i[i.WebSockets=1]="WebSockets",i[i.ServerSentEvents=2]="ServerSentEvents",i[i.LongPolling=4]="LongPolling",i}(y||{}),S=function(i){return i[i.Text=1]="Text",i[i.Binary=2]="Binary",i}(S||{});class oe{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class dt{constructor(n,t,o){this._httpClient=n,this._logger=t,this._pollAbort=new oe,this._options=o,this._running=!1,this.onreceive=null,this.onclose=null}get pollAborted(){return this._pollAbort.aborted}connect(n,t){var o=this;return(0,v.Z)(function*(){if(u.j7.isRequired(n,"url"),u.j7.isRequired(t,"transferFormat"),u.j7.isIn(t,S,"transferFormat"),o._url=n,o._logger.log(a.i.Trace,"(LongPolling transport) Connecting."),t===S.Binary&&typeof XMLHttpRequest<"u"&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[r,s]=(0,u.hS)(),c={[r]:s,...o._options.headers},l={abortSignal:o._pollAbort.signal,headers:c,timeout:1e5,withCredentials:o._options.withCredentials};t===S.Binary&&(l.responseType="arraybuffer");const p=`${n}&_=${Date.now()}`;o._logger.log(a.i.Trace,`(LongPolling transport) polling: ${p}.`);const d=yield o._httpClient.get(p,l);200!==d.statusCode?(o._logger.log(a.i.Error,`(LongPolling transport) Unexpected response code: ${d.statusCode}.`),o._closeError=new Z(d.statusText||"",d.statusCode),o._running=!1):o._running=!0,o._receiving=o._poll(o._url,l)})()}_poll(n,t){var o=this;return(0,v.Z)(function*(){try{for(;o._running;)try{const r=`${n}&_=${Date.now()}`;o._logger.log(a.i.Trace,`(LongPolling transport) polling: ${r}.`);const s=yield o._httpClient.get(r,t);204===s.statusCode?(o._logger.log(a.i.Information,"(LongPolling transport) Poll terminated by server."),o._running=!1):200!==s.statusCode?(o._logger.log(a.i.Error,`(LongPolling transport) Unexpected response code: ${s.statusCode}.`),o._closeError=new Z(s.statusText||"",s.statusCode),o._running=!1):s.content?(o._logger.log(a.i.Trace,`(LongPolling transport) data received. ${(0,u.o4)(s.content,o._options.logMessageContent)}.`),o.onreceive&&o.onreceive(s.content)):o._logger.log(a.i.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(r){o._running?r instanceof j?o._logger.log(a.i.Trace,"(LongPolling transport) Poll timed out, reissuing."):(o._closeError=r,o._running=!1):o._logger.log(a.i.Trace,`(LongPolling transport) Poll errored after shutdown: ${r.message}`)}}finally{o._logger.log(a.i.Trace,"(LongPolling transport) Polling complete."),o.pollAborted||o._raiseOnClose()}})()}send(n){var t=this;return(0,v.Z)(function*(){return t._running?(0,u.bG)(t._logger,"LongPolling",t._httpClient,t._url,n,t._options):Promise.reject(new Error("Cannot send until the transport is connected"))})()}stop(){var n=this;return(0,v.Z)(function*(){n._logger.log(a.i.Trace,"(LongPolling transport) Stopping polling."),n._running=!1,n._pollAbort.abort();try{yield n._receiving,n._logger.log(a.i.Trace,`(LongPolling transport) sending DELETE request to ${n._url}.`);const t={},[o,r]=(0,u.hS)();t[o]=r;const s={headers:{...t,...n._options.headers},timeout:n._options.timeout,withCredentials:n._options.withCredentials};yield n._httpClient.delete(n._url,s),n._logger.log(a.i.Trace,"(LongPolling transport) DELETE request sent.")}finally{n._logger.log(a.i.Trace,"(LongPolling transport) Stop finished."),n._raiseOnClose()}})()}_raiseOnClose(){if(this.onclose){let n="(LongPolling transport) Firing onclose event.";this._closeError&&(n+=" Error: "+this._closeError),this._logger.log(a.i.Trace,n),this.onclose(this._closeError)}}}class ie{constructor(n,t,o,r){this._httpClient=n,this._accessToken=t,this._logger=o,this._options=r,this.onreceive=null,this.onclose=null}connect(n,t){var o=this;return(0,v.Z)(function*(){return u.j7.isRequired(n,"url"),u.j7.isRequired(t,"transferFormat"),u.j7.isIn(t,S,"transferFormat"),o._logger.log(a.i.Trace,"(SSE transport) Connecting."),o._url=n,o._accessToken&&(n+=(n.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(o._accessToken)}`),new Promise((r,s)=>{let l,c=!1;if(t===S.Text){if(u.t4.isBrowser||u.t4.isWebWorker)l=new o._options.EventSource(n,{withCredentials:o._options.withCredentials});else{const p=o._httpClient.getCookieString(n),d={};d.Cookie=p;const[f,_]=(0,u.hS)();d[f]=_,l=new o._options.EventSource(n,{withCredentials:o._options.withCredentials,headers:{...d,...o._options.headers}})}try{l.onmessage=p=>{if(o.onreceive)try{o._logger.log(a.i.Trace,`(SSE transport) data received. ${(0,u.o4)(p.data,o._options.logMessageContent)}.`),o.onreceive(p.data)}catch(d){return void o._close(d)}},l.onerror=p=>{c?o._close():s(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},l.onopen=()=>{o._logger.log(a.i.Information,`SSE connected to ${o._url}`),o._eventSource=l,c=!0,r()}}catch(p){return void s(p)}}else s(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})})()}send(n){var t=this;return(0,v.Z)(function*(){return t._eventSource?(0,u.bG)(t._logger,"SSE",t._httpClient,t._url,n,t._options):Promise.reject(new Error("Cannot send until the transport is connected"))})()}stop(){return this._close(),Promise.resolve()}_close(n){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(n))}}class re{constructor(n,t,o,r,s,c){this._logger=o,this._accessTokenFactory=t,this._logMessageContent=r,this._webSocketConstructor=s,this._httpClient=n,this.onreceive=null,this.onclose=null,this._headers=c}connect(n,t){var o=this;return(0,v.Z)(function*(){let r;return u.j7.isRequired(n,"url"),u.j7.isRequired(t,"transferFormat"),u.j7.isIn(t,S,"transferFormat"),o._logger.log(a.i.Trace,"(WebSockets transport) Connecting."),o._accessTokenFactory&&(r=yield o._accessTokenFactory()),new Promise((s,c)=>{let l;n=n.replace(/^http/,"ws");const p=o._httpClient.getCookieString(n);let d=!1;if(u.t4.isNode||u.t4.isReactNative){const f={},[_,N]=(0,u.hS)();f[_]=N,r&&(f[U.Authorization]=`Bearer ${r}`),p&&(f[U.Cookie]=p),l=new o._webSocketConstructor(n,void 0,{headers:{...f,...o._headers}})}else r&&(n+=(n.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`);l||(l=new o._webSocketConstructor(n)),t===S.Binary&&(l.binaryType="arraybuffer"),l.onopen=f=>{o._logger.log(a.i.Information,`WebSocket connected to ${n}.`),o._webSocket=l,d=!0,s()},l.onerror=f=>{let _=null;_=typeof ErrorEvent<"u"&&f instanceof ErrorEvent?f.error:"There was an error with the transport",o._logger.log(a.i.Information,`(WebSockets transport) ${_}.`)},l.onmessage=f=>{if(o._logger.log(a.i.Trace,`(WebSockets transport) data received. ${(0,u.o4)(f.data,o._logMessageContent)}.`),o.onreceive)try{o.onreceive(f.data)}catch(_){return void o._close(_)}},l.onclose=f=>{if(d)o._close(f);else{let _=null;_=typeof ErrorEvent<"u"&&f instanceof ErrorEvent?f.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",c(new Error(_))}}})})()}send(n){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(a.i.Trace,`(WebSockets transport) sending data. ${(0,u.o4)(n,this._logMessageContent)}.`),this._webSocket.send(n),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(n){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(a.i.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(n)||!1!==n.wasClean&&1e3===n.code?n instanceof Error?this.onclose(n):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${n.code} (${n.reason||"no reason given"}).`)))}_isCloseEvent(n){return n&&"boolean"==typeof n.wasClean&&"number"==typeof n.code}}class se{constructor(n,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,u.j7.isRequired(n,"url"),this._logger=(0,u.hu)(t.logger),this.baseUrl=this._resolveUrl(n),(t=t||{}).logMessageContent=void 0!==t.logMessageContent&&t.logMessageContent,"boolean"!=typeof t.withCredentials&&void 0!==t.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.withCredentials=void 0===t.withCredentials||t.withCredentials,t.timeout=void 0===t.timeout?1e5:t.timeout;let o=null,r=null;if(u.t4.isNode){const s=require;o=s("ws"),r=s("eventsource")}!u.t4.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:u.t4.isNode&&!t.WebSocket&&o&&(t.WebSocket=o),!u.t4.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:u.t4.isNode&&!t.EventSource&&typeof r<"u"&&(t.EventSource=r),this._httpClient=new Bt(t.httpClient||new ne(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}start(n){var t=this;return(0,v.Z)(function*(){if(u.j7.isIn(n=n||S.Binary,S,"transferFormat"),t._logger.log(a.i.Debug,`Starting connection with transfer format '${S[n]}'.`),"Disconnected"!==t._connectionState)return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(t._connectionState="Connecting",t._startInternalPromise=t._startInternal(n),yield t._startInternalPromise,"Disconnecting"===t._connectionState){const o="Failed to start the HttpConnection before stop() was called.";return t._logger.log(a.i.Error,o),yield t._stopPromise,Promise.reject(new T(o))}if("Connected"!==t._connectionState){const o="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return t._logger.log(a.i.Error,o),Promise.reject(new T(o))}t._connectionStarted=!0})()}send(n){return"Connected"!==this._connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Y(this.transport)),this._sendQueue.send(n))}stop(n){var t=this;return(0,v.Z)(function*(){return"Disconnected"===t._connectionState?(t._logger.log(a.i.Debug,`Call to HttpConnection.stop(${n}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):"Disconnecting"===t._connectionState?(t._logger.log(a.i.Debug,`Call to HttpConnection.stop(${n}) ignored because the connection is already in the disconnecting state.`),t._stopPromise):(t._connectionState="Disconnecting",t._stopPromise=new Promise(o=>{t._stopPromiseResolver=o}),yield t._stopInternal(n),void(yield t._stopPromise))})()}_stopInternal(n){var t=this;return(0,v.Z)(function*(){t._stopError=n;try{yield t._startInternalPromise}catch{}if(t.transport){try{yield t.transport.stop()}catch(o){t._logger.log(a.i.Error,`HttpConnection.transport.stop() threw error '${o}'.`),t._stopConnection()}t.transport=void 0}else t._logger.log(a.i.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")})()}_startInternal(n){var t=this;return(0,v.Z)(function*(){let o=t.baseUrl;t._accessTokenFactory=t._options.accessTokenFactory,t._httpClient._accessTokenFactory=t._accessTokenFactory;try{if(t._options.skipNegotiation){if(t._options.transport!==y.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");t.transport=t._constructTransport(y.WebSockets),yield t._startTransport(o,n)}else{let r=null,s=0;do{if(r=yield t._getNegotiationResponse(o),"Disconnecting"===t._connectionState||"Disconnected"===t._connectionState)throw new T("The connection was stopped during negotiation.");if(r.error)throw new Error(r.error);if(r.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(r.url&&(o=r.url),r.accessToken){const c=r.accessToken;t._accessTokenFactory=()=>c,t._httpClient._accessToken=c,t._httpClient._accessTokenFactory=void 0}s++}while(r.url&&s<100);if(100===s&&r.url)throw new Error("Negotiate redirection limit exceeded.");yield t._createTransport(o,t._options.transport,r,n)}t.transport instanceof dt&&(t.features.inherentKeepAlive=!0),"Connecting"===t._connectionState&&(t._logger.log(a.i.Debug,"The HttpConnection connected successfully."),t._connectionState="Connected")}catch(r){return t._logger.log(a.i.Error,"Failed to start the connection: "+r),t._connectionState="Disconnected",t.transport=void 0,t._stopPromiseResolver(),Promise.reject(r)}})()}_getNegotiationResponse(n){var t=this;return(0,v.Z)(function*(){const o={},[r,s]=(0,u.hS)();o[r]=s;const c=t._resolveNegotiateUrl(n);t._logger.log(a.i.Debug,`Sending negotiation request: ${c}.`);try{const l=yield t._httpClient.post(c,{content:"",headers:{...o,...t._options.headers},timeout:t._options.timeout,withCredentials:t._options.withCredentials});if(200!==l.statusCode)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${l.statusCode}'`));const p=JSON.parse(l.content);return(!p.negotiateVersion||p.negotiateVersion<1)&&(p.connectionToken=p.connectionId),p}catch(l){let p="Failed to complete negotiation with the server: "+l;return l instanceof Z&&404===l.statusCode&&(p+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),t._logger.log(a.i.Error,p),Promise.reject(new qt(p))}})()}_createConnectUrl(n,t){return t?n+(-1===n.indexOf("?")?"?":"&")+`id=${t}`:n}_createTransport(n,t,o,r){var s=this;return(0,v.Z)(function*(){let c=s._createConnectUrl(n,o.connectionToken);if(s._isITransport(t))return s._logger.log(a.i.Debug,"Connection was provided an instance of ITransport, using that directly."),s.transport=t,yield s._startTransport(c,r),void(s.connectionId=o.connectionId);const l=[],p=o.availableTransports||[];let d=o;for(const f of p){const _=s._resolveTransportOrError(f,t,r);if(_ instanceof Error)l.push(`${f.transport} failed:`),l.push(_);else if(s._isITransport(_)){if(s.transport=_,!d){try{d=yield s._getNegotiationResponse(n)}catch(N){return Promise.reject(N)}c=s._createConnectUrl(n,d.connectionToken)}try{return yield s._startTransport(c,r),void(s.connectionId=d.connectionId)}catch(N){if(s._logger.log(a.i.Error,`Failed to start the transport '${f.transport}': ${N}`),d=void 0,l.push(new Gt(`${f.transport} failed: ${N}`,y[f.transport])),"Connecting"!==s._connectionState){const xt="Failed to select transport before stop() was called.";return s._logger.log(a.i.Debug,xt),Promise.reject(new T(xt))}}}}return Promise.reject(l.length>0?new Xt(`Unable to connect to the server with any of the available transports. ${l.join(" ")}`,l):new Error("None of the transports supported by the client are supported by the server."))})()}_constructTransport(n){switch(n){case y.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new re(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case y.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new ie(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case y.LongPolling:return new dt(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${n}.`)}}_startTransport(n,t){return this.transport.onreceive=this.onreceive,this.transport.onclose=o=>this._stopConnection(o),this.transport.connect(n,t)}_resolveTransportOrError(n,t,o){const r=y[n.transport];if(null==r)return this._logger.log(a.i.Debug,`Skipping transport '${n.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${n.transport}' because it is not supported by this client.`);if(!function ae(i,n){return!i||0!=(n&i)}(t,r))return this._logger.log(a.i.Debug,`Skipping transport '${y[r]}' because it was disabled by the client.`),new Vt(`'${y[r]}' is disabled by the client.`,r);if(!(n.transferFormats.map(c=>S[c]).indexOf(o)>=0))return this._logger.log(a.i.Debug,`Skipping transport '${y[r]}' because it does not support the requested transfer format '${S[o]}'.`),new Error(`'${y[r]}' does not support ${S[o]}.`);if(r===y.WebSockets&&!this._options.WebSocket||r===y.ServerSentEvents&&!this._options.EventSource)return this._logger.log(a.i.Debug,`Skipping transport '${y[r]}' because it is not supported in your environment.'`),new Kt(`'${y[r]}' is not supported in your environment.`,r);this._logger.log(a.i.Debug,`Selecting transport '${y[r]}'.`);try{return this._constructTransport(r)}catch(c){return c}}_isITransport(n){return n&&"object"==typeof n&&"connect"in n}_stopConnection(n){if(this._logger.log(a.i.Debug,`HttpConnection.stopConnection(${n}) called while in state ${this._connectionState}.`),this.transport=void 0,n=this._stopError||n,this._stopError=void 0,"Disconnected"!==this._connectionState){if("Connecting"===this._connectionState)throw this._logger.log(a.i.Warning,`Call to HttpConnection.stopConnection(${n}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${n}) was called while the connection is still in the connecting state.`);if("Disconnecting"===this._connectionState&&this._stopPromiseResolver(),n?this._logger.log(a.i.Error,`Connection disconnected with error '${n}'.`):this._logger.log(a.i.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(a.i.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(n)}catch(t){this._logger.log(a.i.Error,`HttpConnection.onclose(${n}) threw error '${t}'.`)}}}else this._logger.log(a.i.Debug,`Call to HttpConnection.stopConnection(${n}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(n){if(0===n.lastIndexOf("https://",0)||0===n.lastIndexOf("http://",0))return n;if(!u.t4.isBrowser)throw new Error(`Cannot resolve '${n}'.`);const t=window.document.createElement("a");return t.href=n,this._logger.log(a.i.Information,`Normalizing '${n}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(n){const t=n.indexOf("?");let o=n.substring(0,-1===t?n.length:t);return"/"!==o[o.length-1]&&(o+="/"),o+="negotiate",o+=-1===t?"":n.substring(t),-1===o.indexOf("negotiateVersion")&&(o+=-1===t?"?":"&",o+="negotiateVersion="+this._negotiateVersion),o}}class Y{constructor(n){this._transport=n,this._buffer=[],this._executing=!0,this._sendBufferedData=new Q,this._transportResult=new Q,this._sendLoopPromise=this._sendLoop()}send(n){return this._bufferData(n),this._transportResult||(this._transportResult=new Q),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(n){if(this._buffer.length&&typeof this._buffer[0]!=typeof n)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof n}`);this._buffer.push(n),this._sendBufferedData.resolve()}_sendLoop(){var n=this;return(0,v.Z)(function*(){for(;;){if(yield n._sendBufferedData.promise,!n._executing){n._transportResult&&n._transportResult.reject("Connection stopped.");break}n._sendBufferedData=new Q;const t=n._transportResult;n._transportResult=void 0;const o="string"==typeof n._buffer[0]?n._buffer.join(""):Y._concatBuffers(n._buffer);n._buffer.length=0;try{yield n._transport.send(o),t.resolve()}catch(r){t.reject(r)}}})()}static _concatBuffers(n){const t=n.map(s=>s.byteLength).reduce((s,c)=>s+c),o=new Uint8Array(t);let r=0;for(const s of n)o.set(new Uint8Array(s),r),r+=s.byteLength;return o.buffer}}class Q{constructor(){this.promise=new Promise((n,t)=>[this._resolver,this._rejecter]=[n,t])}resolve(){this._resolver()}reject(n){this._rejecter(n)}}class x{static write(n){return`${n}${x.RecordSeparator}`}static parse(n){if(n[n.length-1]!==x.RecordSeparator)throw new Error("Message is incomplete.");const t=n.split(x.RecordSeparator);return t.pop(),t}}x.RecordSeparatorCode=30,x.RecordSeparator=String.fromCharCode(x.RecordSeparatorCode);class ce{writeHandshakeRequest(n){return x.write(JSON.stringify(n))}parseHandshakeResponse(n){let t,o;if((0,u.eP)(n)){const l=new Uint8Array(n),p=l.indexOf(x.RecordSeparatorCode);if(-1===p)throw new Error("Message is incomplete.");const d=p+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(l.slice(0,d))),o=l.byteLength>d?l.slice(d).buffer:null}else{const l=n,p=l.indexOf(x.RecordSeparator);if(-1===p)throw new Error("Message is incomplete.");const d=p+1;t=l.substring(0,d),o=l.length>d?l.substring(d):null}const r=x.parse(t),s=JSON.parse(r[0]);if(s.type)throw new Error("Expected a handshake response from the server.");return[o,s]}}var b=function(i){return i[i.Invocation=1]="Invocation",i[i.StreamItem=2]="StreamItem",i[i.Completion=3]="Completion",i[i.StreamInvocation=4]="StreamInvocation",i[i.CancelInvocation=5]="CancelInvocation",i[i.Ping=6]="Ping",i[i.Close=7]="Close",i}(b||{});class le{constructor(){this.observers=[]}next(n){for(const t of this.observers)t.next(n)}error(n){for(const t of this.observers)t.error&&t.error(n)}complete(){for(const n of this.observers)n.complete&&n.complete()}subscribe(n){return this.observers.push(n),new u.WQ(this,n)}}var C=function(i){return i.Disconnected="Disconnected",i.Connecting="Connecting",i.Connected="Connected",i.Disconnecting="Disconnecting",i.Reconnecting="Reconnecting",i}(C||{});class z{constructor(n,t,o,r){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(a.i.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},u.j7.isRequired(n,"connection"),u.j7.isRequired(t,"logger"),u.j7.isRequired(o,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this._logger=t,this._protocol=o,this.connection=n,this._reconnectPolicy=r,this._handshakeProtocol=new ce,this.connection.onreceive=s=>this._processIncomingData(s),this.connection.onclose=s=>this._connectionClosed(s),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=C.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:b.Ping})}static create(n,t,o,r){return new z(n,t,o,r)}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(n){if(this._connectionState!==C.Disconnected&&this._connectionState!==C.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!n)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=n}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}_startWithStateTransitions(){var n=this;return(0,v.Z)(function*(){if(n._connectionState!==C.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));n._connectionState=C.Connecting,n._logger.log(a.i.Debug,"Starting HubConnection.");try{yield n._startInternal(),u.t4.isBrowser&&window.document.addEventListener("freeze",n._freezeEventListener),n._connectionState=C.Connected,n._connectionStarted=!0,n._logger.log(a.i.Debug,"HubConnection connected successfully.")}catch(t){return n._connectionState=C.Disconnected,n._logger.log(a.i.Debug,`HubConnection failed to start successfully because of error '${t}'.`),Promise.reject(t)}})()}_startInternal(){var n=this;return(0,v.Z)(function*(){n._stopDuringStartError=void 0,n._receivedHandshakeResponse=!1;const t=new Promise((o,r)=>{n._handshakeResolver=o,n._handshakeRejecter=r});yield n.connection.start(n._protocol.transferFormat);try{const o={protocol:n._protocol.name,version:n._protocol.version};if(n._logger.log(a.i.Debug,"Sending handshake request."),yield n._sendMessage(n._handshakeProtocol.writeHandshakeRequest(o)),n._logger.log(a.i.Information,`Using HubProtocol '${n._protocol.name}'.`),n._cleanupTimeout(),n._resetTimeoutPeriod(),n._resetKeepAliveInterval(),yield t,n._stopDuringStartError)throw n._stopDuringStartError;n.connection.features.inherentKeepAlive||(yield n._sendMessage(n._cachedPingMessage))}catch(o){throw n._logger.log(a.i.Debug,`Hub handshake failed with error '${o}' during start(). Stopping HubConnection.`),n._cleanupTimeout(),n._cleanupPingTimer(),yield n.connection.stop(o),o}})()}stop(){var n=this;return(0,v.Z)(function*(){const t=n._startPromise;n._stopPromise=n._stopInternal(),yield n._stopPromise;try{yield t}catch{}})()}_stopInternal(n){return this._connectionState===C.Disconnected?(this._logger.log(a.i.Debug,`Call to HubConnection.stop(${n}) ignored because it is already in the disconnected state.`),Promise.resolve()):this._connectionState===C.Disconnecting?(this._logger.log(a.i.Debug,`Call to HttpConnection.stop(${n}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState=C.Disconnecting,this._logger.log(a.i.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(a.i.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=n||new T("The connection was stopped before the hub handshake could complete."),this.connection.stop(n)))}stream(n,...t){const[o,r]=this._replaceStreamingParams(t),s=this._createStreamInvocation(n,t,r);let c;const l=new le;return l.cancelCallback=()=>{const p=this._createCancelInvocation(s.invocationId);return delete this._callbacks[s.invocationId],c.then(()=>this._sendWithProtocol(p))},this._callbacks[s.invocationId]=(p,d)=>{d?l.error(d):p&&(p.type===b.Completion?p.error?l.error(new Error(p.error)):l.complete():l.next(p.item))},c=this._sendWithProtocol(s).catch(p=>{l.error(p),delete this._callbacks[s.invocationId]}),this._launchStreams(o,c),l}_sendMessage(n){return this._resetKeepAliveInterval(),this.connection.send(n)}_sendWithProtocol(n){return this._sendMessage(this._protocol.writeMessage(n))}send(n,...t){const[o,r]=this._replaceStreamingParams(t),s=this._sendWithProtocol(this._createInvocation(n,t,!0,r));return this._launchStreams(o,s),s}invoke(n,...t){const[o,r]=this._replaceStreamingParams(t),s=this._createInvocation(n,t,!1,r);return new Promise((l,p)=>{this._callbacks[s.invocationId]=(f,_)=>{_?p(_):f&&(f.type===b.Completion?f.error?p(new Error(f.error)):l(f.result):p(new Error(`Unexpected message type: ${f.type}`)))};const d=this._sendWithProtocol(s).catch(f=>{p(f),delete this._callbacks[s.invocationId]});this._launchStreams(o,d)})}on(n,t){!n||!t||(n=n.toLowerCase(),this._methods[n]||(this._methods[n]=[]),-1===this._methods[n].indexOf(t)&&this._methods[n].push(t))}off(n,t){if(!n)return;n=n.toLowerCase();const o=this._methods[n];if(o)if(t){const r=o.indexOf(t);-1!==r&&(o.splice(r,1),0===o.length&&delete this._methods[n])}else delete this._methods[n]}onclose(n){n&&this._closedCallbacks.push(n)}onreconnecting(n){n&&this._reconnectingCallbacks.push(n)}onreconnected(n){n&&this._reconnectedCallbacks.push(n)}_processIncomingData(n){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(n=this._processHandshakeResponse(n),this._receivedHandshakeResponse=!0),n){const t=this._protocol.parseMessages(n,this._logger);for(const o of t)switch(o.type){case b.Invocation:this._invokeClientMethod(o);break;case b.StreamItem:case b.Completion:{const r=this._callbacks[o.invocationId];if(r){o.type===b.Completion&&delete this._callbacks[o.invocationId];try{r(o)}catch(s){this._logger.log(a.i.Error,`Stream callback threw error: ${(0,u.HH)(s)}`)}}break}case b.Ping:break;case b.Close:{this._logger.log(a.i.Information,"Close message received from server.");const r=o.error?new Error("Server returned an error on close: "+o.error):void 0;!0===o.allowReconnect?this.connection.stop(r):this._stopPromise=this._stopInternal(r);break}default:this._logger.log(a.i.Warning,`Invalid message type: ${o.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(n){let t,o;try{[o,t]=this._handshakeProtocol.parseHandshakeResponse(n)}catch(r){const s="Error parsing handshake response: "+r;this._logger.log(a.i.Error,s);const c=new Error(s);throw this._handshakeRejecter(c),c}if(t.error){const r="Server returned handshake error: "+t.error;this._logger.log(a.i.Error,r);const s=new Error(r);throw this._handshakeRejecter(s),s}return this._logger.log(a.i.Debug,"Server handshake complete."),this._handshakeResolver(),o}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){var n=this;if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),void 0!==this._pingServerHandle))){let t=this._nextKeepAlive-(new Date).getTime();t<0&&(t=0),this._pingServerHandle=setTimeout((0,v.Z)(function*(){if(n._connectionState===C.Connected)try{yield n._sendMessage(n._cachedPingMessage)}catch{n._cleanupPingTimer()}}),t)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}_invokeClientMethod(n){var t=this;return(0,v.Z)(function*(){const o=n.target.toLowerCase(),r=t._methods[o];if(!r)return t._logger.log(a.i.Warning,`No client method with the name '${o}' found.`),void(n.invocationId&&(t._logger.log(a.i.Warning,`No result given for '${o}' method and invocation ID '${n.invocationId}'.`),yield t._sendWithProtocol(t._createCompletionMessage(n.invocationId,"Client didn't provide a result.",null))));const s=r.slice(),c=!!n.invocationId;let l,p,d;for(const f of s)try{const _=l;l=yield f.apply(t,n.arguments),c&&l&&_&&(t._logger.log(a.i.Error,`Multiple results provided for '${o}'. Sending error to server.`),d=t._createCompletionMessage(n.invocationId,"Client provided multiple results.",null)),p=void 0}catch(_){p=_,t._logger.log(a.i.Error,`A callback for the method '${o}' threw error '${_}'.`)}d?yield t._sendWithProtocol(d):c?(p?d=t._createCompletionMessage(n.invocationId,`${p}`,null):void 0!==l?d=t._createCompletionMessage(n.invocationId,null,l):(t._logger.log(a.i.Warning,`No result given for '${o}' method and invocation ID '${n.invocationId}'.`),d=t._createCompletionMessage(n.invocationId,"Client didn't provide a result.",null)),yield t._sendWithProtocol(d)):l&&t._logger.log(a.i.Error,`Result given for '${o}' method but server is not expecting a result.`)})()}_connectionClosed(n){this._logger.log(a.i.Debug,`HubConnection.connectionClosed(${n}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||n||new T("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(n||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===C.Disconnecting?this._completeClose(n):this._connectionState===C.Connected&&this._reconnectPolicy?this._reconnect(n):this._connectionState===C.Connected&&this._completeClose(n)}_completeClose(n){if(this._connectionStarted){this._connectionState=C.Disconnected,this._connectionStarted=!1,u.t4.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[n]))}catch(t){this._logger.log(a.i.Error,`An onclose callback called with error '${n}' threw error '${t}'.`)}}}_reconnect(n){var t=this;return(0,v.Z)(function*(){const o=Date.now();let r=0,s=void 0!==n?n:new Error("Attempting to reconnect due to a unknown error."),c=t._getNextRetryDelay(r++,0,s);if(null===c)return t._logger.log(a.i.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void t._completeClose(n);if(t._connectionState=C.Reconnecting,t._logger.log(a.i.Information,n?`Connection reconnecting because of error '${n}'.`:"Connection reconnecting."),0!==t._reconnectingCallbacks.length){try{t._reconnectingCallbacks.forEach(l=>l.apply(t,[n]))}catch(l){t._logger.log(a.i.Error,`An onreconnecting callback called with error '${n}' threw error '${l}'.`)}if(t._connectionState!==C.Reconnecting)return void t._logger.log(a.i.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;null!==c;){if(t._logger.log(a.i.Information,`Reconnect attempt number ${r} will start in ${c} ms.`),yield new Promise(l=>{t._reconnectDelayHandle=setTimeout(l,c)}),t._reconnectDelayHandle=void 0,t._connectionState!==C.Reconnecting)return void t._logger.log(a.i.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(yield t._startInternal(),t._connectionState=C.Connected,t._logger.log(a.i.Information,"HubConnection reconnected successfully."),0!==t._reconnectedCallbacks.length)try{t._reconnectedCallbacks.forEach(l=>l.apply(t,[t.connection.connectionId]))}catch(l){t._logger.log(a.i.Error,`An onreconnected callback called with connectionId '${t.connection.connectionId}; threw error '${l}'.`)}return}catch(l){if(t._logger.log(a.i.Information,`Reconnect attempt failed because of error '${l}'.`),t._connectionState!==C.Reconnecting)return t._logger.log(a.i.Debug,`Connection moved to the '${t._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(t._connectionState===C.Disconnecting&&t._completeClose());s=l instanceof Error?l:new Error(l.toString()),c=t._getNextRetryDelay(r++,Date.now()-o,s)}}t._logger.log(a.i.Information,`Reconnect retries have been exhausted after ${Date.now()-o} ms and ${r} failed attempts. Connection disconnecting.`),t._completeClose()})()}_getNextRetryDelay(n,t,o){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:n,retryReason:o})}catch(r){return this._logger.log(a.i.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${n}, ${t}) threw error '${r}'.`),null}}_cancelCallbacksWithError(n){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(o=>{const r=t[o];try{r(null,n)}catch(s){this._logger.log(a.i.Error,`Stream 'error' callback called with '${n}' threw error: ${(0,u.HH)(s)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(n,t,o,r){if(o)return 0!==r.length?{arguments:t,streamIds:r,target:n,type:b.Invocation}:{arguments:t,target:n,type:b.Invocation};{const s=this._invocationId;return this._invocationId++,0!==r.length?{arguments:t,invocationId:s.toString(),streamIds:r,target:n,type:b.Invocation}:{arguments:t,invocationId:s.toString(),target:n,type:b.Invocation}}}_launchStreams(n,t){if(0!==n.length){t||(t=Promise.resolve());for(const o in n)n[o].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(o)))},error:r=>{let s;s=r instanceof Error?r.message:r&&r.toString?r.toString():"Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(o,s)))},next:r=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(o,r)))}})}}_replaceStreamingParams(n){const t=[],o=[];for(let r=0;r<n.length;r++){const s=n[r];if(this._isObservable(s)){const c=this._invocationId;this._invocationId++,t[c]=s,o.push(c.toString()),n.splice(r,1)}}return[t,o]}_isObservable(n){return n&&n.subscribe&&"function"==typeof n.subscribe}_createStreamInvocation(n,t,o){const r=this._invocationId;return this._invocationId++,0!==o.length?{arguments:t,invocationId:r.toString(),streamIds:o,target:n,type:b.StreamInvocation}:{arguments:t,invocationId:r.toString(),target:n,type:b.StreamInvocation}}_createCancelInvocation(n){return{invocationId:n,type:b.CancelInvocation}}_createStreamItemMessage(n,t){return{invocationId:n,item:t,type:b.StreamItem}}_createCompletionMessage(n,t,o){return t?{error:t,invocationId:n,type:b.Completion}:{invocationId:n,result:o,type:b.Completion}}}var mt=m(1516);class ue{constructor(){this.name="json",this.version=1,this.transferFormat=S.Text}parseMessages(n,t){if("string"!=typeof n)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!n)return[];null===t&&(t=mt.W.instance);const o=x.parse(n),r=[];for(const s of o){const c=JSON.parse(s);if("number"!=typeof c.type)throw new Error("Invalid payload.");switch(c.type){case b.Invocation:this._isInvocationMessage(c);break;case b.StreamItem:this._isStreamItemMessage(c);break;case b.Completion:this._isCompletionMessage(c);break;case b.Ping:case b.Close:break;default:t.log(a.i.Information,"Unknown message type '"+c.type+"' ignored.");continue}r.push(c)}return r}writeMessage(n){return x.write(JSON.stringify(n))}_isInvocationMessage(n){this._assertNotEmptyString(n.target,"Invalid payload for Invocation message."),void 0!==n.invocationId&&this._assertNotEmptyString(n.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(n){if(this._assertNotEmptyString(n.invocationId,"Invalid payload for StreamItem message."),void 0===n.item)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(n){if(n.result&&n.error)throw new Error("Invalid payload for Completion message.");!n.result&&n.error&&this._assertNotEmptyString(n.error,"Invalid payload for Completion message."),this._assertNotEmptyString(n.invocationId,"Invalid payload for Completion message.")}_assertNotEmptyString(n,t){if("string"!=typeof n||""===n)throw new Error(t)}}const me={trace:a.i.Trace,debug:a.i.Debug,info:a.i.Information,information:a.i.Information,warn:a.i.Warning,warning:a.i.Warning,error:a.i.Error,critical:a.i.Critical,none:a.i.None};class ge{configureLogging(n){if(u.j7.isRequired(n,"logging"),function _e(i){return void 0!==i.log}(n))this.logger=n;else if("string"==typeof n){const t=function fe(i){const n=me[i.toLowerCase()];if(typeof n<"u")return n;throw new Error(`Unknown log level: ${i}`)}(n);this.logger=new u.kw(t)}else this.logger=new u.kw(n);return this}withUrl(n,t){return u.j7.isRequired(n,"url"),u.j7.isNotEmpty(n,"url"),this.url=n,this.httpConnectionOptions="object"==typeof t?{...this.httpConnectionOptions,...t}:{...this.httpConnectionOptions,transport:t},this}withHubProtocol(n){return u.j7.isRequired(n,"protocol"),this.protocol=n,this}withAutomaticReconnect(n){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return this.reconnectPolicy=n?Array.isArray(n)?new lt(n):n:new lt,this}build(){const n=this.httpConnectionOptions||{};if(void 0===n.logger&&(n.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new se(this.url,n);return z.create(t,this.logger||mt.W.instance,this.protocol||new ue,this.reconnectPolicy)}}var ft=m(4716),R=m(7836);let gt=(()=>{class i{constructor(t,o){this.apiBaseUrl=t,this.identityService=o,this.connections={},this.methods={}}listenRaw(t,o){return this.methods[t]||(this.methods[t]={}),this.methods[t][o]||(this.methods[t][o]=new J.x,this.connect(t).on(o,s=>this.methods[t][o].next(s))),this.methods[t][o]}listen(t,o,r){return this.listenRaw(t,o).pipe((0,P.U)(s=>r(s)),(0,ft.x)(()=>this.destroy(t,o)))}connect(t){if(this.connections[t]&&(this.connections[t].state===C.Connected||this.connections[t].state===C.Connecting))return this.connections[t];const o=new URL("signalr/"+t,this.apiBaseUrl),r=(new ge).withUrl(o.href,{withCredentials:!1}).withAutomaticReconnect().build();return r.start().then(()=>r.invoke("DeclareIdentity",this.identityService.getIdentity())),this.connections[t]=r,r}destroy(t,o){!this.methods[t]||!this.connections[t]||this.methods[t][o]&&(this.connections[t].off(o),this.methods[t][o].complete(),delete this.methods[t][o],0===Object.entries(this.methods[t]).length&&this.disconnect(t))}disconnect(t){this.connections[t]&&(this.connections[t].stop().then(),this.methods[t]&&(delete this.connections[t],delete this.methods[t]))}static#t=this.\u0275fac=function(o){return new(o||i)(e.LFG(h.CT),e.LFG(R.P))};static#e=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();function be(i,n){if(1&i&&(e.TgZ(0,"div",4)(1,"h1",5),e._uU(2),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.title)}}let Ce=(()=>{class i{constructor(t){this.modal=t,this.alertString=ve(["Alert!","Wait a minute...","Is this for real?!"])}static#t=this.\u0275fac=function(o){return new(o||i)(e.Y36(k.Kz))};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-alert-modal"]],inputs:{title:"title",content:"content",closeLabel:"closeLabel"},decls:9,vars:4,consts:[["class","modal-header",4,"ngIf"],[1,"modal-body"],[1,"modal-footer"],[1,"btn","btn-primary",3,"click"],[1,"modal-header"],[1,"modal-title"]],template:function(o,r){if(1&o&&(e.YNc(0,be,3,1,"div",0),e.TgZ(1,"div",1)(2,"strong"),e._uU(3),e.qZA(),e._UZ(4,"br"),e._uU(5),e.qZA(),e.TgZ(6,"div",2)(7,"button",3),e.NdJ("click",function(){return r.modal.close()}),e._uU(8),e.qZA()()),2&o){let s;e.Q6J("ngIf",r.title),e.xp6(3),e.Oqu(r.alertString),e.xp6(2),e.hij(" ",r.content,"\n"),e.xp6(3),e.hij(" ",null!==(s=r.closeLabel)&&void 0!==s?s:"Close"," ")}},dependencies:[g.O5],encapsulation:2})}return i})();const ve=i=>i[Math.floor(Math.random()*i.length)];let ye=(()=>{class i{constructor(t){this.modalService=t}alert(t){const o=this.modalService.open(Ce,{centered:!0});return o.componentInstance.title=t.title,o.componentInstance.content=t.content,o.componentInstance.closeLabel=t.closeLabel,(0,O.D)(o.result).pipe((0,M.K)(r=>(0,$.of)(void 0)))}static#t=this.\u0275fac=function(o){return new(o||i)(e.LFG(k.FF))};static#e=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var Se=m(2630),W=m(4325),we=m(166);function xe(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.leave.emit())}),e._UZ(1,"i",16),e.qZA()}}function Te(i,n){if(1&i&&(e.ynx(0),e.TgZ(1,"h3"),e._uU(2),e.qZA(),e.YNc(3,xe,2,0,"button",14),e.BQk()),2&i){const t=e.oxw();let o;e.xp6(2),e.Oqu(null!==(o=t.name)&&void 0!==o?o:"???"),e.xp6(1),e.Q6J("ngIf",!t.readonly)}}function ke(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.leave.emit())}),e.qZA()}}function Ie(i,n){if(1&i){const t=e.EpF();e.ynx(0),e._UZ(1,"i",17),e.TgZ(2,"input",18),e.NdJ("ngModelChange",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.name=r)}),e.qZA(),e.YNc(3,ke,1,0,"button",19),e.BQk()}if(2&i){const t=e.oxw();e.xp6(2),e.Q6J("disabled",t.readonly)("ngModel",t.name),e.xp6(1),e.Q6J("ngIf",!t.readonly)}}const Ee=function(i){return{$implicit:i}};function Pe(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"a",21),e.NdJ("click",function(){const s=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.select(s))})("dragstart",function(r){const c=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.dragCharacter(r,c))}),e._uU(1),e.qZA()}if(2&i){const t=n.$implicit,o=e.oxw(),r=e.MAs(25);e.ekj("active",o.isSelected(t))("disabled",o.disabled),e.Q6J("ngbPopover",r)("popoverContext",e.VKq(8,Ee,t))("placement",o.invertSlotPositions?"right":"left"),e.xp6(1),e.hij(" ",t.identity.displayName," ")}}function Ae(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.swap())}),e._UZ(1,"i",23),e.qZA()}if(2&i){const t=e.oxw();e.Q6J("disabled",t.disabled)}}function Ze(i,n){if(1&i&&(e.ynx(0),e.GkF(1,24)(2,24),e.BQk()),2&i){e.oxw();const t=e.MAs(21),o=e.MAs(23);e.xp6(1),e.Q6J("ngTemplateOutlet",t),e.xp6(1),e.Q6J("ngTemplateOutlet",o)}}function De(i,n){if(1&i&&(e.ynx(0),e.GkF(1,24)(2,24),e.BQk()),2&i){e.oxw();const t=e.MAs(23),o=e.MAs(21);e.xp6(1),e.Q6J("ngTemplateOutlet",t),e.xp6(1),e.Q6J("ngTemplateOutlet",o)}}const _t=function(){return{"width.em":.75,"height.em":.75}};function Ne(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.unselect("front"))}),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("ngStyle",e.DdM(2,_t))("disabled",t.disabled)}}function Oe(i,n){if(1&i&&e._UZ(0,"app-character-card",30),2&i){const t=e.oxw(2);e.Q6J("character",t.frontCharacter)("enablePopoverDetails",!0)("popoverDetailsPlacement",t.invertSlotPositions?"right":"left")}}function Ue(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",25)(1,"h4",3),e._uU(2," Front "),e.YNc(3,Ne,1,3,"button",26),e.qZA(),e.TgZ(4,"app-character-img",27),e.NdJ("dropped",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.dropCharacter(r,"front"))}),e.qZA(),e.YNc(5,Oe,1,3,"app-character-card",28),e.qZA()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.frontCharacter&&!t.readonly),e.xp6(1),e.Q6J("character",t.frontCharacter),e.xp6(1),e.Q6J("ngIf",t.frontCharacter)}}function Re(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.unselect("back"))}),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("ngStyle",e.DdM(2,_t))("disabled",t.disabled)}}function Je(i,n){if(1&i&&e._UZ(0,"app-character-card",30),2&i){const t=e.oxw(2);e.Q6J("character",t.backCharacter)("enablePopoverDetails",!0)("popoverDetailsPlacement",t.invertSlotPositions?"right":"left")}}function $e(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",25)(1,"h4",3),e._uU(2," Back "),e.YNc(3,Re,1,3,"button",26),e.qZA(),e.TgZ(4,"app-character-img",27),e.NdJ("dropped",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.dropCharacter(r,"back"))}),e.qZA(),e.YNc(5,Je,1,3,"app-character-card",28),e.qZA()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.backCharacter&&!t.readonly),e.xp6(1),e.Q6J("character",t.backCharacter),e.xp6(1),e.Q6J("ngIf",t.backCharacter)}}function Me(i,n){1&i&&e._UZ(0,"app-character-card",31),2&i&&e.Q6J("character",n.$implicit)("contentOnly",!0)}const Fe=function(){return{"minHeight.em":1.5}};let Qe=(()=>{class i{constructor(){this._characters=[],this.enableNameEdition=!1,this.readonly=!1,this.invertSlotPositions=!1,this.update=new e.vpe,this.leave=new e.vpe,this.ready=!1}get name(){return this._name}set name(t){this._name=t,this.doUpdateAfterChange()}get combat(){return this._combat}set combat(t){this._combat=t,this.doUpdateAfterChange()}get characters(){return this._characters}set characters(t){this._characters=t,this.doUpdateAfterChange()}get disabled(){return this.readonly||this.ready}getAt(t){switch(t){case"front":return this.frontCharacter;case"back":return this.backCharacter}}swap(){if(this.frontCharacter&&this.backCharacter){const t=this.frontCharacter;this.frontCharacter=this.backCharacter,this.backCharacter=t,this.sendUpdate()}}select(t,o){if(this.isSelected(t))o&&this.getAt(o)?.identity?.name!==t.identity.name&&this.swap();else switch(o){case"front":this.frontCharacter=t,this.sendUpdate();break;case"back":this.backCharacter=t,this.sendUpdate();break;default:!this.frontCharacter||this.frontCharacter&&this.backCharacter?this.frontCharacter=t:this.backCharacter||(this.backCharacter=t),this.sendUpdate()}}isSelected(t){return this.frontCharacter&&t.identity.name===this.frontCharacter.identity.name||this.backCharacter&&t.identity.name===this.backCharacter.identity.name}unselect(t){switch(t){case"front":this.frontCharacter=void 0,this.sendUpdate();break;case"back":this.backCharacter=void 0,this.sendUpdate()}}dragCharacter(t,o){t.dataTransfer&&(t.dataTransfer.setData("text/plain",`character:${o.identity.name}`),t.dataTransfer.effectAllowed="copy")}dropCharacter(t,o){const r=t.dataTransfer?.getData("text/plain");if(!r||!r.startsWith("character:"))return;const s=r.substring(10),c=this._characters.find(l=>l.identity.name===s);c&&(this.select(c,o),t.preventDefault())}setReady(t){this.ready=t,this.sendUpdate()}sendUpdate(){this.update.emit({playerName:this._name??"",frontCharacter:this.frontCharacter?.identity.name,backCharacter:this.backCharacter?.identity.name,ready:this.ready})}doUpdateAfterChange(){if(!this._combat||!this._name)return this.frontCharacter=void 0,this.backCharacter=void 0,void(this.ready=!1);this._name==this._combat.leftPlayerName?(this.frontCharacter=this._characters.find(t=>t.identity.name===this._combat?.leftFrontCharacter),this.backCharacter=this._characters.find(t=>t.identity.name===this._combat?.leftBackCharacter),this.ready=this._combat.leftReady):this._name==this._combat.rightPlayerName&&(this.frontCharacter=this._characters.find(t=>t.identity.name===this._combat?.rightFrontCharacter),this.backCharacter=this._characters.find(t=>t.identity.name===this._combat?.rightBackCharacter),this.ready=this._combat.rightReady)}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-combat-configure-side"]],inputs:{name:"name",combat:"combat",characters:"characters",enableNameEdition:"enableNameEdition",readonly:"readonly",invertSlotPositions:"invertSlotPositions"},outputs:{update:"update",leave:"leave"},decls:26,vars:13,consts:[[1,"vstack"],[1,"hstack","justify-content-center","gap-2",3,"ngStyle"],[4,"ngIf"],[1,"text-center"],[1,"overflow-y-auto",2,"max-height","50vh"],[1,"list-group"],["class","list-group-item list-group-item-action","draggable","true","container","body","triggers","mouseenter:mouseleave",3,"active","ngbPopover","popoverContext","placement","disabled","click","dragstart",4,"ngFor","ngForOf"],["class","btn btn-outline-secondary btn-sm","ngbTooltip","Swap",3,"disabled","click",4,"ngIf"],[1,"row"],[1,"flex-fill"],[1,"btn","mt-2",3,"disabled","click"],["frontCharacterTpl",""],["backCharacterTpl",""],["characterCardTpl",""],["class","btn btn-outline-secondary btn-sm","ngbTooltip","Leave",3,"click",4,"ngIf"],["ngbTooltip","Leave",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-door-open-fill"],["ngbTooltip","AI Player",1,"bi","bi-cpu"],[1,"form-control","form-control-lg",3,"disabled","ngModel","ngModelChange"],["class","btn-close btn-sm","ngbTooltip","Remove AI",3,"click",4,"ngIf"],["ngbTooltip","Remove AI",1,"btn-close","btn-sm",3,"click"],["draggable","true","container","body","triggers","mouseenter:mouseleave",1,"list-group-item","list-group-item-action",3,"ngbPopover","popoverContext","placement","click","dragstart"],["ngbTooltip","Swap",1,"btn","btn-outline-secondary","btn-sm",3,"disabled","click"],[1,"bi","bi-arrow-left-right"],[3,"ngTemplateOutlet"],[1,"w-50","col","vstack"],["type","button","class","btn-close p-0 btn-sm","ngbTooltip","Clear","aria-label","Close",3,"ngStyle","disabled","click",4,"ngIf"],["size","lg",3,"character","dropped"],["class","mt-2",3,"character","enablePopoverDetails","popoverDetailsPlacement",4,"ngIf"],["type","button","ngbTooltip","Clear","aria-label","Close",1,"btn-close","p-0","btn-sm",3,"ngStyle","disabled","click"],[1,"mt-2",3,"character","enablePopoverDetails","popoverDetailsPlacement"],[3,"character","contentOnly"]],template:function(o,r){1&o&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,Te,4,2,"ng-container",2),e.YNc(3,Ie,4,3,"ng-container",2),e.qZA(),e.TgZ(4,"h4",3),e._uU(5,"Select characters"),e.qZA(),e.TgZ(6,"div",4)(7,"ul",5),e.YNc(8,Pe,2,10,"a",6),e.qZA()(),e._UZ(9,"hr"),e.TgZ(10,"section")(11,"h3",3),e._uU(12," Team "),e.YNc(13,Ae,2,1,"button",7),e.qZA(),e.TgZ(14,"div",8),e.YNc(15,Ze,3,2,"ng-container",2),e.YNc(16,De,3,2,"ng-container",2),e.qZA()(),e._UZ(17,"div",9),e.TgZ(18,"button",10),e.NdJ("click",function(){return r.setReady(!r.ready)}),e._uU(19," Ready "),e.qZA()(),e.YNc(20,Ue,6,3,"ng-template",null,11,e.W1O),e.YNc(22,$e,6,3,"ng-template",null,12,e.W1O),e.YNc(24,Me,1,2,"ng-template",null,13,e.W1O)),2&o&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(12,Fe)),e.xp6(1),e.Q6J("ngIf",!r.enableNameEdition),e.xp6(1),e.Q6J("ngIf",r.enableNameEdition),e.xp6(5),e.Q6J("ngForOf",r.characters),e.xp6(5),e.Q6J("ngIf",!r.readonly),e.xp6(2),e.Q6J("ngIf",!r.invertSlotPositions),e.xp6(1),e.Q6J("ngIf",r.invertSlotPositions),e.xp6(2),e.ekj("btn-outline-secondary",!r.ready)("btn-secondary",r.ready),e.Q6J("disabled",r.readonly))},dependencies:[g.sg,g.O5,g.tP,g.PC,W.o,we.Y,E.Fj,E.JJ,E.On,k._L,k.o8],encapsulation:2})}return i})();m(8656);let He=(()=>{class i{get combat(){return this._combat}set combat(t){this._combat=t,this.updateUrl()}constructor(t){this.baseHref=t,this.requestAi=new e.vpe,this.url="???"}copyUrl(){navigator.clipboard.writeText(this.url).then()}updateUrl(){this.url=new URL("combat/join/"+this._combat?.id,new URL(this.baseHref,window.location.origin)).href}static#t=this.\u0275fac=function(o){return new(o||i)(e.Y36(g.mr))};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-combat-empty-side"]],inputs:{combat:"combat"},outputs:{requestAi:"requestAi"},decls:11,vars:1,consts:[[1,"h-100","vstack","align-items-center","justify-content-center"],[1,"hstack","justify-content-center","gap-2"],["ngbTooltip","Copy",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-clipboard"],[1,"w-100","fs-5"],[1,"btn","btn-outline-secondary","fs-3",3,"click"]],template:function(o,r){1&o&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2," Invite a friend "),e.TgZ(3,"button",2),e.NdJ("click",function(){return r.copyUrl()}),e._UZ(4,"i",3),e.qZA()(),e.TgZ(5,"code",4),e._uU(6),e.qZA(),e.TgZ(7,"h2"),e._uU(8,"OR"),e.qZA(),e.TgZ(9,"button",5),e.NdJ("click",function(){return r.requestAi.emit()}),e._uU(10,"Play against AI"),e.qZA()()),2&o&&(e.xp6(6),e.hij(" ",r.url," "))},dependencies:[k._L],encapsulation:2})}return i})();function Le(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"app-combat-configure-side",16),e.NdJ("update",function(r){e.CHM(t);const s=e.oxw(2);return e.KtG(s.sendUpdate(s.CombatSide.Right,r))})("leave",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.leave(r.CombatSide.Right))}),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("combat",t.combat)("name",t.combat.rightPlayerName)("characters",t.characters)("readonly",t.side!==t.CombatSide.Right&&!t.combat.rightPlayerIsAi)("enableNameEdition",t.side!==t.CombatSide.Right&&t.combat.rightPlayerIsAi)}}function je(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"app-combat-empty-side",17),e.NdJ("requestAi",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.setRightPlayerAi())}),e.qZA()}if(2&i){const t=e.oxw(2);e.Q6J("combat",t.combat)}}function Ye(i,n){1&i&&(e.TgZ(0,"div",18),e._uU(1,"Combat has started, click START to join!"),e.qZA())}function ze(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"section",1)(1,"div",2)(2,"h1",3),e._uU(3,"Combat creation"),e.qZA()(),e.TgZ(4,"div",4)(5,"div",5)(6,"h2"),e._uU(7,"Player side"),e.qZA(),e.TgZ(8,"app-combat-configure-side",6),e.NdJ("update",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.sendUpdate(s.CombatSide.Left,r))})("leave",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.leave(r.CombatSide.Left))}),e.qZA()(),e.TgZ(9,"div",5)(10,"h2"),e._uU(11,"Opponent side"),e.qZA(),e.YNc(12,Le,1,5,"app-combat-configure-side",7),e.YNc(13,je,1,1,"app-combat-empty-side",8),e.qZA()(),e._UZ(14,"div",9),e.TgZ(15,"div",10)(16,"input",11),e.NdJ("ngModelChange",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.randomSeed=r)})("input",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.randomSeedChange.next())}),e.qZA(),e.TgZ(17,"label",12),e._uU(18,"Random Seed Phrase (optional)"),e.qZA()(),e.TgZ(19,"div",13),e.YNc(20,Ye,2,0,"div",14),e.TgZ(21,"button",15),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.start())}),e._uU(22," Start "),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(8),e.Q6J("combat",t.combat)("name",t.combat.leftPlayerName)("characters",t.characters)("invertSlotPositions",!0)("readonly",t.side!==t.CombatSide.Left),e.xp6(4),e.Q6J("ngIf",t.combat.rightPlayerName||t.combat.rightPlayerIsAi),e.xp6(1),e.Q6J("ngIf",!t.combat.rightPlayerName&&!t.combat.rightPlayerIsAi),e.xp6(3),e.Q6J("ngModel",t.randomSeed),e.xp6(4),e.Q6J("ngIf",t.startedCombatId),e.xp6(1),e.ekj("disabled",!t.combat||!t.combat.leftReady||!t.combat.rightReady),e.Q6J("disabled",!t.combat||!t.combat.leftReady||!t.combat.rightReady)}}let B=class V{constructor(n,t,o,r,s,c,l,p){this.signalRService=n,this.identityService=t,this.combatsService=o,this.charactersService=r,this.activatedRoute=s,this.router=c,this.modalsService=l,this.alertsService=p,this.characters=[],this.randomSeedChange=new J.x,this.CombatSide=h.E1}ngOnInit(){const n=this.identityService.getIdentity();this.randomSeedChange.pipe(function Yt(i,n=Ht.z){return(0,Lt.e)((t,o)=>{let r=null,s=null,c=null;const l=()=>{if(r){r.unsubscribe(),r=null;const d=s;s=null,o.next(d)}};function p(){const d=c+i,f=n.now();if(f<d)return r=this.schedule(void 0,d-f),void o.add(r);l()}t.subscribe((0,jt.x)(o,d=>{s=d,c=n.now(),r||(r=n.schedule(p,i),o.add(r))},()=>{l(),o.complete()},void 0,()=>{s=r=null}))})}(500),(0,A.w)(()=>null==this.combat?(0,$.of)(void 0):this.combatsService.updateCombatInPreparation(this.combat.id,new h.HV({playerName:n,randomSeed:this.randomSeed})))).subscribe(),this.signalRService.listen("combats","CombatInPreparationChanged",h.fQ.fromJS).pipe(L(this)).subscribe(t=>{this.combat=t,this.randomSeed=t.randomSeed}),this.signalRService.listen("combats","CombatInPreparationDeleted",h.fQ.fromJS).pipe(L(this)).subscribe(t=>this.onDeleted(t)),this.signalRService.listenRaw("combats","CombatInPreparationStarted").pipe(L(this)).subscribe((...t)=>this.onCreated(t[0])),this.activatedRoute.paramMap.pipe((0,A.w)(t=>{const o=t.get("id");return null==o?(this.router.to404().then(),(0,zt._)(()=>"Id not found")):this.combatsService.getCombatInPreparation(o,n)}),(0,M.K)(t=>(console.error(t),(0,O.D)(this.router.to404().then(o=>{})))),(0,P.U)(t=>{this.combat=t,this.side=n===this.combat?.leftPlayerName?h.E1.Left:n==this.combat?.rightPlayerName?h.E1.Right:h.E1.None}),(0,A.w)(()=>this.charactersService.getAll().pipe((0,P.U)(t=>this.characters=t)))).subscribe()}start(){this.startedCombatId&&this.router.toCombat(this.startedCombatId).then(),this.combat&&this.combatsService.startCombat(this.combat.id,this.identityService.getIdentity()).subscribe(n=>this.router.toCombat(n).then())}sendUpdate(n,t){if(!this.combat)return;const o=this.identityService.getIdentity();if((!this.combat.rightPlayerIsAi||n!==h.E1.Right)&&(o==this.combat.leftPlayerName&&n!==h.E1.Left||o==this.combat.rightPlayerName&&n!==h.E1.Right||t.playerName!==o))return;const r=n===h.E1.Right&&this.combat.rightPlayerIsAi;this.combatsService.updateCombatInPreparationSide(this.combat.id,new h.gx({...t,isAi:r})).subscribe()}setRightPlayerAi(){this.combat&&this.combatsService.updateCombatInPreparationSide(this.combat.id,new h.gx({isAi:!0,playerName:"Sancho",ready:!1})).subscribe()}leave(n){if(!this.combat)return;let t;switch(n){case h.E1.Left:t=this.combat?.leftPlayerName;break;case h.E1.Right:t=this.combat?.rightPlayerName}t&&this.combatsService.leaveCombatInPreparation(this.combat.id,t).subscribe(()=>this.router.toCombatSelection())}onDeleted(n){this.startedCombatId||n.leftPlayerName!==this.identityService.getIdentity()&&this.modalsService.alert({content:"This combat has been deleted by "+n.leftPlayerName,closeLabel:"Go back"}).subscribe(()=>this.router.toCombatSelection().then())}onCreated(n){if(this.hasRequestedStartOfCombat)return;this.startedCombatId=n;const t=this.identityService.getIdentity();this.alertsService.info(`Combat has been started by ${this.combat?.leftPlayerName===t?this.combat?.rightPlayerName:this.combat?.leftPlayerName}. Press START to join them.`)}static#t=this.\u0275fac=function(t){return new(t||V)(e.Y36(gt),e.Y36(R.P),e.Y36(h.cP),e.Y36(h.R),e.Y36(w.gz),e.Y36(w.F0),e.Y36(ye),e.Y36(Se.m))};static#e=this.\u0275cmp=e.Xpm({type:V,selectors:[["ng-component"]],decls:1,vars:1,consts:[["class","container h-100 vstack gap-4 py-4",4,"ngIf"],[1,"container","h-100","vstack","gap-4","py-4"],[1,"row"],[1,"text-center"],[1,"row","row-gap-4","flex-fill","overflow-y-auto"],[1,"col-lg"],[3,"combat","name","characters","invertSlotPositions","readonly","update","leave"],[3,"combat","name","characters","readonly","enableNameEdition","update","leave",4,"ngIf"],[3,"combat","requestAi",4,"ngIf"],[1,"flex-fill"],[1,"form-floating"],["id","random-seed","placeholder","Random Seed Phrase (optional)",1,"form-control",3,"ngModel","ngModelChange","input"],["for","random-seed"],[1,"vstack","gap-1"],["class","text-success text-center",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[3,"combat","name","characters","readonly","enableNameEdition","update","leave"],[3,"combat","requestAi"],[1,"text-success","text-center"]],template:function(t,o){1&t&&e.YNc(0,ze,23,12,"section",0),2&t&&e.Q6J("ngIf",o.combat)},dependencies:[g.O5,E.Fj,E.JJ,E.On,Qe,He],encapsulation:2})};function We(i,n){if(1&i&&(e.TgZ(0,"ngb-alert",1),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij(" ",t.error,"\n")}}B=(0,Tt.gn)([function Rt(i={}){return n=>{!function At(i){return!!i[Pt]}(n)?function Ot(i,n){i.prototype.ngOnDestroy=rt(i.prototype.ngOnDestroy,n)}(n,i):function Ut(i,n){const t=i.\u0275pipe;t.onDestroy=rt(t.onDestroy,n)}(n,i),function Dt(i){i.prototype[tt]=!0}(n)}}()],B),w.F0.prototype.toCombatConfiguration=function(i){return this.navigate(["/","combat","configure",i])};let Be=(()=>{class i{constructor(t,o,r,s){this.identityService=t,this.combatsService=o,this.activatedRoute=r,this.router=s}ngOnInit(){let t;this.activatedRoute.paramMap.pipe((0,A.w)(o=>{const r=o.get("id");if(!r)return(0,O.D)(this.router.to404().then());t=r;const s=this.identityService.getIdentity();return this.combatsService.updateCombatInPreparationSide(t,new h.gx({playerName:s,ready:!1}))}),(0,M.K)(o=>(console.error(o),this.error="Could not join combat, does it exist?",(0,$.of)(void 0))),(0,A.w)(()=>this.router.toCombatConfiguration(t))).subscribe()}static#t=this.\u0275fac=function(o){return new(o||i)(e.Y36(R.P),e.Y36(h.cP),e.Y36(w.gz),e.Y36(w.F0))};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["ng-component"]],decls:1,vars:1,consts:[["type","error",4,"ngIf"],["type","error"]],template:function(o,r){1&o&&e.YNc(0,We,2,1,"ngb-alert",0),2&o&&e.Q6J("ngIf",r.error)},dependencies:[g.O5,k.xm],encapsulation:2})}return i})();var Ke=m(9315),Ve=m(7538);function Ge(i,n){1&i&&e.GkF(0)}const K=function(i){return{$implicit:i}};function qe(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"a",9),e.NdJ("click",function(){const s=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.select(s))}),e.YNc(1,Ge,1,0,"ng-container",10),e.qZA()}if(2&i){const t=n.$implicit;e.oxw();const o=e.MAs(17);e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(2,K,t))}}function Xe(i,n){1&i&&e.GkF(0)}function tn(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"a",9),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.select(r))}),e.YNc(1,Xe,1,0,"ng-container",10),e.qZA()}if(2&i){const t=e.oxw().$implicit;e.oxw();const o=e.MAs(15);e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(2,K,t))}}function en(i,n){if(1&i&&(e.ynx(0),e.YNc(1,tn,2,4,"a",11),e.BQk()),2&i){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf",!t.over)}}function nn(i,n){1&i&&e.GkF(0)}function on(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"a",9),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.select(r))}),e.YNc(1,nn,1,0,"ng-container",10),e.qZA()}if(2&i){const t=e.oxw().$implicit;e.oxw();const o=e.MAs(15);e.xp6(1),e.Q6J("ngTemplateOutlet",o)("ngTemplateOutletContext",e.VKq(2,K,t))}}function rn(i,n){if(1&i&&(e.ynx(0),e.YNc(1,on,2,4,"a",11),e.BQk()),2&i){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf",t.over)}}function sn(i,n){1&i&&e._UZ(0,"i",16),2&i&&e.Q6J("ngbTooltip","You WON!")}function an(i,n){1&i&&e._UZ(0,"i",17),2&i&&e.Q6J("ngbTooltip","You LOST!")}function cn(i,n){if(1&i&&(e.TgZ(0,"div",12),e.YNc(1,sn,1,1,"i",13),e.YNc(2,an,1,1,"i",14),e._uU(3),e._UZ(4,"div",15),e.TgZ(5,"small"),e._uU(6),e.qZA()()),2&i){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf",t.over&&t.winner===t.player.side),e.xp6(1),e.Q6J("ngIf",t.over&&t.winner!==t.player.side),e.xp6(1),e.AsE(" ",t.player.playerName," v. ",t.opponent.playerName," "),e.xp6(3),e.Oqu(t.id)}}function ln(i,n){if(1&i&&(e.TgZ(0,"div",12),e._UZ(1,"i",18),e._uU(2),e._UZ(3,"div",15),e.TgZ(4,"small"),e._uU(5),e.qZA()()),2&i){const t=n.$implicit;let o;e.xp6(2),e.AsE(" ",t.leftPlayerName," v. ",null!==(o=t.rightPlayerName)&&void 0!==o?o:"???"," "),e.xp6(3),e.Oqu(t.id)}}let hn=(()=>{class i{constructor(t,o,r){this.combatController=t,this.identityService=o,this.router=r,this.combats=[],this.combatsInPreparation=[],this.refreshing=!1}ngOnInit(){this.loadCombats().subscribe()}refresh(){this.loadCombats().subscribe()}create(){const t=this.identityService.getIdentity();this.combatController.createCombat(t).pipe((0,P.U)(o=>{this.router.toCombatConfiguration(o.id).then()})).subscribe()}select(t){t instanceof h.fQ?this.router.toCombatConfiguration(t.id).then():this.router.toCombat(t.id).then()}loadCombats(){const t=this.identityService.getIdentity();return this.refreshing=!0,(0,Ke.D)([this.combatController.getCombatsOfPlayer(t).pipe((0,P.U)(o=>{this.combats=o})),this.combatController.getCombatsInPreparationOfPlayer(t).pipe((0,P.U)(o=>{this.combatsInPreparation=o}))]).pipe((0,Ve.l)(),(0,ft.x)(()=>this.refreshing=!1))}static#t=this.\u0275fac=function(o){return new(o||i)(e.Y36(h.cP),e.Y36(R.P),e.Y36(w.F0))};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["ng-component"]],decls:18,vars:3,consts:[[1,"container"],[1,"btn","btn-secondary",3,"click"],[1,"bi","bi-plus"],[1,"list-group"],["class","list-group-item list-group-item-action",3,"click",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"mt-5"],["combatEntry",""],["combatInPreparationEntry",""],[1,"list-group-item","list-group-item-action",3,"click"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","list-group-item list-group-item-action",3,"click",4,"ngIf"],[1,"hstack","gap-2"],["class","bi bi-trophy-fill",3,"ngbTooltip",4,"ngIf"],["class","bi bi-x",3,"ngbTooltip",4,"ngIf"],[1,"flex-fill"],[1,"bi","bi-trophy-fill",3,"ngbTooltip"],[1,"bi","bi-x",3,"ngbTooltip"],["ngbTooltip","In preparation",1,"bi","bi-hourglass-split"]],template:function(o,r){1&o&&(e.TgZ(0,"section",0)(1,"h1"),e._uU(2," Combats "),e.TgZ(3,"button",1),e.NdJ("click",function(){return r.create()}),e._UZ(4,"i",2),e._uU(5," Create"),e.qZA()(),e.TgZ(6,"div",3),e.YNc(7,qe,2,4,"a",4),e.YNc(8,en,2,1,"ng-container",5),e.qZA(),e.TgZ(9,"div",6)(10,"h2"),e._uU(11,"History"),e.qZA(),e.TgZ(12,"div",3),e.YNc(13,rn,2,1,"ng-container",5),e.qZA()()(),e.YNc(14,cn,7,5,"ng-template",null,7,e.W1O),e.YNc(16,ln,6,3,"ng-template",null,8,e.W1O)),2&o&&(e.xp6(7),e.Q6J("ngForOf",r.combatsInPreparation),e.xp6(1),e.Q6J("ngForOf",r.combats),e.xp6(5),e.Q6J("ngForOf",r.combats))},dependencies:[g.sg,g.O5,g.tP,k._L],encapsulation:2})}return i})();w.F0.prototype.toCombatSelection=function(){return this.navigate(["/","combat","selection"])};var pn=m(2181);class bt{static getAllyTargets(n,t){switch(n){case h.Ct.Self:return t;case h.Ct.OtherAlly:return"front"===t?"back":"front";case h.Ct.FrontAlly:return"front";case h.Ct.BackAlly:return"back";case h.Ct.AllAllies:return"both";case h.Ct.None:case h.Ct.FrontOpponent:case h.Ct.BackOpponent:case h.Ct.AllOpponents:return"none"}}static getEnemyTargets(n){switch(n){case h.Ct.FrontOpponent:return"front";case h.Ct.BackOpponent:return"back";case h.Ct.AllOpponents:return"both";case h.Ct.None:case h.Ct.Self:case h.Ct.OtherAlly:case h.Ct.FrontAlly:case h.Ct.BackAlly:case h.Ct.AllAllies:return"none"}}}var dn=m(5618),un=m(2748);const mn=function(i){return{"width.%":i,backgroundColor:"var(--health-color)"}},fn=function(i){return{"width.%":i,backgroundColor:"var(--shield-color)"}};let gn=(()=>{class i{constructor(){this._value=0,this._maxValue=0,this._shield=0,this.tooltipPlacement="bottom",this.healthPercent=0,this.shieldPercent=0,this.PerformanceObserverEntryList=PerformanceObserverEntryList}get value(){return this._value}set value(t){this._value=t,this.update()}get maxValue(){return this._maxValue}set maxValue(t){this._maxValue=t,this.update()}get shield(){return this._shield}set shield(t){this._shield=t,this.update()}update(){0===this._maxValue&&(this.healthPercent=0,this.shieldPercent=0,this.tooltip=void 0),this.healthPercent=100*Math.max(0,Math.min(this._value/this._maxValue,1)),this.shieldPercent=100*Math.max(0,Math.min(this._shield/this._maxValue,1)),this.tooltip=this._shield>0?`${this._value} (+ ${this._shield} / ${this._maxValue} HP`:`${this._value} / ${this._maxValue} HP`}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-health-bar"]],inputs:{value:"value",maxValue:"maxValue",shield:"shield",tooltipPlacement:"tooltipPlacement"},decls:3,vars:8,consts:[[1,"w-100","h-100","bg-dark","position-relative",3,"ngbTooltip","placement"],[1,"position-absolute","start-0","top-0","bottom-0","animate-width",3,"ngStyle"]],template:function(o,r){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"div",1)(2,"div",1),e.qZA()),2&o&&(e.Q6J("ngbTooltip",r.tooltip)("placement",r.tooltipPlacement),e.xp6(1),e.Q6J("ngStyle",e.VKq(4,mn,r.healthPercent)),e.xp6(1),e.Q6J("ngStyle",e.VKq(6,fn,r.shieldPercent)))},dependencies:[g.PC,k._L],styles:[".animate-width[_ngcontent-%COMP%]{transition:width .25s}"]})}return i})();var D=m(7339),_n=m(9569);class bn{static getIcon(n){const t=this.getIconFromKnownEnchantment(n.name);if(t)return t;const o=this.getIconFromPassives(n.passive);if(o)return o;return this.getIconFromTriggered(n.triggered)||void 0}static getIconFromKnownEnchantment(n){if("burn"===n.toLowerCase())return"fire"}static getIconFromPassives(n){for(const t of n){if(t instanceof h.eH)return D.I.getIcon(t.type);if(t instanceof h.F)return D.I.getIcon(t.type)}}static getIconFromTriggered(n){for(const t of n){const o=_n.X.getIcon(t.effect);if(o)return o}}}var Cn=m(5811),vn=m(36);function yn(i,n){1&i&&e.GkF(0)}function Sn(i,n){if(1&i&&(e.TgZ(0,"div",6)(1,"span",7),e._uU(2),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.hij(" ",t.duration," ")}}function wn(i,n){if(1&i&&e._UZ(0,"app-asset-icon",10),2&i){const t=e.oxw(2);e.Q6J("icon",t.icon)("size",t.iconSize)}}function xn(i,n){if(1&i&&(e.TgZ(0,"div",11)(1,"i"),e._uU(2),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(2),e.Oqu(t.name[0])}}function Tn(i,n){if(1&i&&(e.YNc(0,wn,1,2,"app-asset-icon",8),e.YNc(1,xn,3,1,"div",9)),2&i){const t=e.oxw();e.Q6J("ngIf",t.icon),e.xp6(1),e.Q6J("ngIf",!t.icon)}}function kn(i,n){1&i&&e.GkF(0)}function In(i,n){if(1&i&&(e.TgZ(0,"div",12),e.YNc(1,kn,1,0,"ng-container",1),e._uU(2),e.qZA()),2&i){const t=e.oxw(),o=e.MAs(4);e.xp6(1),e.Q6J("ngTemplateOutlet",o),e.xp6(1),e.hij(" ",t.name," ")}}function En(i,n){1&i&&e.Hsn(0)}const Pn=function(i,n){return{"width.px":i,"height.px":n}},An=["*"];let Zn=(()=>{class i{constructor(){this._name="",this._duration=0,this._size="md",this.sizeInPx=this.getSize(this._size),this.iconSize=this.getIconSize(this._size),this.popoverVisible=!1}get name(){return this._name}set name(t){this._name=t,this.tooltip=this.getTooltip(this._name,this._duration)}get duration(){return this._duration}set duration(t){this._duration=t,this.tooltip=this.getTooltip(this._name,this._duration)}get size(){return this._size}set size(t){this._size=t,this.sizeInPx=this.getSize(t)}getSize(t){switch(t){case"sm":return 16;case"md":return 32;case"lg":case"xl":return 64}}getIconSize(t){switch(t){case"sm":return"xs";case"md":return"sm";case"lg":return"md";case"xl":return"lg"}}getTooltip(t,o){return o?`${t} (${o} turns)`:t}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-combat-effect"]],inputs:{icon:"icon",name:"name",duration:"duration",size:"size",source:"source"},ngContentSelectors:An,decls:9,vars:8,consts:[[1,"border","border-1","d-flex","align-items-center","justify-content-center","user-select-none","position-relative",3,"ngStyle","stickyPopover","popoverTitle","shown","hidden"],[4,"ngTemplateOutlet"],["class","small bg-white border border-secondary-subtle rounded-circle p-2 position-absolute start-100 top-100 translate-middle",4,"ngIf"],["iconTpl",""],["popoverTitle",""],["popoverBody",""],[1,"small","bg-white","border","border-secondary-subtle","rounded-circle","p-2","position-absolute","start-100","top-100","translate-middle"],[1,"small","position-absolute","translate-middle"],[3,"icon","size",4,"ngIf"],["class","fw-bold small",4,"ngIf"],[3,"icon","size"],[1,"fw-bold","small"],[1,"hstack","gap-2"]],template:function(o,r){if(1&o&&(e.F$t(),e.TgZ(0,"div",0),e.NdJ("shown",function(){return r.popoverVisible=!0})("hidden",function(){return r.popoverVisible=!1}),e.YNc(1,yn,1,0,"ng-container",1),e.YNc(2,Sn,3,1,"div",2),e.qZA(),e.YNc(3,Tn,2,2,"ng-template",null,3,e.W1O),e.YNc(5,In,3,2,"ng-template",null,4,e.W1O),e.YNc(7,En,1,0,"ng-template",null,5,e.W1O)),2&o){const s=e.MAs(4),c=e.MAs(6),l=e.MAs(8);e.Q6J("ngStyle",e.WLB(5,Pn,r.sizeInPx,r.sizeInPx))("stickyPopover",l)("popoverTitle",c),e.xp6(1),e.Q6J("ngTemplateOutlet",s),e.xp6(1),e.Q6J("ngIf",r.duration)}},dependencies:[g.O5,g.tP,g.PC,Cn.r,vn.t],encapsulation:2})}return i})();var Dn=m(1200);function Nn(i,n){if(1&i&&e._UZ(0,"app-passive-effect-line",1),2&i){const t=e.oxw();e.Q6J("effect",t.effect.effect)("overrideDuration",t.effect.remainingDuration)}}let On=(()=>{class i{get effect(){return this._effect}set effect(t){this._effect=t,this.update()}update(){this.icon=void 0,this.name=void 0,this._effect&&(this._effect.effect instanceof h.eH||this._effect.effect instanceof h.F)&&(this.icon=D.I.getIcon(this._effect.effect.type),this.name=D.I.getName(this._effect.effect.type))}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-passive-effect-instance-line"]],inputs:{effect:"effect"},decls:1,vars:1,consts:[[3,"effect","overrideDuration",4,"ngIf"],[3,"effect","overrideDuration"]],template:function(o,r){1&o&&e.YNc(0,Nn,1,2,"app-passive-effect-line",0),2&o&&e.Q6J("ngIf",r.effect)},dependencies:[g.O5,Dn.D],encapsulation:2})}return i})();var Un=m(4123);function Rn(i,n){if(1&i&&(e.TgZ(0,"div",1)(1,"div"),e._uU(2),e.qZA(),e._UZ(3,"app-active-effect-line",2),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.hij("",t.triggerString,":"),e.xp6(1),e.Q6J("effect",t.effect.effect.effect)}}let Jn=(()=>{class i{get effect(){return this._effect}set effect(t){this._effect=t,this.update()}update(){this.triggerString=void 0,this._effect&&this._effect.triggerState instanceof h.ZX&&this._effect.effect.trigger instanceof h.RR&&(this.triggerString=this.computeTurnTriggerString(this._effect.source.name,this._effect.triggerState,this._effect.effect.trigger),this.duration=this._effect.triggerState.triggersIn>0?this._effect.triggerState.triggersIn:this._effect.triggerState.remainingDuration)}computeTurnTriggerString(t,o,r){let s="";switch(r.moment){case h.ko.StartOfSourceTurn:s="start of "+t+" turn";break;case h.ko.EndOfSourceTurn:s="end of "+t+" turn";break;case h.ko.StartOfTargetTurn:s="start of turn";break;case h.ko.EndOfTargetTurn:s="end of turn"}return o.triggersIn>0?o.remainingDuration>1?`in ${o.triggersIn} turns, every ${s} for ${o.remainingDuration} turns`:`in ${o.triggersIn} turns, at `+s:o.remainingDuration>0?`every ${s} for ${o.remainingDuration} turns`:void 0}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-triggered-effect-instance-line"]],inputs:{effect:"effect"},decls:1,vars:1,consts:[["class","vstack",4,"ngIf"],[1,"vstack"],[3,"effect"]],template:function(o,r){1&o&&e.YNc(0,Rn,4,2,"div",0),2&o&&e.Q6J("ngIf",r.effect)},dependencies:[g.O5,Un.S],encapsulation:2})}return i})();function $n(i,n){1&i&&e._UZ(0,"app-passive-effect-instance-line",3),2&i&&e.Q6J("effect",n.$implicit)}function Mn(i,n){1&i&&e._UZ(0,"app-triggered-effect-instance-line",3),2&i&&e.Q6J("effect",n.$implicit)}function Fn(i,n){if(1&i&&(e.TgZ(0,"app-combat-effect",1),e.YNc(1,$n,1,1,"app-passive-effect-instance-line",2),e.YNc(2,Mn,1,1,"app-triggered-effect-instance-line",2),e.qZA()),2&i){const t=e.oxw();e.Q6J("name",t.effect.enchantment.name)("icon",t.icon)("duration",t.duration),e.xp6(1),e.Q6J("ngForOf",t.effect.passive),e.xp6(1),e.Q6J("ngForOf",t.effect.triggered)}}let Qn=(()=>{class i{get effect(){return this._effect}set effect(t){this._effect=t,this.update()}update(){if(!this._effect)return this.icon=void 0,void(this.duration=void 0);this.icon=bn.getIcon(this._effect.enchantment);let t=0;for(const o of this._effect.passive)t=Math.max(t,o.remainingDuration);for(const o of this._effect.triggered)o.triggerState instanceof h.ZX&&(t=Math.max(t,o.triggerState.triggersIn+o.triggerState.remainingDuration));this.duration=t>0?t:void 0}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-enchantment-effect-instance"]],inputs:{effect:"effect"},decls:1,vars:1,consts:[[3,"name","icon","duration",4,"ngIf"],[3,"name","icon","duration"],[3,"effect",4,"ngFor","ngForOf"],[3,"effect"]],template:function(o,r){1&o&&e.YNc(0,Fn,3,5,"app-combat-effect",0),2&o&&e.Q6J("ngIf",r.effect)},dependencies:[g.sg,g.O5,Zn,On,Jn],encapsulation:2})}return i})();function Hn(i,n){1&i&&e.GkF(0)}function Ln(i,n){if(1&i&&(e.TgZ(0,"div",3),e.YNc(1,Hn,1,0,"ng-container",4),e.qZA()),2&i){e.oxw();const t=e.MAs(3);e.xp6(1),e.Q6J("ngTemplateOutlet",t)}}function jn(i,n){1&i&&e.GkF(0)}function Yn(i,n){if(1&i&&(e.TgZ(0,"div",5),e.YNc(1,jn,1,0,"ng-container",4),e.qZA()),2&i){e.oxw();const t=e.MAs(3);e.xp6(1),e.Q6J("ngTemplateOutlet",t)}}function zn(i,n){1&i&&e._UZ(0,"app-enchantment-effect-instance",7),2&i&&e.Q6J("effect",n.$implicit)}function Wn(i,n){if(1&i&&e.YNc(0,zn,1,1,"app-enchantment-effect-instance",6),2&i){const t=e.oxw();e.Q6J("ngForOf",null==t.character?null:t.character.enchantments)}}let Bn=(()=>{class i{constructor(){this.size="md",this.mode="row"}get character(){return this._character}set character(t){this._character=t,this.update()}update(){}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-character-combat-effects"]],inputs:{character:"character",size:"size",mode:"mode"},decls:4,vars:2,consts:[["class","h-100 d-flex flex-column flex-wrap gap-1",4,"ngIf"],["class","w-100 d-flex flex-wrap flex-wrap-reverse gap-1",4,"ngIf"],["content",""],[1,"h-100","d-flex","flex-column","flex-wrap","gap-1"],[4,"ngTemplateOutlet"],[1,"w-100","d-flex","flex-wrap","flex-wrap-reverse","gap-1"],[3,"effect",4,"ngFor","ngForOf"],[3,"effect"]],template:function(o,r){1&o&&(e.YNc(0,Ln,2,1,"div",0),e.YNc(1,Yn,2,1,"div",1),e.YNc(2,Wn,1,1,"ng-template",null,2,e.W1O)),2&o&&(e.Q6J("ngIf","col"===r.mode),e.xp6(1),e.Q6J("ngIf","row"===r.mode))},dependencies:[g.sg,g.O5,g.tP,Qn],styles:["[_nghost-%COMP%]{display:contents}"]})}return i})();const Ct=function(i){return{boxShadow:i}};function Kn(i,n){if(1&i&&e._UZ(0,"div",10),2&i){const t=e.oxw(2);e.Q6J("ngStyle",e.VKq(1,Ct,t.innerShadowCssValue))}}function Vn(i,n){if(1&i&&e._UZ(0,"div",10),2&i){const t=e.oxw(2);e.Q6J("ngStyle",e.VKq(1,Ct,t.outerShadowCssValue))}}function Gn(i,n){if(1&i&&(e.ynx(0),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3),e._UZ(4,"app-character-combat-effects",4),e.qZA(),e.TgZ(5,"div",5)(6,"div",6),e._UZ(7,"app-character-img",7),e.YNc(8,Kn,1,3,"div",8),e.YNc(9,Vn,1,3,"div",8),e.qZA(),e._UZ(10,"app-health-bar",9),e.qZA()()(),e.BQk()),2&i){const t=e.oxw();e.xp6(2),e.ekj("flex-column-reverse",t.invert),e.xp6(2),e.Q6J("character",t.character)("size",t.size),e.xp6(3),e.Q6J("character",t.character.character)("size",t.size)("enablePopoverDetails",!0)("popoverPlacement",t.popoverPlacement)("footer",t.footer),e.xp6(1),e.Q6J("ngIf",t.innerShadowCssValue),e.xp6(1),e.Q6J("ngIf",t.outerShadowCssValue),e.xp6(1),e.Q6J("value",t.character.health)("maxValue",t.character.character.statistics.maxHealth)("shield",t.character.shield)}}let qn=(()=>{class i{constructor(){this.size="md",this.popoverPlacement="auto",this.invert=!1,this.innerShadowCssValue=this.getShadowCssValue(this.innerShadow,"inset "),this.outerShadowCssValue=this.getShadowCssValue(this.outerShadow)}get innerShadow(){return this._innerShadow}set innerShadow(t){this._innerShadow=t,this.innerShadowCssValue=this.getShadowCssValue(t,"inset ")}get outerShadow(){return this._outerShadow}set outerShadow(t){this._outerShadow=t,this.outerShadowCssValue=this.getShadowCssValue(t)}getShadowCssValue(t,o){if(!t)return;const r=(0,un.p)(t.color);return(o??"")+`0 0 ${t.blurInRem}rem ${r}`}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-combat-character-img"]],inputs:{character:"character",size:"size",popoverPlacement:"popoverPlacement",footer:"footer",invert:"invert",innerShadow:"innerShadow",outerShadow:"outerShadow"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"d-flex"],[1,"vstack","gap-1"],[1,"w-100","z-3"],["mode","row",3,"character","size"],[1,"vstack"],[1,"position-relative"],[3,"character","size","enablePopoverDetails","popoverPlacement","footer"],["class","position-absolute top-0 bottom-0 start-0 end-0",3,"ngStyle",4,"ngIf"],[1,"w-100",2,"height","0.5rem",3,"value","maxValue","shield"],[1,"position-absolute","top-0","bottom-0","start-0","end-0",3,"ngStyle"]],template:function(o,r){1&o&&e.YNc(0,Gn,11,14,"ng-container",0),2&o&&e.Q6J("ngIf",r.character)},dependencies:[g.O5,g.PC,W.o,gn,Bn],encapsulation:2})}return i})();const vt=function(){return{blurInRem:3,color:"color-mix(in srgb, var(--self-color) 17.5%, transparent)"}},yt=function(){return{blurInRem:3,color:"color-mix(in srgb, var(--enemy-color) 17.5%, transparent)"}},St=function(){return{blurInRem:3,color:"color-mix(in srgb, var(--ally-color) 17.5%, transparent)"}};function no(i,n){if(1&i&&e._UZ(0,"app-combat-character-img",13),2&i){const t=e.oxw(2);e.Q6J("character",t.side.backCharacter)("innerShadow",t.highlightSource===t.side.backCharacter.character.identity.name?e.DdM(4,vt):void 0)("outerShadow",t.highlightEnemies.includes(t.side.backCharacter.character.identity.name)?e.DdM(5,yt):t.highlightAllies.includes(t.side.backCharacter.character.identity.name)?e.DdM(6,St):void 0)("invert",t.invert)}}function oo(i,n){if(1&i&&e._UZ(0,"app-combat-character-img",14),2&i){const t=e.oxw(2);e.Q6J("character",t.side.frontCharacter)("innerShadow",t.highlightSource===t.side.frontCharacter.character.identity.name?e.DdM(4,vt):void 0)("outerShadow",t.highlightEnemies.includes(t.side.frontCharacter.character.identity.name)?e.DdM(5,yt):t.highlightAllies.includes(t.side.frontCharacter.character.identity.name)?e.DdM(6,St):void 0)("invert",t.invert)}}function io(i,n){1&i&&e._UZ(0,"i",15),2&i&&e.ekj("text-secondary","empty"===n.$implicit)("text-primary","filled")}function ro(i,n){1&i&&e._UZ(0,"i",16)}function so(i,n){if(1&i&&(e.ynx(0),e.TgZ(1,"div",1)(2,"div",2),e.YNc(3,no,1,7,"app-combat-character-img",3),e.YNc(4,oo,1,7,"app-combat-character-img",4),e.qZA(),e.TgZ(5,"div",5)(6,"div",6)(7,"div",7),e._UZ(8,"app-action-points-icon"),e.TgZ(9,"div",8),e._uU(10),e.qZA(),e.TgZ(11,"div",9),e.YNc(12,io,1,4,"i",10),e.qZA()(),e.TgZ(13,"div",7)(14,"i",11),e._uU(15),e.qZA(),e.YNc(16,ro,1,0,"i",12),e.qZA()()()(),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.ekj("flex-row-reverse",t.invert),e.xp6(1),e.ekj("flex-row-reverse",t.invert),e.xp6(1),e.Q6J("ngIf",t.side.backCharacter),e.xp6(1),e.Q6J("ngIf",t.side.frontCharacter),e.xp6(1),e.ekj("flex-column-reverse",t.invert),e.xp6(1),e.ekj("flex-row-reverse",t.invert),e.xp6(4),e.AsE("",t.side.ap,"/",t.combat.maxAp,""),e.xp6(2),e.Q6J("ngForOf",t.aps),e.xp6(3),e.Oqu(t.side.playerName),e.xp6(1),e.Q6J("ngIf",t.isAi)}}let ao=(()=>{class i{constructor(){this.isAi=!1,this.highlightEnemies=[],this.highlightAllies=[],this.invert=!1,this.aps=[]}get combat(){return this._combat}set combat(t){this._combat=t,this.update()}get side(){return this._side}set side(t){this._side=t,this.update()}update(){this.updateAps()}updateAps(){if(this.aps=[],this._combat&&this._side)for(let t=0;t<this._combat.maxAp;t++)this.aps.push(t<this._side.ap?"filled":"empty")}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-combat-side-common-elements"]],inputs:{combat:"combat",side:"side",isAi:"isAi",highlightSource:"highlightSource",highlightEnemies:"highlightEnemies",highlightAllies:"highlightAllies",invert:"invert"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"h-100","container-fluid","hstack"],[1,"hstack","w-50","justify-content-around"],["footer","Back","size","xl",3,"character","innerShadow","outerShadow","invert",4,"ngIf"],["footer","Front","size","xl",3,"character","innerShadow","outerShadow","invert",4,"ngIf"],[1,"w-50","vstack","justify-content-end"],[1,"hstack","m-4","gap-4","align-items-center","justify-content-end"],[1,"hstack","gap-2"],[1,"me-2"],[1,"hstack"],["class","bi bi-diamond-fill",3,"text-secondary","text-primary",4,"ngFor","ngForOf"],[1,"text-truncate","fw-bold","fs-3"],["class","bi bi-cpu","ngbTooltip","AI Player",4,"ngIf"],["footer","Back","size","xl",3,"character","innerShadow","outerShadow","invert"],["footer","Front","size","xl",3,"character","innerShadow","outerShadow","invert"],[1,"bi","bi-diamond-fill"],["ngbTooltip","AI Player",1,"bi","bi-cpu"]],template:function(o,r){1&o&&e.YNc(0,so,17,15,"ng-container",0),2&o&&e.Q6J("ngIf",r.combat&&r.side)},dependencies:[g.sg,g.O5,dn.W,k._L,qn],styles:[".highlight-source[_ngcontent-%COMP%]{box-shadow:inset 0 0 3rem color-mix(in srgb,var(--self-color) 17.5%,transparent)}.highlight-ally[_ngcontent-%COMP%]{box-shadow:0 0 6rem color-mix(in srgb,var(--ally-color) 17.5%,transparent)}.highlight-enemy[_ngcontent-%COMP%]{box-shadow:0 0 6rem color-mix(in srgb,var(--enemy-color) 17.5%,transparent)}"]})}return i})();var co=m(6907);function lo(i,n){if(1&i&&e._UZ(0,"app-character-img",3),2&i){const t=e.oxw();e.Q6J("character",t.character)}}let ho=(()=>{class i{constructor(){this.size="md",this._characters=[]}get card(){return this._card}set card(t){this._card=t,this.update()}get characters(){return this._characters}set characters(t){this._characters=t,this.update()}update(){this.character=this._card?this._characters.find(t=>t.identity.name===this._card.character):void 0}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-action-card-instance"]],inputs:{card:"card",size:"size",characters:"characters"},decls:3,vars:3,consts:[[1,"h-100","position-relative"],[3,"card","size"],["class","position-absolute bottom-0 end-0 m-2","size","sm",3,"character",4,"ngIf"],["size","sm",1,"position-absolute","bottom-0","end-0","m-2",3,"character"]],template:function(o,r){1&o&&(e.TgZ(0,"div",0),e._UZ(1,"app-action-card",1),e.YNc(2,lo,1,1,"app-character-img",2),e.qZA()),2&o&&(e.xp6(1),e.Q6J("card",null==r.card?null:r.card.card)("size",r.size),e.xp6(1),e.Q6J("ngIf",r.character))},dependencies:[g.O5,W.o,co.o],encapsulation:2})}return i})();function po(i,n){1&i&&e._UZ(0,"div",8)}function uo(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){const s=e.CHM(t).index,c=e.oxw(2);return e.KtG(c.sendPlay(s))}),e.TgZ(1,"app-action-card-instance",6),e.NdJ("mouseenter",function(){const s=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.mouseEnter(s))})("mouseleave",function(){const s=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.mouseLeave(s))}),e.qZA(),e.YNc(2,po,1,0,"div",7),e.qZA()}if(2&i){const t=n.$implicit,o=e.oxw(2);e.ekj("highlight",o.hoveredCharacter===t.character),e.xp6(1),e.Q6J("card",t)("characters",o.characters),e.xp6(1),e.Q6J("ngIf",o.disabled||t.card.apCost>o.combat.player.ap)}}function mo(i,n){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",1)(2,"div",2),e.YNc(3,uo,3,5,"button",3),e.qZA(),e.TgZ(4,"button",4),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.sendEndTurn())}),e._uU(5," End Turn "),e.qZA()(),e.BQk()}if(2&i){const t=e.oxw();e.xp6(3),e.Q6J("ngForOf",t.combat.player.hand),e.xp6(1),e.ekj("btn-primary",t.combat.currentSide===t.combat.player.side)("btn-disabled",t.combat.currentSide!==t.combat.player.side),e.Q6J("disabled",t.disabled)}}let fo=(()=>{class i{get disabled(){return this._disabled}set disabled(t){this._disabled=t,this.clearMouseHover()}constructor(t){this.charactersService=t,this._disabled=!1,this.play=new e.vpe,this.endTurn=new e.vpe,this.hover=new e.vpe,this.characters=[],this.CombatSide=h.E1}ngOnInit(){this.charactersService.getAll().subscribe(t=>this.characters=t)}sendPlay(t){this.disabled||this.play.emit(t)}sendEndTurn(){this.disabled||this.endTurn.emit()}mouseEnter(t){this.hoveredCharacter=t.character,this.hover.emit(t)}mouseLeave(t){this.hoveredCharacter===t.character&&this.clearMouseHover()}clearMouseHover(){this.hoveredCharacter=void 0,this.hover.emit(void 0)}static#t=this.\u0275fac=function(o){return new(o||i)(e.Y36(h.R))};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-player-side-elements"]],inputs:{combat:"combat",disabled:"disabled"},outputs:{play:"play",endTurn:"endTurn",hover:"hover"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"h-100","w-100","container-fluid","hstack","p-4"],[1,"flex-fill","hstack","justify-content-center","gap-2"],["class","btn m-0 p-0 position-relative","style","height: 100%; width: 175px",3,"highlight","click",4,"ngFor","ngForOf"],[1,"btn","p-4",3,"disabled","click"],[1,"btn","m-0","p-0","position-relative",2,"height","100%","width","175px",3,"click"],["size","sm",3,"card","characters","mouseenter","mouseleave"],["class","rounded-3 position-absolute top-0 bottom-0 start-0 end-0 pe-none","style","background-color: rgba(0, 0, 0, 0.05)",4,"ngIf"],[1,"rounded-3","position-absolute","top-0","bottom-0","start-0","end-0","pe-none",2,"background-color","rgba(0, 0, 0, 0.05)"]],template:function(o,r){1&o&&e.YNc(0,mo,6,6,"ng-container",0),2&o&&e.Q6J("ngIf",r.combat)},dependencies:[g.sg,g.O5,ho],styles:[".highlight[_ngcontent-%COMP%]{box-shadow:0 .5rem 1rem #0000002d}"]})}return i})();function go(i,n){if(1&i&&(e.TgZ(0,"i",6),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Oqu(t.currentPlayer)}}const _o=function(){return["..","selection"]};function bo(i,n){1&i&&(e.TgZ(0,"button",7),e._uU(1,"Leave"),e.qZA()),2&i&&e.Q6J("routerLink",e.DdM(1,_o))}function Co(i,n){if(1&i&&(e.TgZ(0,"div",8)(1,"span",9),e._uU(2,"Combat over"),e.qZA(),e.TgZ(3,"span",10),e._uU(4),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(4),e.hij(" ",t.combat.winner===t.combat.player.side?"You WON!":"You LOST!"," ")}}function vo(i,n){if(1&i&&(e.TgZ(0,"div",1),e.YNc(1,go,2,1,"i",2),e.YNc(2,bo,2,2,"button",3),e._UZ(3,"div",4),e.YNc(4,Co,5,1,"div",5),e._UZ(5,"div",4),e.TgZ(6,"h2"),e._uU(7),e.qZA()()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.currentPlayer),e.xp6(1),e.Q6J("ngIf",t.combat.over),e.xp6(2),e.Q6J("ngIf",t.combat.over),e.xp6(3),e.hij("Turn ",t.combat.turn,"")}}let yo=(()=>{class i{constructor(){this.TurnTriggerView=h.RR}get combat(){return this._combat}set combat(t){this._combat=t,this.update()}update(){this.currentPlayer=this._combat?this._combat.currentSide==h.E1.Left?this._combat.leftPlayerName:this._combat.currentSide==h.E1.Right?this._combat.rightPlayerName:void 0:void 0}static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-combat-common-elements"]],inputs:{combat:"combat"},decls:1,vars:1,consts:[["class","hstack gap-2 position-relative",4,"ngIf"],[1,"hstack","gap-2","position-relative"],["class","fw-bold fs-4",4,"ngIf"],["class","btn btn-outline-secondary",3,"routerLink",4,"ngIf"],[1,"flex-fill"],["class","position-absolute top-0 bottom-0 start-0 end-0 d-flex flex-column justify-content-center align-items-center pe-none",4,"ngIf"],[1,"fw-bold","fs-4"],[1,"btn","btn-outline-secondary",3,"routerLink"],[1,"position-absolute","top-0","bottom-0","start-0","end-0","d-flex","flex-column","justify-content-center","align-items-center","pe-none"],[1,"pe-auto"],[1,"fw-bold","fs-2","pe-auto"]],template:function(o,r){1&o&&e.YNc(0,vo,8,4,"div",0),2&o&&e.Q6J("ngIf",r.combat)},dependencies:[g.O5,w.rH],encapsulation:2})}return i})();const wt=function(){return{"height.%":35}};function So(i,n){if(1&i){const t=e.EpF();e.TgZ(0,"div",1)(1,"div",2),e._UZ(2,"app-combat-side-common-elements",3),e.qZA(),e._UZ(3,"hr")(4,"app-combat-common-elements",4)(5,"hr"),e.TgZ(6,"div",2),e._UZ(7,"app-combat-side-common-elements",5),e.qZA(),e.TgZ(8,"div",6)(9,"app-player-side-elements",7),e.NdJ("play",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.play(r))})("endTurn",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.endTurn())})("hover",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.hoverCard(r))}),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngStyle",e.DdM(15,wt)),e.xp6(1),e.Q6J("combat",t.combat)("side",t.combat.opponent)("isAi",t.combat.opponentIsAi)("highlightEnemies",t.enemyTargets)("invert",!0),e.xp6(2),e.Q6J("combat",t.combat),e.xp6(2),e.Q6J("ngStyle",e.DdM(16,wt)),e.xp6(1),e.Q6J("combat",t.combat)("side",t.combat.player)("isAi",t.combat.playerIsAi)("highlightAllies",t.allyTargets)("highlightSource",t.source),e.xp6(2),e.Q6J("combat",t.combat)("disabled",t.combat.currentSide!==t.combat.player.side||t.combat.over)}}let wo=(()=>{class i{constructor(t,o,r,s,c){this.identityService=t,this.signalrService=o,this.combatsService=r,this.activatedRoute=s,this.router=c,this.allyTargets=[],this.enemyTargets=[],this.CombatSide=h.E1}ngOnInit(){const t=this.identityService.getIdentity();this.signalrService.listen("combats","CombatUpdated",h.LS.fromJS).subscribe(o=>this.combat=o),this.signalrService.listen("combats","CombatEnded",h.LS.fromJS).subscribe(o=>this.combat=o),this.activatedRoute.paramMap.pipe((0,A.w)(o=>{const r=o.get("id");return null==r?(this.router.to404().then(),(0,$.of)(void 0)):this.combatsService.getCombat(r,t)}),(0,M.K)(o=>(console.error(o),(0,O.D)(this.router.to404().then(r=>{})))),(0,pn.h)(Boolean),(0,P.U)(o=>this.combat=o)).subscribe()}play(t){if(!this.combat||this.combat.currentSide!==this.combat.player.side)return;const o=this.combat.player.hand[t];!o||o.card.apCost>this.combat.player.ap||this.combatsService.playCard(this.combat.id,t,this.identityService.getIdentity()).subscribe()}endTurn(){!this.combat||this.combat.currentSide!==this.combat.player.side||this.combatsService.endTurn(this.combat.id,this.identityService.getIdentity()).subscribe()}hoverCard(t){if(this.source=void 0,this.allyTargets=[],this.enemyTargets=[],t&&this.combat){switch(this.source=t.character,bt.getAllyTargets(t.card.target,t.character===this.combat.player.frontCharacter?.character.identity.name?"front":"back")){case"none":break;case"front":this.combat.player.frontCharacter&&this.allyTargets.push(this.combat.player.frontCharacter.character.identity.name);break;case"back":this.combat.player.backCharacter&&this.allyTargets.push(this.combat.player.backCharacter.character.identity.name);break;case"both":this.combat.player.frontCharacter&&this.allyTargets.push(this.combat.player.frontCharacter.character.identity.name),this.combat.player.backCharacter&&this.allyTargets.push(this.combat.player.backCharacter.character.identity.name)}switch(bt.getEnemyTargets(t.card.target)){case"none":break;case"front":this.combat.opponent.frontCharacter&&this.enemyTargets.push(this.combat.opponent.frontCharacter.character.identity.name);break;case"back":this.combat.opponent.backCharacter&&this.enemyTargets.push(this.combat.opponent.backCharacter.character.identity.name);break;case"both":this.combat.opponent.frontCharacter&&this.enemyTargets.push(this.combat.opponent.frontCharacter.character.identity.name),this.combat.opponent.backCharacter&&this.enemyTargets.push(this.combat.opponent.backCharacter.character.identity.name)}}}static#t=this.\u0275fac=function(o){return new(o||i)(e.Y36(R.P),e.Y36(gt),e.Y36(h.cP),e.Y36(w.gz),e.Y36(w.F0))};static#e=this.\u0275cmp=e.Xpm({type:i,selectors:[["app-combat"]],decls:1,vars:1,consts:[["class","h-100 container-lg vstack",4,"ngIf"],[1,"h-100","container-lg","vstack"],[3,"ngStyle"],[3,"combat","side","isAi","highlightEnemies","invert"],[3,"combat"],[3,"combat","side","isAi","highlightAllies","highlightSource"],[1,"flex-fill"],[3,"combat","disabled","play","endTurn","hover"]],template:function(o,r){1&o&&e.YNc(0,So,10,17,"div",0),2&o&&e.Q6J("ngIf",r.combat)},dependencies:[g.O5,g.PC,ao,fo,yo],encapsulation:2})}return i})();w.F0.prototype.toCombat=function(i){return this.navigate(["/","combat",i])};const xo=[{path:"",pathMatch:"full",redirectTo:"selection"},{path:"configure/:id",component:B},{path:"join/:id",component:Be},{path:"selection",component:hn},{path:":id",component:wo}];let To=(()=>{class i{static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[w.Bz.forChild(xo),w.Bz]})}return i})(),ko=(()=>{class i{static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[g.ez]})}return i})(),Io=(()=>{class i{static#t=this.\u0275fac=function(o){return new(o||i)};static#e=this.\u0275mod=e.oAB({type:i});static#n=this.\u0275inj=e.cJS({imports:[g.ez,q.I,To,E.u5,q.I,k.xm,ko]})}return i})()},8656:()=>{String.prototype.trimEndChars=function(...G){let I=this.length-1;for(;I>=0&&G.includes(this[I]);)I++;return this.substring(I)}}}]);