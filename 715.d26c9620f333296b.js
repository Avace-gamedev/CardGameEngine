"use strict";(self.webpackChunkpockedeck_battler=self.webpackChunkpockedeck_battler||[]).push([[715],{9715:(oe,k,d)=>{d.r(k),d.d(k,{CombatModule:()=>Oi});var u=d(6814),E=d(6223),T=d(5822),ie=d(2326),w=d(1076),Re=d(7582),Y=d(8645),Ue=d(7394),D=d(7715),e=(d(6232),d(9468)),Fe=(d(1631),d(9773));const Le=e.GuJ,$e=Symbol("__destroy"),se=Symbol("__decoratorApplied");function ae(o){return"string"==typeof o?Symbol(`__destroy__${o}`):$e}function ce(o,n){o[n]||(o[n]=new Y.x)}function le(o,n){o[n]&&(o[n].next(),o[n].complete(),o[n]=null)}function he(o){o instanceof Ue.w0&&o.unsubscribe()}function pe(o,n){return function(){if(o&&o.call(this),le(this,ae()),n.arrayName&&function He(o){Array.isArray(o)&&o.forEach(he)}(this[n.arrayName]),n.checkProperties)for(const t in this)n.blackList?.includes(t)||he(this[t])}}Symbol("CheckerHasBeenSet");function q(o,n){return t=>{const i=ae(n);"string"==typeof n?function Ke(o,n,t){const i=o[n];ce(o,t),o[n]=function(){i.apply(this,arguments),le(this,t),o[n]=i}}(o,n,i):ce(o,i);const r=o[i];return t.pipe((0,Fe.R)(r))}}var Ve=d(4352),et=d(9360),tt=d(8251),Z=d(4664),$=d(2096),ot=d(8504),M=d(6306),P=d(7398),h=d(3107);const it=[0,2e3,1e4,3e4,null];class ue{constructor(n){this._retryDelays=void 0!==n?[...n,null]:it}nextRetryDelayInMilliseconds(n){return this._retryDelays[n.previousRetryCount]}}var v=d(5861);let J=(()=>{class o{}return o.Authorization="Authorization",o.Cookie="Cookie",o})();class _e{constructor(n,t,i){this.statusCode=n,this.statusText=t,this.content=i}}class H{get(n,t){return this.send({...t,method:"GET",url:n})}post(n,t){return this.send({...t,method:"POST",url:n})}delete(n,t){return this.send({...t,method:"DELETE",url:n})}getCookieString(n){return""}}class rt extends H{constructor(n,t){super(),this._innerClient=n,this._accessTokenFactory=t}send(n){var t=this;return(0,v.Z)(function*(){let i=!0;t._accessTokenFactory&&(!t._accessToken||n.url&&n.url.indexOf("/negotiate?")>0)&&(i=!1,t._accessToken=yield t._accessTokenFactory()),t._setAuthorizationHeader(n);const r=yield t._innerClient.send(n);return i&&401===r.statusCode&&t._accessTokenFactory?(t._accessToken=yield t._accessTokenFactory(),t._setAuthorizationHeader(n),yield t._innerClient.send(n)):r})()}_setAuthorizationHeader(n){n.headers||(n.headers={}),this._accessToken?n.headers[J.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&n.headers[J.Authorization]&&delete n.headers[J.Authorization]}getCookieString(n){return this._innerClient.getCookieString(n)}}class A extends Error{constructor(n,t){const i=new.target.prototype;super(`${n}: Status code '${t}'`),this.statusCode=t,this.__proto__=i}}class B extends Error{constructor(n="A timeout occurred."){const t=new.target.prototype;super(n),this.__proto__=t}}class I extends Error{constructor(n="An abort occurred."){const t=new.target.prototype;super(n),this.__proto__=t}}class st extends Error{constructor(n,t){const i=new.target.prototype;super(n),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=i}}class at extends Error{constructor(n,t){const i=new.target.prototype;super(n),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=i}}class ct extends Error{constructor(n,t){const i=new.target.prototype;super(n),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=i}}class lt extends Error{constructor(n){const t=new.target.prototype;super(n),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class ht extends Error{constructor(n,t){const i=new.target.prototype;super(n),this.innerErrors=t,this.__proto__=i}}var c=d(4351),f=d(8974);class pt extends H{constructor(n){if(super(),this._logger=n,typeof fetch>"u"){const t=require;this._jar=new(t("tough-cookie").CookieJar),this._fetchType=t("node-fetch"),this._fetchType=t("fetch-cookie")(this._fetchType,this._jar)}else this._fetchType=fetch.bind((0,f.E9)());if(typeof AbortController>"u"){const t=require;this._abortControllerType=t("abort-controller")}else this._abortControllerType=AbortController}send(n){var t=this;return(0,v.Z)(function*(){if(n.abortSignal&&n.abortSignal.aborted)throw new I;if(!n.method)throw new Error("No method defined.");if(!n.url)throw new Error("No url defined.");const i=new t._abortControllerType;let r;n.abortSignal&&(n.abortSignal.onabort=()=>{i.abort(),r=new I});let a,s=null;n.timeout&&(s=setTimeout(()=>{i.abort(),t._logger.log(c.i.Warning,"Timeout from HTTP request."),r=new B},n.timeout)),""===n.content&&(n.content=void 0),n.content&&(n.headers=n.headers||{},n.headers["Content-Type"]=(0,f.eP)(n.content)?"application/octet-stream":"text/plain;charset=UTF-8");try{a=yield t._fetchType(n.url,{body:n.content,cache:"no-cache",credentials:!0===n.withCredentials?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...n.headers},method:n.method,mode:"cors",redirect:"follow",signal:i.signal})}catch(m){throw r||(t._logger.log(c.i.Warning,`Error from HTTP request. ${m}.`),m)}finally{s&&clearTimeout(s),n.abortSignal&&(n.abortSignal.onabort=null)}if(!a.ok){const m=yield ge(a,"text");throw new A(m||a.statusText,a.status)}const p=yield ge(a,n.responseType);return new _e(a.status,a.statusText,p)})()}getCookieString(n){let t="";return f.t4.isNode&&this._jar&&this._jar.getCookies(n,(i,r)=>t=r.join("; ")),t}}function ge(o,n){let t;switch(n){case"arraybuffer":t=o.arrayBuffer();break;case"text":default:t=o.text();break;case"blob":case"document":case"json":throw new Error(`${n} is not supported.`)}return t}class dt extends H{constructor(n){super(),this._logger=n}send(n){return n.abortSignal&&n.abortSignal.aborted?Promise.reject(new I):n.method?n.url?new Promise((t,i)=>{const r=new XMLHttpRequest;r.open(n.method,n.url,!0),r.withCredentials=void 0===n.withCredentials||n.withCredentials,r.setRequestHeader("X-Requested-With","XMLHttpRequest"),""===n.content&&(n.content=void 0),n.content&&((0,f.eP)(n.content)?r.setRequestHeader("Content-Type","application/octet-stream"):r.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const s=n.headers;s&&Object.keys(s).forEach(a=>{r.setRequestHeader(a,s[a])}),n.responseType&&(r.responseType=n.responseType),n.abortSignal&&(n.abortSignal.onabort=()=>{r.abort(),i(new I)}),n.timeout&&(r.timeout=n.timeout),r.onload=()=>{n.abortSignal&&(n.abortSignal.onabort=null),r.status>=200&&r.status<300?t(new _e(r.status,r.statusText,r.response||r.responseText)):i(new A(r.response||r.responseText||r.statusText,r.status))},r.onerror=()=>{this._logger.log(c.i.Warning,`Error from HTTP request. ${r.status}: ${r.statusText}.`),i(new A(r.statusText,r.status))},r.ontimeout=()=>{this._logger.log(c.i.Warning,"Timeout from HTTP request."),i(new B)},r.send(n.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class mt extends H{constructor(n){if(super(),typeof fetch<"u"||f.t4.isNode)this._httpClient=new pt(n);else{if(!(typeof XMLHttpRequest<"u"))throw new Error("No usable HttpClient found.");this._httpClient=new dt(n)}}send(n){return n.abortSignal&&n.abortSignal.aborted?Promise.reject(new I):n.method?n.url?this._httpClient.send(n):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(n){return this._httpClient.getCookieString(n)}}var y=function(o){return o[o.None=0]="None",o[o.WebSockets=1]="WebSockets",o[o.ServerSentEvents=2]="ServerSentEvents",o[o.LongPolling=4]="LongPolling",o}(y||{}),x=function(o){return o[o.Text=1]="Text",o[o.Binary=2]="Binary",o}(x||{});class ft{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}}class be{constructor(n,t,i){this._httpClient=n,this._logger=t,this._pollAbort=new ft,this._options=i,this._running=!1,this.onreceive=null,this.onclose=null}get pollAborted(){return this._pollAbort.aborted}connect(n,t){var i=this;return(0,v.Z)(function*(){if(f.j7.isRequired(n,"url"),f.j7.isRequired(t,"transferFormat"),f.j7.isIn(t,x,"transferFormat"),i._url=n,i._logger.log(c.i.Trace,"(LongPolling transport) Connecting."),t===x.Binary&&typeof XMLHttpRequest<"u"&&"string"!=typeof(new XMLHttpRequest).responseType)throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[r,s]=(0,f.hS)(),a={[r]:s,...i._options.headers},l={abortSignal:i._pollAbort.signal,headers:a,timeout:1e5,withCredentials:i._options.withCredentials};t===x.Binary&&(l.responseType="arraybuffer");const p=`${n}&_=${Date.now()}`;i._logger.log(c.i.Trace,`(LongPolling transport) polling: ${p}.`);const m=yield i._httpClient.get(p,l);200!==m.statusCode?(i._logger.log(c.i.Error,`(LongPolling transport) Unexpected response code: ${m.statusCode}.`),i._closeError=new A(m.statusText||"",m.statusCode),i._running=!1):i._running=!0,i._receiving=i._poll(i._url,l)})()}_poll(n,t){var i=this;return(0,v.Z)(function*(){try{for(;i._running;)try{const r=`${n}&_=${Date.now()}`;i._logger.log(c.i.Trace,`(LongPolling transport) polling: ${r}.`);const s=yield i._httpClient.get(r,t);204===s.statusCode?(i._logger.log(c.i.Information,"(LongPolling transport) Poll terminated by server."),i._running=!1):200!==s.statusCode?(i._logger.log(c.i.Error,`(LongPolling transport) Unexpected response code: ${s.statusCode}.`),i._closeError=new A(s.statusText||"",s.statusCode),i._running=!1):s.content?(i._logger.log(c.i.Trace,`(LongPolling transport) data received. ${(0,f.o4)(s.content,i._options.logMessageContent)}.`),i.onreceive&&i.onreceive(s.content)):i._logger.log(c.i.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(r){i._running?r instanceof B?i._logger.log(c.i.Trace,"(LongPolling transport) Poll timed out, reissuing."):(i._closeError=r,i._running=!1):i._logger.log(c.i.Trace,`(LongPolling transport) Poll errored after shutdown: ${r.message}`)}}finally{i._logger.log(c.i.Trace,"(LongPolling transport) Polling complete."),i.pollAborted||i._raiseOnClose()}})()}send(n){var t=this;return(0,v.Z)(function*(){return t._running?(0,f.bG)(t._logger,"LongPolling",t._httpClient,t._url,n,t._options):Promise.reject(new Error("Cannot send until the transport is connected"))})()}stop(){var n=this;return(0,v.Z)(function*(){n._logger.log(c.i.Trace,"(LongPolling transport) Stopping polling."),n._running=!1,n._pollAbort.abort();try{yield n._receiving,n._logger.log(c.i.Trace,`(LongPolling transport) sending DELETE request to ${n._url}.`);const t={},[i,r]=(0,f.hS)();t[i]=r;const s={headers:{...t,...n._options.headers},timeout:n._options.timeout,withCredentials:n._options.withCredentials};yield n._httpClient.delete(n._url,s),n._logger.log(c.i.Trace,"(LongPolling transport) DELETE request sent.")}finally{n._logger.log(c.i.Trace,"(LongPolling transport) Stop finished."),n._raiseOnClose()}})()}_raiseOnClose(){if(this.onclose){let n="(LongPolling transport) Firing onclose event.";this._closeError&&(n+=" Error: "+this._closeError),this._logger.log(c.i.Trace,n),this.onclose(this._closeError)}}}class ut{constructor(n,t,i,r){this._httpClient=n,this._accessToken=t,this._logger=i,this._options=r,this.onreceive=null,this.onclose=null}connect(n,t){var i=this;return(0,v.Z)(function*(){return f.j7.isRequired(n,"url"),f.j7.isRequired(t,"transferFormat"),f.j7.isIn(t,x,"transferFormat"),i._logger.log(c.i.Trace,"(SSE transport) Connecting."),i._url=n,i._accessToken&&(n+=(n.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(i._accessToken)}`),new Promise((r,s)=>{let l,a=!1;if(t===x.Text){if(f.t4.isBrowser||f.t4.isWebWorker)l=new i._options.EventSource(n,{withCredentials:i._options.withCredentials});else{const p=i._httpClient.getCookieString(n),m={};m.Cookie=p;const[_,g]=(0,f.hS)();m[_]=g,l=new i._options.EventSource(n,{withCredentials:i._options.withCredentials,headers:{...m,...i._options.headers}})}try{l.onmessage=p=>{if(i.onreceive)try{i._logger.log(c.i.Trace,`(SSE transport) data received. ${(0,f.o4)(p.data,i._options.logMessageContent)}.`),i.onreceive(p.data)}catch(m){return void i._close(m)}},l.onerror=p=>{a?i._close():s(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},l.onopen=()=>{i._logger.log(c.i.Information,`SSE connected to ${i._url}`),i._eventSource=l,a=!0,r()}}catch(p){return void s(p)}}else s(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"))})})()}send(n){var t=this;return(0,v.Z)(function*(){return t._eventSource?(0,f.bG)(t._logger,"SSE",t._httpClient,t._url,n,t._options):Promise.reject(new Error("Cannot send until the transport is connected"))})()}stop(){return this._close(),Promise.resolve()}_close(n){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(n))}}class _t{constructor(n,t,i,r,s,a){this._logger=i,this._accessTokenFactory=t,this._logMessageContent=r,this._webSocketConstructor=s,this._httpClient=n,this.onreceive=null,this.onclose=null,this._headers=a}connect(n,t){var i=this;return(0,v.Z)(function*(){let r;return f.j7.isRequired(n,"url"),f.j7.isRequired(t,"transferFormat"),f.j7.isIn(t,x,"transferFormat"),i._logger.log(c.i.Trace,"(WebSockets transport) Connecting."),i._accessTokenFactory&&(r=yield i._accessTokenFactory()),new Promise((s,a)=>{let l;n=n.replace(/^http/,"ws");const p=i._httpClient.getCookieString(n);let m=!1;if(f.t4.isNode||f.t4.isReactNative){const _={},[g,O]=(0,f.hS)();_[g]=O,r&&(_[J.Authorization]=`Bearer ${r}`),p&&(_[J.Cookie]=p),l=new i._webSocketConstructor(n,void 0,{headers:{..._,...i._headers}})}else r&&(n+=(n.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`);l||(l=new i._webSocketConstructor(n)),t===x.Binary&&(l.binaryType="arraybuffer"),l.onopen=_=>{i._logger.log(c.i.Information,`WebSocket connected to ${n}.`),i._webSocket=l,m=!0,s()},l.onerror=_=>{let g=null;g=typeof ErrorEvent<"u"&&_ instanceof ErrorEvent?_.error:"There was an error with the transport",i._logger.log(c.i.Information,`(WebSockets transport) ${g}.`)},l.onmessage=_=>{if(i._logger.log(c.i.Trace,`(WebSockets transport) data received. ${(0,f.o4)(_.data,i._logMessageContent)}.`),i.onreceive)try{i.onreceive(_.data)}catch(g){return void i._close(g)}},l.onclose=_=>{if(m)i._close(_);else{let g=null;g=typeof ErrorEvent<"u"&&_ instanceof ErrorEvent?_.error:"WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",a(new Error(g))}}})})()}send(n){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(c.i.Trace,`(WebSockets transport) sending data. ${(0,f.o4)(n,this._logMessageContent)}.`),this._webSocket.send(n),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(n){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(c.i.Trace,"(WebSockets transport) socket closed."),this.onclose&&(!this._isCloseEvent(n)||!1!==n.wasClean&&1e3===n.code?n instanceof Error?this.onclose(n):this.onclose():this.onclose(new Error(`WebSocket closed with status code: ${n.code} (${n.reason||"no reason given"}).`)))}_isCloseEvent(n){return n&&"boolean"==typeof n.wasClean&&"number"==typeof n.code}}class gt{constructor(n,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,f.j7.isRequired(n,"url"),this._logger=(0,f.hu)(t.logger),this.baseUrl=this._resolveUrl(n),(t=t||{}).logMessageContent=void 0!==t.logMessageContent&&t.logMessageContent,"boolean"!=typeof t.withCredentials&&void 0!==t.withCredentials)throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.withCredentials=void 0===t.withCredentials||t.withCredentials,t.timeout=void 0===t.timeout?1e5:t.timeout;let i=null,r=null;if(f.t4.isNode){const s=require;i=s("ws"),r=s("eventsource")}!f.t4.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:f.t4.isNode&&!t.WebSocket&&i&&(t.WebSocket=i),!f.t4.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:f.t4.isNode&&!t.EventSource&&typeof r<"u"&&(t.EventSource=r),this._httpClient=new rt(t.httpClient||new mt(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}start(n){var t=this;return(0,v.Z)(function*(){if(f.j7.isIn(n=n||x.Binary,x,"transferFormat"),t._logger.log(c.i.Debug,`Starting connection with transfer format '${x[n]}'.`),"Disconnected"!==t._connectionState)return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(t._connectionState="Connecting",t._startInternalPromise=t._startInternal(n),yield t._startInternalPromise,"Disconnecting"===t._connectionState){const i="Failed to start the HttpConnection before stop() was called.";return t._logger.log(c.i.Error,i),yield t._stopPromise,Promise.reject(new I(i))}if("Connected"!==t._connectionState){const i="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return t._logger.log(c.i.Error,i),Promise.reject(new I(i))}t._connectionStarted=!0})()}send(n){return"Connected"!==this._connectionState?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new G(this.transport)),this._sendQueue.send(n))}stop(n){var t=this;return(0,v.Z)(function*(){return"Disconnected"===t._connectionState?(t._logger.log(c.i.Debug,`Call to HttpConnection.stop(${n}) ignored because the connection is already in the disconnected state.`),Promise.resolve()):"Disconnecting"===t._connectionState?(t._logger.log(c.i.Debug,`Call to HttpConnection.stop(${n}) ignored because the connection is already in the disconnecting state.`),t._stopPromise):(t._connectionState="Disconnecting",t._stopPromise=new Promise(i=>{t._stopPromiseResolver=i}),yield t._stopInternal(n),void(yield t._stopPromise))})()}_stopInternal(n){var t=this;return(0,v.Z)(function*(){t._stopError=n;try{yield t._startInternalPromise}catch{}if(t.transport){try{yield t.transport.stop()}catch(i){t._logger.log(c.i.Error,`HttpConnection.transport.stop() threw error '${i}'.`),t._stopConnection()}t.transport=void 0}else t._logger.log(c.i.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")})()}_startInternal(n){var t=this;return(0,v.Z)(function*(){let i=t.baseUrl;t._accessTokenFactory=t._options.accessTokenFactory,t._httpClient._accessTokenFactory=t._accessTokenFactory;try{if(t._options.skipNegotiation){if(t._options.transport!==y.WebSockets)throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");t.transport=t._constructTransport(y.WebSockets),yield t._startTransport(i,n)}else{let r=null,s=0;do{if(r=yield t._getNegotiationResponse(i),"Disconnecting"===t._connectionState||"Disconnected"===t._connectionState)throw new I("The connection was stopped during negotiation.");if(r.error)throw new Error(r.error);if(r.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(r.url&&(i=r.url),r.accessToken){const a=r.accessToken;t._accessTokenFactory=()=>a,t._httpClient._accessToken=a,t._httpClient._accessTokenFactory=void 0}s++}while(r.url&&s<100);if(100===s&&r.url)throw new Error("Negotiate redirection limit exceeded.");yield t._createTransport(i,t._options.transport,r,n)}t.transport instanceof be&&(t.features.inherentKeepAlive=!0),"Connecting"===t._connectionState&&(t._logger.log(c.i.Debug,"The HttpConnection connected successfully."),t._connectionState="Connected")}catch(r){return t._logger.log(c.i.Error,"Failed to start the connection: "+r),t._connectionState="Disconnected",t.transport=void 0,t._stopPromiseResolver(),Promise.reject(r)}})()}_getNegotiationResponse(n){var t=this;return(0,v.Z)(function*(){const i={},[r,s]=(0,f.hS)();i[r]=s;const a=t._resolveNegotiateUrl(n);t._logger.log(c.i.Debug,`Sending negotiation request: ${a}.`);try{const l=yield t._httpClient.post(a,{content:"",headers:{...i,...t._options.headers},timeout:t._options.timeout,withCredentials:t._options.withCredentials});if(200!==l.statusCode)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${l.statusCode}'`));const p=JSON.parse(l.content);return(!p.negotiateVersion||p.negotiateVersion<1)&&(p.connectionToken=p.connectionId),p}catch(l){let p="Failed to complete negotiation with the server: "+l;return l instanceof A&&404===l.statusCode&&(p+=" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),t._logger.log(c.i.Error,p),Promise.reject(new lt(p))}})()}_createConnectUrl(n,t){return t?n+(-1===n.indexOf("?")?"?":"&")+`id=${t}`:n}_createTransport(n,t,i,r){var s=this;return(0,v.Z)(function*(){let a=s._createConnectUrl(n,i.connectionToken);if(s._isITransport(t))return s._logger.log(c.i.Debug,"Connection was provided an instance of ITransport, using that directly."),s.transport=t,yield s._startTransport(a,r),void(s.connectionId=i.connectionId);const l=[],p=i.availableTransports||[];let m=i;for(const _ of p){const g=s._resolveTransportOrError(_,t,r);if(g instanceof Error)l.push(`${_.transport} failed:`),l.push(g);else if(s._isITransport(g)){if(s.transport=g,!m){try{m=yield s._getNegotiationResponse(n)}catch(O){return Promise.reject(O)}a=s._createConnectUrl(n,m.connectionToken)}try{return yield s._startTransport(a,r),void(s.connectionId=m.connectionId)}catch(O){if(s._logger.log(c.i.Error,`Failed to start the transport '${_.transport}': ${O}`),m=void 0,l.push(new ct(`${_.transport} failed: ${O}`,y[_.transport])),"Connecting"!==s._connectionState){const Je="Failed to select transport before stop() was called.";return s._logger.log(c.i.Debug,Je),Promise.reject(new I(Je))}}}}return Promise.reject(l.length>0?new ht(`Unable to connect to the server with any of the available transports. ${l.join(" ")}`,l):new Error("None of the transports supported by the client are supported by the server."))})()}_constructTransport(n){switch(n){case y.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new _t(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case y.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new ut(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case y.LongPolling:return new be(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${n}.`)}}_startTransport(n,t){return this.transport.onreceive=this.onreceive,this.transport.onclose=i=>this._stopConnection(i),this.transport.connect(n,t)}_resolveTransportOrError(n,t,i){const r=y[n.transport];if(null==r)return this._logger.log(c.i.Debug,`Skipping transport '${n.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${n.transport}' because it is not supported by this client.`);if(!function bt(o,n){return!o||0!=(n&o)}(t,r))return this._logger.log(c.i.Debug,`Skipping transport '${y[r]}' because it was disabled by the client.`),new at(`'${y[r]}' is disabled by the client.`,r);if(!(n.transferFormats.map(a=>x[a]).indexOf(i)>=0))return this._logger.log(c.i.Debug,`Skipping transport '${y[r]}' because it does not support the requested transfer format '${x[i]}'.`),new Error(`'${y[r]}' does not support ${x[i]}.`);if(r===y.WebSockets&&!this._options.WebSocket||r===y.ServerSentEvents&&!this._options.EventSource)return this._logger.log(c.i.Debug,`Skipping transport '${y[r]}' because it is not supported in your environment.'`),new st(`'${y[r]}' is not supported in your environment.`,r);this._logger.log(c.i.Debug,`Selecting transport '${y[r]}'.`);try{return this._constructTransport(r)}catch(a){return a}}_isITransport(n){return n&&"object"==typeof n&&"connect"in n}_stopConnection(n){if(this._logger.log(c.i.Debug,`HttpConnection.stopConnection(${n}) called while in state ${this._connectionState}.`),this.transport=void 0,n=this._stopError||n,this._stopError=void 0,"Disconnected"!==this._connectionState){if("Connecting"===this._connectionState)throw this._logger.log(c.i.Warning,`Call to HttpConnection.stopConnection(${n}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${n}) was called while the connection is still in the connecting state.`);if("Disconnecting"===this._connectionState&&this._stopPromiseResolver(),n?this._logger.log(c.i.Error,`Connection disconnected with error '${n}'.`):this._logger.log(c.i.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(c.i.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(n)}catch(t){this._logger.log(c.i.Error,`HttpConnection.onclose(${n}) threw error '${t}'.`)}}}else this._logger.log(c.i.Debug,`Call to HttpConnection.stopConnection(${n}) was ignored because the connection is already in the disconnected state.`)}_resolveUrl(n){if(0===n.lastIndexOf("https://",0)||0===n.lastIndexOf("http://",0))return n;if(!f.t4.isBrowser)throw new Error(`Cannot resolve '${n}'.`);const t=window.document.createElement("a");return t.href=n,this._logger.log(c.i.Information,`Normalizing '${n}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(n){const t=n.indexOf("?");let i=n.substring(0,-1===t?n.length:t);return"/"!==i[i.length-1]&&(i+="/"),i+="negotiate",i+=-1===t?"":n.substring(t),-1===i.indexOf("negotiateVersion")&&(i+=-1===t?"?":"&",i+="negotiateVersion="+this._negotiateVersion),i}}class G{constructor(n){this._transport=n,this._buffer=[],this._executing=!0,this._sendBufferedData=new j,this._transportResult=new j,this._sendLoopPromise=this._sendLoop()}send(n){return this._bufferData(n),this._transportResult||(this._transportResult=new j),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(n){if(this._buffer.length&&typeof this._buffer[0]!=typeof n)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof n}`);this._buffer.push(n),this._sendBufferedData.resolve()}_sendLoop(){var n=this;return(0,v.Z)(function*(){for(;;){if(yield n._sendBufferedData.promise,!n._executing){n._transportResult&&n._transportResult.reject("Connection stopped.");break}n._sendBufferedData=new j;const t=n._transportResult;n._transportResult=void 0;const i="string"==typeof n._buffer[0]?n._buffer.join(""):G._concatBuffers(n._buffer);n._buffer.length=0;try{yield n._transport.send(i),t.resolve()}catch(r){t.reject(r)}}})()}static _concatBuffers(n){const t=n.map(s=>s.byteLength).reduce((s,a)=>s+a),i=new Uint8Array(t);let r=0;for(const s of n)i.set(new Uint8Array(s),r),r+=s.byteLength;return i.buffer}}class j{constructor(){this.promise=new Promise((n,t)=>[this._resolver,this._rejecter]=[n,t])}resolve(){this._resolver()}reject(n){this._rejecter(n)}}class S{static write(n){return`${n}${S.RecordSeparator}`}static parse(n){if(n[n.length-1]!==S.RecordSeparator)throw new Error("Message is incomplete.");const t=n.split(S.RecordSeparator);return t.pop(),t}}S.RecordSeparatorCode=30,S.RecordSeparator=String.fromCharCode(S.RecordSeparatorCode);class Ct{writeHandshakeRequest(n){return S.write(JSON.stringify(n))}parseHandshakeResponse(n){let t,i;if((0,f.eP)(n)){const l=new Uint8Array(n),p=l.indexOf(S.RecordSeparatorCode);if(-1===p)throw new Error("Message is incomplete.");const m=p+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(l.slice(0,m))),i=l.byteLength>m?l.slice(m).buffer:null}else{const l=n,p=l.indexOf(S.RecordSeparator);if(-1===p)throw new Error("Message is incomplete.");const m=p+1;t=l.substring(0,m),i=l.length>m?l.substring(m):null}const r=S.parse(t),s=JSON.parse(r[0]);if(s.type)throw new Error("Expected a handshake response from the server.");return[i,s]}}var b=function(o){return o[o.Invocation=1]="Invocation",o[o.StreamItem=2]="StreamItem",o[o.Completion=3]="Completion",o[o.StreamInvocation=4]="StreamInvocation",o[o.CancelInvocation=5]="CancelInvocation",o[o.Ping=6]="Ping",o[o.Close=7]="Close",o}(b||{});class vt{constructor(){this.observers=[]}next(n){for(const t of this.observers)t.next(n)}error(n){for(const t of this.observers)t.error&&t.error(n)}complete(){for(const n of this.observers)n.complete&&n.complete()}subscribe(n){return this.observers.push(n),new f.WQ(this,n)}}var C=function(o){return o.Disconnected="Disconnected",o.Connecting="Connecting",o.Connected="Connected",o.Disconnecting="Disconnecting",o.Reconnecting="Reconnecting",o}(C||{});class K{constructor(n,t,i,r){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(c.i.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://docs.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},f.j7.isRequired(n,"connection"),f.j7.isRequired(t,"logger"),f.j7.isRequired(i,"protocol"),this.serverTimeoutInMilliseconds=3e4,this.keepAliveIntervalInMilliseconds=15e3,this._logger=t,this._protocol=i,this.connection=n,this._reconnectPolicy=r,this._handshakeProtocol=new Ct,this.connection.onreceive=s=>this._processIncomingData(s),this.connection.onclose=s=>this._connectionClosed(s),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=C.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:b.Ping})}static create(n,t,i,r){return new K(n,t,i,r)}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(n){if(this._connectionState!==C.Disconnected&&this._connectionState!==C.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!n)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=n}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}_startWithStateTransitions(){var n=this;return(0,v.Z)(function*(){if(n._connectionState!==C.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));n._connectionState=C.Connecting,n._logger.log(c.i.Debug,"Starting HubConnection.");try{yield n._startInternal(),f.t4.isBrowser&&window.document.addEventListener("freeze",n._freezeEventListener),n._connectionState=C.Connected,n._connectionStarted=!0,n._logger.log(c.i.Debug,"HubConnection connected successfully.")}catch(t){return n._connectionState=C.Disconnected,n._logger.log(c.i.Debug,`HubConnection failed to start successfully because of error '${t}'.`),Promise.reject(t)}})()}_startInternal(){var n=this;return(0,v.Z)(function*(){n._stopDuringStartError=void 0,n._receivedHandshakeResponse=!1;const t=new Promise((i,r)=>{n._handshakeResolver=i,n._handshakeRejecter=r});yield n.connection.start(n._protocol.transferFormat);try{const i={protocol:n._protocol.name,version:n._protocol.version};if(n._logger.log(c.i.Debug,"Sending handshake request."),yield n._sendMessage(n._handshakeProtocol.writeHandshakeRequest(i)),n._logger.log(c.i.Information,`Using HubProtocol '${n._protocol.name}'.`),n._cleanupTimeout(),n._resetTimeoutPeriod(),n._resetKeepAliveInterval(),yield t,n._stopDuringStartError)throw n._stopDuringStartError;n.connection.features.inherentKeepAlive||(yield n._sendMessage(n._cachedPingMessage))}catch(i){throw n._logger.log(c.i.Debug,`Hub handshake failed with error '${i}' during start(). Stopping HubConnection.`),n._cleanupTimeout(),n._cleanupPingTimer(),yield n.connection.stop(i),i}})()}stop(){var n=this;return(0,v.Z)(function*(){const t=n._startPromise;n._stopPromise=n._stopInternal(),yield n._stopPromise;try{yield t}catch{}})()}_stopInternal(n){return this._connectionState===C.Disconnected?(this._logger.log(c.i.Debug,`Call to HubConnection.stop(${n}) ignored because it is already in the disconnected state.`),Promise.resolve()):this._connectionState===C.Disconnecting?(this._logger.log(c.i.Debug,`Call to HttpConnection.stop(${n}) ignored because the connection is already in the disconnecting state.`),this._stopPromise):(this._connectionState=C.Disconnecting,this._logger.log(c.i.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(c.i.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=n||new I("The connection was stopped before the hub handshake could complete."),this.connection.stop(n)))}stream(n,...t){const[i,r]=this._replaceStreamingParams(t),s=this._createStreamInvocation(n,t,r);let a;const l=new vt;return l.cancelCallback=()=>{const p=this._createCancelInvocation(s.invocationId);return delete this._callbacks[s.invocationId],a.then(()=>this._sendWithProtocol(p))},this._callbacks[s.invocationId]=(p,m)=>{m?l.error(m):p&&(p.type===b.Completion?p.error?l.error(new Error(p.error)):l.complete():l.next(p.item))},a=this._sendWithProtocol(s).catch(p=>{l.error(p),delete this._callbacks[s.invocationId]}),this._launchStreams(i,a),l}_sendMessage(n){return this._resetKeepAliveInterval(),this.connection.send(n)}_sendWithProtocol(n){return this._sendMessage(this._protocol.writeMessage(n))}send(n,...t){const[i,r]=this._replaceStreamingParams(t),s=this._sendWithProtocol(this._createInvocation(n,t,!0,r));return this._launchStreams(i,s),s}invoke(n,...t){const[i,r]=this._replaceStreamingParams(t),s=this._createInvocation(n,t,!1,r);return new Promise((l,p)=>{this._callbacks[s.invocationId]=(_,g)=>{g?p(g):_&&(_.type===b.Completion?_.error?p(new Error(_.error)):l(_.result):p(new Error(`Unexpected message type: ${_.type}`)))};const m=this._sendWithProtocol(s).catch(_=>{p(_),delete this._callbacks[s.invocationId]});this._launchStreams(i,m)})}on(n,t){!n||!t||(n=n.toLowerCase(),this._methods[n]||(this._methods[n]=[]),-1===this._methods[n].indexOf(t)&&this._methods[n].push(t))}off(n,t){if(!n)return;n=n.toLowerCase();const i=this._methods[n];if(i)if(t){const r=i.indexOf(t);-1!==r&&(i.splice(r,1),0===i.length&&delete this._methods[n])}else delete this._methods[n]}onclose(n){n&&this._closedCallbacks.push(n)}onreconnecting(n){n&&this._reconnectingCallbacks.push(n)}onreconnected(n){n&&this._reconnectedCallbacks.push(n)}_processIncomingData(n){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(n=this._processHandshakeResponse(n),this._receivedHandshakeResponse=!0),n){const t=this._protocol.parseMessages(n,this._logger);for(const i of t)switch(i.type){case b.Invocation:this._invokeClientMethod(i);break;case b.StreamItem:case b.Completion:{const r=this._callbacks[i.invocationId];if(r){i.type===b.Completion&&delete this._callbacks[i.invocationId];try{r(i)}catch(s){this._logger.log(c.i.Error,`Stream callback threw error: ${(0,f.HH)(s)}`)}}break}case b.Ping:break;case b.Close:{this._logger.log(c.i.Information,"Close message received from server.");const r=i.error?new Error("Server returned an error on close: "+i.error):void 0;!0===i.allowReconnect?this.connection.stop(r):this._stopPromise=this._stopInternal(r);break}default:this._logger.log(c.i.Warning,`Invalid message type: ${i.type}.`)}}this._resetTimeoutPeriod()}_processHandshakeResponse(n){let t,i;try{[i,t]=this._handshakeProtocol.parseHandshakeResponse(n)}catch(r){const s="Error parsing handshake response: "+r;this._logger.log(c.i.Error,s);const a=new Error(s);throw this._handshakeRejecter(a),a}if(t.error){const r="Server returned handshake error: "+t.error;this._logger.log(c.i.Error,r);const s=new Error(r);throw this._handshakeRejecter(s),s}return this._logger.log(c.i.Debug,"Server handshake complete."),this._handshakeResolver(),i}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=(new Date).getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){var n=this;if(!(this.connection.features&&this.connection.features.inherentKeepAlive||(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),void 0!==this._pingServerHandle))){let t=this._nextKeepAlive-(new Date).getTime();t<0&&(t=0),this._pingServerHandle=setTimeout((0,v.Z)(function*(){if(n._connectionState===C.Connected)try{yield n._sendMessage(n._cachedPingMessage)}catch{n._cleanupPingTimer()}}),t)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}_invokeClientMethod(n){var t=this;return(0,v.Z)(function*(){const i=n.target.toLowerCase(),r=t._methods[i];if(!r)return t._logger.log(c.i.Warning,`No client method with the name '${i}' found.`),void(n.invocationId&&(t._logger.log(c.i.Warning,`No result given for '${i}' method and invocation ID '${n.invocationId}'.`),yield t._sendWithProtocol(t._createCompletionMessage(n.invocationId,"Client didn't provide a result.",null))));const s=r.slice(),a=!!n.invocationId;let l,p,m;for(const _ of s)try{const g=l;l=yield _.apply(t,n.arguments),a&&l&&g&&(t._logger.log(c.i.Error,`Multiple results provided for '${i}'. Sending error to server.`),m=t._createCompletionMessage(n.invocationId,"Client provided multiple results.",null)),p=void 0}catch(g){p=g,t._logger.log(c.i.Error,`A callback for the method '${i}' threw error '${g}'.`)}m?yield t._sendWithProtocol(m):a?(p?m=t._createCompletionMessage(n.invocationId,`${p}`,null):void 0!==l?m=t._createCompletionMessage(n.invocationId,null,l):(t._logger.log(c.i.Warning,`No result given for '${i}' method and invocation ID '${n.invocationId}'.`),m=t._createCompletionMessage(n.invocationId,"Client didn't provide a result.",null)),yield t._sendWithProtocol(m)):l&&t._logger.log(c.i.Error,`Result given for '${i}' method but server is not expecting a result.`)})()}_connectionClosed(n){this._logger.log(c.i.Debug,`HubConnection.connectionClosed(${n}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||n||new I("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(n||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===C.Disconnecting?this._completeClose(n):this._connectionState===C.Connected&&this._reconnectPolicy?this._reconnect(n):this._connectionState===C.Connected&&this._completeClose(n)}_completeClose(n){if(this._connectionStarted){this._connectionState=C.Disconnected,this._connectionStarted=!1,f.t4.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[n]))}catch(t){this._logger.log(c.i.Error,`An onclose callback called with error '${n}' threw error '${t}'.`)}}}_reconnect(n){var t=this;return(0,v.Z)(function*(){const i=Date.now();let r=0,s=void 0!==n?n:new Error("Attempting to reconnect due to a unknown error."),a=t._getNextRetryDelay(r++,0,s);if(null===a)return t._logger.log(c.i.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),void t._completeClose(n);if(t._connectionState=C.Reconnecting,t._logger.log(c.i.Information,n?`Connection reconnecting because of error '${n}'.`:"Connection reconnecting."),0!==t._reconnectingCallbacks.length){try{t._reconnectingCallbacks.forEach(l=>l.apply(t,[n]))}catch(l){t._logger.log(c.i.Error,`An onreconnecting callback called with error '${n}' threw error '${l}'.`)}if(t._connectionState!==C.Reconnecting)return void t._logger.log(c.i.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.")}for(;null!==a;){if(t._logger.log(c.i.Information,`Reconnect attempt number ${r} will start in ${a} ms.`),yield new Promise(l=>{t._reconnectDelayHandle=setTimeout(l,a)}),t._reconnectDelayHandle=void 0,t._connectionState!==C.Reconnecting)return void t._logger.log(c.i.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");try{if(yield t._startInternal(),t._connectionState=C.Connected,t._logger.log(c.i.Information,"HubConnection reconnected successfully."),0!==t._reconnectedCallbacks.length)try{t._reconnectedCallbacks.forEach(l=>l.apply(t,[t.connection.connectionId]))}catch(l){t._logger.log(c.i.Error,`An onreconnected callback called with connectionId '${t.connection.connectionId}; threw error '${l}'.`)}return}catch(l){if(t._logger.log(c.i.Information,`Reconnect attempt failed because of error '${l}'.`),t._connectionState!==C.Reconnecting)return t._logger.log(c.i.Debug,`Connection moved to the '${t._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),void(t._connectionState===C.Disconnecting&&t._completeClose());s=l instanceof Error?l:new Error(l.toString()),a=t._getNextRetryDelay(r++,Date.now()-i,s)}}t._logger.log(c.i.Information,`Reconnect retries have been exhausted after ${Date.now()-i} ms and ${r} failed attempts. Connection disconnecting.`),t._completeClose()})()}_getNextRetryDelay(n,t,i){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:n,retryReason:i})}catch(r){return this._logger.log(c.i.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${n}, ${t}) threw error '${r}'.`),null}}_cancelCallbacksWithError(n){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(i=>{const r=t[i];try{r(null,n)}catch(s){this._logger.log(c.i.Error,`Stream 'error' callback called with '${n}' threw error: ${(0,f.HH)(s)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(n,t,i,r){if(i)return 0!==r.length?{arguments:t,streamIds:r,target:n,type:b.Invocation}:{arguments:t,target:n,type:b.Invocation};{const s=this._invocationId;return this._invocationId++,0!==r.length?{arguments:t,invocationId:s.toString(),streamIds:r,target:n,type:b.Invocation}:{arguments:t,invocationId:s.toString(),target:n,type:b.Invocation}}}_launchStreams(n,t){if(0!==n.length){t||(t=Promise.resolve());for(const i in n)n[i].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(i)))},error:r=>{let s;s=r instanceof Error?r.message:r&&r.toString?r.toString():"Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(i,s)))},next:r=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(i,r)))}})}}_replaceStreamingParams(n){const t=[],i=[];for(let r=0;r<n.length;r++){const s=n[r];if(this._isObservable(s)){const a=this._invocationId;this._invocationId++,t[a]=s,i.push(a.toString()),n.splice(r,1)}}return[t,i]}_isObservable(n){return n&&n.subscribe&&"function"==typeof n.subscribe}_createStreamInvocation(n,t,i){const r=this._invocationId;return this._invocationId++,0!==i.length?{arguments:t,invocationId:r.toString(),streamIds:i,target:n,type:b.StreamInvocation}:{arguments:t,invocationId:r.toString(),target:n,type:b.StreamInvocation}}_createCancelInvocation(n){return{invocationId:n,type:b.CancelInvocation}}_createStreamItemMessage(n,t){return{invocationId:n,item:t,type:b.StreamItem}}_createCompletionMessage(n,t,i){return t?{error:t,invocationId:n,type:b.Completion}:{invocationId:n,result:i,type:b.Completion}}}var ve=d(1516);class St{constructor(){this.name="json",this.version=1,this.transferFormat=x.Text}parseMessages(n,t){if("string"!=typeof n)throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!n)return[];null===t&&(t=ve.W.instance);const i=S.parse(n),r=[];for(const s of i){const a=JSON.parse(s);if("number"!=typeof a.type)throw new Error("Invalid payload.");switch(a.type){case b.Invocation:this._isInvocationMessage(a);break;case b.StreamItem:this._isStreamItemMessage(a);break;case b.Completion:this._isCompletionMessage(a);break;case b.Ping:case b.Close:break;default:t.log(c.i.Information,"Unknown message type '"+a.type+"' ignored.");continue}r.push(a)}return r}writeMessage(n){return S.write(JSON.stringify(n))}_isInvocationMessage(n){this._assertNotEmptyString(n.target,"Invalid payload for Invocation message."),void 0!==n.invocationId&&this._assertNotEmptyString(n.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(n){if(this._assertNotEmptyString(n.invocationId,"Invalid payload for StreamItem message."),void 0===n.item)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(n){if(n.result&&n.error)throw new Error("Invalid payload for Completion message.");!n.result&&n.error&&this._assertNotEmptyString(n.error,"Invalid payload for Completion message."),this._assertNotEmptyString(n.invocationId,"Invalid payload for Completion message.")}_assertNotEmptyString(n,t){if("string"!=typeof n||""===n)throw new Error(t)}}const Tt={trace:c.i.Trace,debug:c.i.Debug,info:c.i.Information,information:c.i.Information,warn:c.i.Warning,warning:c.i.Warning,error:c.i.Error,critical:c.i.Critical,none:c.i.None};class kt{configureLogging(n){if(f.j7.isRequired(n,"logging"),function Et(o){return void 0!==o.log}(n))this.logger=n;else if("string"==typeof n){const t=function It(o){const n=Tt[o.toLowerCase()];if(typeof n<"u")return n;throw new Error(`Unknown log level: ${o}`)}(n);this.logger=new f.kw(t)}else this.logger=new f.kw(n);return this}withUrl(n,t){return f.j7.isRequired(n,"url"),f.j7.isNotEmpty(n,"url"),this.url=n,this.httpConnectionOptions="object"==typeof t?{...this.httpConnectionOptions,...t}:{...this.httpConnectionOptions,transport:t},this}withHubProtocol(n){return f.j7.isRequired(n,"protocol"),this.protocol=n,this}withAutomaticReconnect(n){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return this.reconnectPolicy=n?Array.isArray(n)?new ue(n):n:new ue,this}build(){const n=this.httpConnectionOptions||{};if(void 0===n.logger&&(n.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new gt(this.url,n);return K.create(t,this.logger||ve.W.instance,this.protocol||new St,this.reconnectPolicy)}}var ye=d(4716),R=d(7836);let xe=(()=>{class o{constructor(t,i){this.apiBaseUrl=t,this.identityService=i,this.connections={},this.methods={}}listenRaw(t,i){return this.methods[t]||(this.methods[t]={}),this.methods[t][i]||(this.methods[t][i]=new Y.x,this.connect(t).on(i,s=>this.methods[t][i].next(s))),this.methods[t][i]}listen(t,i,r){return this.listenRaw(t,i).pipe((0,P.U)(s=>r(s)),(0,ye.x)(()=>this.destroy(t,i)))}connect(t){if(this.connections[t]&&(this.connections[t].state===C.Connected||this.connections[t].state===C.Connecting))return this.connections[t];const i=new URL("signalr/"+t,this.apiBaseUrl),r=(new kt).withUrl(i.href,{withCredentials:!1}).withAutomaticReconnect().build();return r.start().then(()=>r.invoke("DeclareIdentity",this.identityService.getIdentity())),this.connections[t]=r,r}destroy(t,i){!this.methods[t]||!this.connections[t]||this.methods[t][i]&&(this.connections[t].off(i),this.methods[t][i].complete(),delete this.methods[t][i],0===Object.entries(this.methods[t]).length&&this.disconnect(t))}disconnect(t){this.connections[t]&&(this.connections[t].stop().then(),this.methods[t]&&(delete this.connections[t],delete this.methods[t]))}static#e=this.\u0275fac=function(i){return new(i||o)(e.LFG(h.CT),e.LFG(R.P))};static#t=this.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();function Pt(o,n){if(1&o&&(e.TgZ(0,"div",4)(1,"h1",5),e._uU(2),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.Oqu(t.title)}}let Zt=(()=>{class o{constructor(t){this.modal=t,this.alertString=At(["Alert!","Wait a minute...","Is this for real?!"])}static#e=this.\u0275fac=function(i){return new(i||o)(e.Y36(T.Kz))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-alert-modal"]],inputs:{title:"title",content:"content",closeLabel:"closeLabel"},decls:9,vars:4,consts:[["class","modal-header",4,"ngIf"],[1,"modal-body"],[1,"modal-footer"],[1,"btn","btn-primary",3,"click"],[1,"modal-header"],[1,"modal-title"]],template:function(i,r){if(1&i&&(e.YNc(0,Pt,3,1,"div",0),e.TgZ(1,"div",1)(2,"strong"),e._uU(3),e.qZA(),e._UZ(4,"br"),e._uU(5),e.qZA(),e.TgZ(6,"div",2)(7,"button",3),e.NdJ("click",function(){return r.modal.close()}),e._uU(8),e.qZA()()),2&i){let s;e.Q6J("ngIf",r.title),e.xp6(3),e.Oqu(r.alertString),e.xp6(2),e.hij(" ",r.content,"\n"),e.xp6(3),e.hij(" ",null!==(s=r.closeLabel)&&void 0!==s?s:"Close"," ")}},dependencies:[u.O5],encapsulation:2})}return o})();const At=o=>o[Math.floor(Math.random()*o.length)];let Nt=(()=>{class o{constructor(t){this.modalService=t}alert(t){const i=this.modalService.open(Zt,{centered:!0});return i.componentInstance.title=t.title,i.componentInstance.content=t.content,i.componentInstance.closeLabel=t.closeLabel,(0,D.D)(i.result).pipe((0,M.K)(r=>(0,$.of)(void 0)))}static#e=this.\u0275fac=function(i){return new(i||o)(e.LFG(T.FF))};static#t=this.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac,providedIn:"root"})}return o})();var Ot=d(2630),X=d(4325),Dt=d(166);function Jt(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"button",15),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.leave.emit())}),e._UZ(1,"i",16),e.qZA()}}function Rt(o,n){if(1&o&&(e.ynx(0),e.TgZ(1,"h3"),e._uU(2),e.qZA(),e.YNc(3,Jt,2,0,"button",14),e.BQk()),2&o){const t=e.oxw();let i;e.xp6(2),e.Oqu(null!==(i=t.name)&&void 0!==i?i:"???"),e.xp6(1),e.Q6J("ngIf",!t.readonly)}}function Ut(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"button",20),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.leave.emit())}),e.qZA()}}function Qt(o,n){if(1&o){const t=e.EpF();e.ynx(0),e._UZ(1,"i",17),e.TgZ(2,"input",18),e.NdJ("ngModelChange",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.name=r)}),e.qZA(),e.YNc(3,Ut,1,0,"button",19),e.BQk()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("disabled",t.readonly)("ngModel",t.name),e.xp6(1),e.Q6J("ngIf",!t.readonly)}}const Ft=function(o){return{$implicit:o}};function Lt(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"a",21),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.select(s))})("dragstart",function(r){const a=e.CHM(t).$implicit,l=e.oxw();return e.KtG(l.dragCharacter(r,a))}),e._uU(1),e.qZA()}if(2&o){const t=n.$implicit,i=e.oxw(),r=e.MAs(25);e.ekj("active",i.isSelected(t))("disabled",i.disabled),e.Q6J("ngbPopover",r)("popoverContext",e.VKq(8,Ft,t))("placement",i.invertSlotPositions?"right":"left"),e.xp6(1),e.hij(" ",t.identity.displayName," ")}}function Yt(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"button",22),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.swap())}),e._UZ(1,"i",23),e.qZA()}if(2&o){const t=e.oxw();e.Q6J("disabled",t.disabled)}}function $t(o,n){if(1&o&&(e.ynx(0),e.GkF(1,24)(2,24),e.BQk()),2&o){e.oxw();const t=e.MAs(21),i=e.MAs(23);e.xp6(1),e.Q6J("ngTemplateOutlet",t),e.xp6(1),e.Q6J("ngTemplateOutlet",i)}}function Mt(o,n){if(1&o&&(e.ynx(0),e.GkF(1,24)(2,24),e.BQk()),2&o){e.oxw();const t=e.MAs(23),i=e.MAs(21);e.xp6(1),e.Q6J("ngTemplateOutlet",t),e.xp6(1),e.Q6J("ngTemplateOutlet",i)}}const we=function(){return{"width.em":.75,"height.em":.75}};function Ht(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.unselect("front"))}),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("ngStyle",e.DdM(2,we))("disabled",t.disabled)}}function jt(o,n){if(1&o&&e._UZ(0,"app-character-card",30),2&o){const t=e.oxw(2);e.Q6J("character",t.frontCharacter)("enablePopoverDetails",!0)("popoverDetailsPlacement",t.invertSlotPositions?"right":"left")}}function zt(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",25)(1,"h4",3),e._uU(2," Front "),e.YNc(3,Ht,1,3,"button",26),e.qZA(),e.TgZ(4,"app-character-img",27),e.NdJ("dropped",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.dropCharacter(r,"front"))}),e.qZA(),e.YNc(5,jt,1,3,"app-character-card",28),e.qZA()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.frontCharacter&&!t.readonly),e.xp6(1),e.Q6J("character",t.frontCharacter),e.xp6(1),e.Q6J("ngIf",t.frontCharacter)}}function Wt(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"button",29),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.unselect("back"))}),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("ngStyle",e.DdM(2,we))("disabled",t.disabled)}}function qt(o,n){if(1&o&&e._UZ(0,"app-character-card",30),2&o){const t=e.oxw(2);e.Q6J("character",t.backCharacter)("enablePopoverDetails",!0)("popoverDetailsPlacement",t.invertSlotPositions?"right":"left")}}function Bt(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",25)(1,"h4",3),e._uU(2," Back "),e.YNc(3,Wt,1,3,"button",26),e.qZA(),e.TgZ(4,"app-character-img",27),e.NdJ("dropped",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.dropCharacter(r,"back"))}),e.qZA(),e.YNc(5,qt,1,3,"app-character-card",28),e.qZA()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngIf",t.backCharacter&&!t.readonly),e.xp6(1),e.Q6J("character",t.backCharacter),e.xp6(1),e.Q6J("ngIf",t.backCharacter)}}function Gt(o,n){1&o&&e._UZ(0,"app-character-card",31),2&o&&e.Q6J("character",n.$implicit)("contentOnly",!0)}const Kt=function(){return{"minHeight.em":1.5}};let Xt=(()=>{class o{constructor(){this._characters=[],this.enableNameEdition=!1,this.readonly=!1,this.invertSlotPositions=!1,this.update=new e.vpe,this.leave=new e.vpe,this.ready=!1}get name(){return this._name}set name(t){this._name=t,this.doUpdateAfterChange()}get combat(){return this._combat}set combat(t){this._combat=t,this.doUpdateAfterChange()}get characters(){return this._characters}set characters(t){this._characters=t,this.doUpdateAfterChange()}get disabled(){return this.readonly||this.ready}getAt(t){switch(t){case"front":return this.frontCharacter;case"back":return this.backCharacter}}swap(){if(this.frontCharacter&&this.backCharacter){const t=this.frontCharacter;this.frontCharacter=this.backCharacter,this.backCharacter=t,this.sendUpdate()}}select(t,i){if(this.isSelected(t))i&&this.getAt(i)?.identity?.name!==t.identity.name&&this.swap();else switch(i){case"front":this.frontCharacter=t,this.sendUpdate();break;case"back":this.backCharacter=t,this.sendUpdate();break;default:!this.frontCharacter||this.frontCharacter&&this.backCharacter?this.frontCharacter=t:this.backCharacter||(this.backCharacter=t),this.sendUpdate()}}isSelected(t){return this.frontCharacter&&t.identity.name===this.frontCharacter.identity.name||this.backCharacter&&t.identity.name===this.backCharacter.identity.name}unselect(t){switch(t){case"front":this.frontCharacter=void 0,this.sendUpdate();break;case"back":this.backCharacter=void 0,this.sendUpdate()}}dragCharacter(t,i){t.dataTransfer&&(t.dataTransfer.setData("text/plain",`character:${i.identity.name}`),t.dataTransfer.effectAllowed="copy")}dropCharacter(t,i){const r=t.dataTransfer?.getData("text/plain");if(!r||!r.startsWith("character:"))return;const s=r.substring(10),a=this._characters.find(l=>l.identity.name===s);a&&(this.select(a,i),t.preventDefault())}setReady(t){this.ready=t,this.sendUpdate()}sendUpdate(){this.update.emit({playerName:this._name??"",frontCharacter:this.frontCharacter?.identity.name,backCharacter:this.backCharacter?.identity.name,ready:this.ready})}doUpdateAfterChange(){if(!this._combat||!this._name)return this.frontCharacter=void 0,this.backCharacter=void 0,void(this.ready=!1);this._name==this._combat.leftPlayerName?(this.frontCharacter=this._characters.find(t=>t.identity.name===this._combat?.leftFrontCharacter),this.backCharacter=this._characters.find(t=>t.identity.name===this._combat?.leftBackCharacter),this.ready=this._combat.leftReady):this._name==this._combat.rightPlayerName&&(this.frontCharacter=this._characters.find(t=>t.identity.name===this._combat?.rightFrontCharacter),this.backCharacter=this._characters.find(t=>t.identity.name===this._combat?.rightBackCharacter),this.ready=this._combat.rightReady)}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-combat-configure-side"]],inputs:{name:"name",combat:"combat",characters:"characters",enableNameEdition:"enableNameEdition",readonly:"readonly",invertSlotPositions:"invertSlotPositions"},outputs:{update:"update",leave:"leave"},decls:26,vars:13,consts:[[1,"vstack"],[1,"hstack","justify-content-center","gap-2",3,"ngStyle"],[4,"ngIf"],[1,"text-center"],[1,"overflow-y-auto",2,"max-height","50vh"],[1,"list-group"],["class","list-group-item list-group-item-action","draggable","true","container","body","triggers","mouseenter:mouseleave",3,"active","ngbPopover","popoverContext","placement","disabled","click","dragstart",4,"ngFor","ngForOf"],["class","btn btn-outline-secondary btn-sm","ngbTooltip","Swap",3,"disabled","click",4,"ngIf"],[1,"row"],[1,"flex-fill"],[1,"btn","mt-2",3,"disabled","click"],["frontCharacterTpl",""],["backCharacterTpl",""],["characterCardTpl",""],["class","btn btn-outline-secondary btn-sm","ngbTooltip","Leave",3,"click",4,"ngIf"],["ngbTooltip","Leave",1,"btn","btn-outline-secondary","btn-sm",3,"click"],[1,"bi","bi-door-open-fill"],["ngbTooltip","AI Player",1,"bi","bi-cpu"],[1,"form-control","form-control-lg",3,"disabled","ngModel","ngModelChange"],["class","btn-close btn-sm","ngbTooltip","Remove AI",3,"click",4,"ngIf"],["ngbTooltip","Remove AI",1,"btn-close","btn-sm",3,"click"],["draggable","true","container","body","triggers","mouseenter:mouseleave",1,"list-group-item","list-group-item-action",3,"ngbPopover","popoverContext","placement","click","dragstart"],["ngbTooltip","Swap",1,"btn","btn-outline-secondary","btn-sm",3,"disabled","click"],[1,"bi","bi-arrow-left-right"],[3,"ngTemplateOutlet"],[1,"w-50","col","vstack"],["type","button","class","btn-close p-0 btn-sm","ngbTooltip","Clear","aria-label","Close",3,"ngStyle","disabled","click",4,"ngIf"],["size","lg",3,"character","dropped"],["class","mt-2",3,"character","enablePopoverDetails","popoverDetailsPlacement",4,"ngIf"],["type","button","ngbTooltip","Clear","aria-label","Close",1,"btn-close","p-0","btn-sm",3,"ngStyle","disabled","click"],[1,"mt-2",3,"character","enablePopoverDetails","popoverDetailsPlacement"],[3,"character","contentOnly"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0)(1,"div",1),e.YNc(2,Rt,4,2,"ng-container",2),e.YNc(3,Qt,4,3,"ng-container",2),e.qZA(),e.TgZ(4,"h4",3),e._uU(5,"Select characters"),e.qZA(),e.TgZ(6,"div",4)(7,"ul",5),e.YNc(8,Lt,2,10,"a",6),e.qZA()(),e._UZ(9,"hr"),e.TgZ(10,"section")(11,"h3",3),e._uU(12," Team "),e.YNc(13,Yt,2,1,"button",7),e.qZA(),e.TgZ(14,"div",8),e.YNc(15,$t,3,2,"ng-container",2),e.YNc(16,Mt,3,2,"ng-container",2),e.qZA()(),e._UZ(17,"div",9),e.TgZ(18,"button",10),e.NdJ("click",function(){return r.setReady(!r.ready)}),e._uU(19," Ready "),e.qZA()(),e.YNc(20,zt,6,3,"ng-template",null,11,e.W1O),e.YNc(22,Bt,6,3,"ng-template",null,12,e.W1O),e.YNc(24,Gt,1,2,"ng-template",null,13,e.W1O)),2&i&&(e.xp6(1),e.Q6J("ngStyle",e.DdM(12,Kt)),e.xp6(1),e.Q6J("ngIf",!r.enableNameEdition),e.xp6(1),e.Q6J("ngIf",r.enableNameEdition),e.xp6(5),e.Q6J("ngForOf",r.characters),e.xp6(5),e.Q6J("ngIf",!r.readonly),e.xp6(2),e.Q6J("ngIf",!r.invertSlotPositions),e.xp6(1),e.Q6J("ngIf",r.invertSlotPositions),e.xp6(2),e.ekj("btn-outline-secondary",!r.ready)("btn-secondary",r.ready),e.Q6J("disabled",r.readonly))},dependencies:[u.sg,u.O5,u.tP,u.PC,X.o,Dt.Y,E.Fj,E.JJ,E.On,T._L,T.o8],encapsulation:2})}return o})();d(8656);let Vt=(()=>{class o{get combat(){return this._combat}set combat(t){this._combat=t,this.updateUrl()}constructor(t){this.baseHref=t,this.requestAi=new e.vpe,this.url="???"}copyUrl(){navigator.clipboard.writeText(this.url).then()}updateUrl(){this.url=new URL("combat/join/"+this._combat?.id,new URL(this.baseHref,window.location.origin)).href}static#e=this.\u0275fac=function(i){return new(i||o)(e.Y36(u.mr))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-combat-empty-side"]],inputs:{combat:"combat"},outputs:{requestAi:"requestAi"},decls:11,vars:1,consts:[[1,"h-100","vstack","align-items-center","justify-content-center"],[1,"hstack","justify-content-center","gap-2"],["ngbTooltip","Copy",1,"btn","btn-outline-secondary",3,"click"],[1,"bi","bi-clipboard"],[1,"w-100","fs-5"],[1,"btn","btn-outline-secondary","fs-3",3,"click"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0)(1,"h3",1),e._uU(2," Invite a friend "),e.TgZ(3,"button",2),e.NdJ("click",function(){return r.copyUrl()}),e._UZ(4,"i",3),e.qZA()(),e.TgZ(5,"code",4),e._uU(6),e.qZA(),e.TgZ(7,"h2"),e._uU(8,"OR"),e.qZA(),e.TgZ(9,"button",5),e.NdJ("click",function(){return r.requestAi.emit()}),e._uU(10,"Play against AI"),e.qZA()()),2&i&&(e.xp6(6),e.hij(" ",r.url," "))},dependencies:[T._L],encapsulation:2})}return o})();function en(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"app-combat-configure-side",16),e.NdJ("update",function(r){e.CHM(t);const s=e.oxw(2);return e.KtG(s.sendUpdate(s.CombatSide.Right,r))})("leave",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.leave(r.CombatSide.Right))}),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("combat",t.combat)("name",t.combat.rightPlayerName)("characters",t.characters)("readonly",t.side!==t.CombatSide.Right&&!t.combat.rightPlayerIsAi)("enableNameEdition",t.side!==t.CombatSide.Right&&t.combat.rightPlayerIsAi)}}function tn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"app-combat-empty-side",17),e.NdJ("requestAi",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.setRightPlayerAi())}),e.qZA()}if(2&o){const t=e.oxw(2);e.Q6J("combat",t.combat)}}function nn(o,n){1&o&&(e.TgZ(0,"div",18),e._uU(1,"Combat has started, click START to join!"),e.qZA())}function on(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"section",1)(1,"div",2)(2,"h1",3),e._uU(3,"Combat creation"),e.qZA()(),e.TgZ(4,"div",4)(5,"div",5)(6,"h2"),e._uU(7,"Player side"),e.qZA(),e.TgZ(8,"app-combat-configure-side",6),e.NdJ("update",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.sendUpdate(s.CombatSide.Left,r))})("leave",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.leave(r.CombatSide.Left))}),e.qZA()(),e.TgZ(9,"div",5)(10,"h2"),e._uU(11,"Opponent side"),e.qZA(),e.YNc(12,en,1,5,"app-combat-configure-side",7),e.YNc(13,tn,1,1,"app-combat-empty-side",8),e.qZA()(),e._UZ(14,"div",9),e.TgZ(15,"div",10)(16,"input",11),e.NdJ("ngModelChange",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.randomSeed=r)})("input",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.randomSeedChange.next())}),e.qZA(),e.TgZ(17,"label",12),e._uU(18,"Random Seed Phrase (optional)"),e.qZA()(),e.TgZ(19,"div",13),e.YNc(20,nn,2,0,"div",14),e.TgZ(21,"button",15),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.start())}),e._uU(22," Start "),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(8),e.Q6J("combat",t.combat)("name",t.combat.leftPlayerName)("characters",t.characters)("invertSlotPositions",!0)("readonly",t.side!==t.CombatSide.Left),e.xp6(4),e.Q6J("ngIf",t.combat.rightPlayerName||t.combat.rightPlayerIsAi),e.xp6(1),e.Q6J("ngIf",!t.combat.rightPlayerName&&!t.combat.rightPlayerIsAi),e.xp6(3),e.Q6J("ngModel",t.randomSeed),e.xp6(4),e.Q6J("ngIf",t.startedCombatId),e.xp6(1),e.ekj("disabled",!t.combat||!t.combat.leftReady||!t.combat.rightReady),e.Q6J("disabled",!t.combat||!t.combat.leftReady||!t.combat.rightReady)}}let V=class ne{constructor(n,t,i,r,s,a,l,p){this.signalRService=n,this.identityService=t,this.combatsService=i,this.charactersService=r,this.activatedRoute=s,this.router=a,this.modalsService=l,this.alertsService=p,this.characters=[],this.randomSeedChange=new Y.x,this.CombatSide=h.E1}ngOnInit(){const n=this.identityService.getIdentity();this.randomSeedChange.pipe(function nt(o,n=Ve.z){return(0,et.e)((t,i)=>{let r=null,s=null,a=null;const l=()=>{if(r){r.unsubscribe(),r=null;const m=s;s=null,i.next(m)}};function p(){const m=a+o,_=n.now();if(_<m)return r=this.schedule(void 0,m-_),void i.add(r);l()}t.subscribe((0,tt.x)(i,m=>{s=m,a=n.now(),r||(r=n.schedule(p,o),i.add(r))},()=>{l(),i.complete()},void 0,()=>{s=r=null}))})}(500),(0,Z.w)(()=>null==this.combat?(0,$.of)(void 0):this.combatsService.updateCombatInPreparation(this.combat.id,new h.HV({playerName:n,randomSeed:this.randomSeed})))).subscribe(),this.signalRService.listen("combats","CombatInPreparationChanged",h.fQ.fromJS).pipe(q(this)).subscribe(t=>{this.combat=t,this.randomSeed=t.randomSeed}),this.signalRService.listen("combats","CombatInPreparationDeleted",h.fQ.fromJS).pipe(q(this)).subscribe(t=>this.onDeleted(t)),this.signalRService.listenRaw("combats","CombatInPreparationStarted").pipe(q(this)).subscribe((...t)=>this.onCreated(t[0])),this.activatedRoute.paramMap.pipe((0,Z.w)(t=>{const i=t.get("id");return null==i?(this.router.to404().then(),(0,ot._)(()=>"Id not found")):this.combatsService.getCombatInPreparation(i,n)}),(0,M.K)(t=>(console.error(t),(0,D.D)(this.router.to404().then(i=>{})))),(0,P.U)(t=>{this.combat=t,this.side=n===this.combat?.leftPlayerName?h.E1.Left:n==this.combat?.rightPlayerName?h.E1.Right:h.E1.None}),(0,Z.w)(()=>this.charactersService.getAll().pipe((0,P.U)(t=>this.characters=t)))).subscribe()}start(){this.startedCombatId&&this.router.toCombat(this.startedCombatId).then(),this.combat&&this.combatsService.startCombat(this.combat.id,this.identityService.getIdentity()).subscribe(n=>this.router.toCombat(n).then())}sendUpdate(n,t){if(!this.combat)return;const i=this.identityService.getIdentity();if((!this.combat.rightPlayerIsAi||n!==h.E1.Right)&&(i==this.combat.leftPlayerName&&n!==h.E1.Left||i==this.combat.rightPlayerName&&n!==h.E1.Right||t.playerName!==i))return;const r=n===h.E1.Right&&this.combat.rightPlayerIsAi;this.combatsService.updateCombatInPreparationSide(this.combat.id,new h.gx({...t,isAi:r})).subscribe()}setRightPlayerAi(){this.combat&&this.combatsService.updateCombatInPreparationSide(this.combat.id,new h.gx({isAi:!0,playerName:"Sancho",ready:!1})).subscribe()}leave(n){if(!this.combat)return;let t;switch(n){case h.E1.Left:t=this.combat?.leftPlayerName;break;case h.E1.Right:t=this.combat?.rightPlayerName}t&&this.combatsService.leaveCombatInPreparation(this.combat.id,t).subscribe(()=>this.router.toCombatSelection())}onDeleted(n){this.startedCombatId||n.leftPlayerName!==this.identityService.getIdentity()&&this.modalsService.alert({content:"This combat has been deleted by "+n.leftPlayerName,closeLabel:"Go back"}).subscribe(()=>this.router.toCombatSelection().then())}onCreated(n){if(this.hasRequestedStartOfCombat)return;this.startedCombatId=n;const t=this.identityService.getIdentity();this.alertsService.info(`Combat has been started by ${this.combat?.leftPlayerName===t?this.combat?.rightPlayerName:this.combat?.leftPlayerName}. Press START to join them.`)}static#e=this.\u0275fac=function(t){return new(t||ne)(e.Y36(xe),e.Y36(R.P),e.Y36(h.cP),e.Y36(h.R),e.Y36(w.gz),e.Y36(w.F0),e.Y36(Nt),e.Y36(Ot.m))};static#t=this.\u0275cmp=e.Xpm({type:ne,selectors:[["ng-component"]],decls:1,vars:1,consts:[["class","container h-100 vstack gap-4 py-4",4,"ngIf"],[1,"container","h-100","vstack","gap-4","py-4"],[1,"row"],[1,"text-center"],[1,"row","row-gap-4","flex-fill","overflow-y-auto"],[1,"col-lg"],[3,"combat","name","characters","invertSlotPositions","readonly","update","leave"],[3,"combat","name","characters","readonly","enableNameEdition","update","leave",4,"ngIf"],[3,"combat","requestAi",4,"ngIf"],[1,"flex-fill"],[1,"form-floating"],["id","random-seed","placeholder","Random Seed Phrase (optional)",1,"form-control",3,"ngModel","ngModelChange","input"],["for","random-seed"],[1,"vstack","gap-1"],["class","text-success text-center",4,"ngIf"],[1,"btn","btn-primary",3,"disabled","click"],[3,"combat","name","characters","readonly","enableNameEdition","update","leave"],[3,"combat","requestAi"],[1,"text-success","text-center"]],template:function(t,i){1&t&&e.YNc(0,on,23,12,"section",0),2&t&&e.Q6J("ngIf",i.combat)},dependencies:[u.O5,E.Fj,E.JJ,E.On,Xt,Vt],encapsulation:2})};function rn(o,n){if(1&o&&(e.TgZ(0,"ngb-alert",1),e._uU(1),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.hij(" ",t.error,"\n")}}V=(0,Re.gn)([function We(o={}){return n=>{!function Ye(o){return!!o[Le]}(n)?function je(o,n){o.prototype.ngOnDestroy=pe(o.prototype.ngOnDestroy,n)}(n,o):function ze(o,n){const t=o.\u0275pipe;t.onDestroy=pe(t.onDestroy,n)}(n,o),function Me(o){o.prototype[se]=!0}(n)}}()],V),w.F0.prototype.toCombatConfiguration=function(o){return this.navigate(["/","combat","configure",o])};let sn=(()=>{class o{constructor(t,i,r,s){this.identityService=t,this.combatsService=i,this.activatedRoute=r,this.router=s}ngOnInit(){let t;this.activatedRoute.paramMap.pipe((0,Z.w)(i=>{const r=i.get("id");if(!r)return(0,D.D)(this.router.to404().then());t=r;const s=this.identityService.getIdentity();return this.combatsService.updateCombatInPreparationSide(t,new h.gx({playerName:s,ready:!1}))}),(0,M.K)(i=>(console.error(i),this.error="Could not join combat, does it exist?",(0,$.of)(void 0))),(0,Z.w)(()=>this.router.toCombatConfiguration(t))).subscribe()}static#e=this.\u0275fac=function(i){return new(i||o)(e.Y36(R.P),e.Y36(h.cP),e.Y36(w.gz),e.Y36(w.F0))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["ng-component"]],decls:1,vars:1,consts:[["type","error",4,"ngIf"],["type","error"]],template:function(i,r){1&i&&e.YNc(0,rn,2,1,"ngb-alert",0),2&i&&e.Q6J("ngIf",r.error)},dependencies:[u.O5,T.xm],encapsulation:2})}return o})();var an=d(9315),cn=d(7538);function ln(o,n){1&o&&e.GkF(0)}const ee=function(o){return{$implicit:o}};function hn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"a",9),e.NdJ("click",function(){const s=e.CHM(t).$implicit,a=e.oxw();return e.KtG(a.select(s))}),e.YNc(1,ln,1,0,"ng-container",10),e.qZA()}if(2&o){const t=n.$implicit;e.oxw();const i=e.MAs(17);e.xp6(1),e.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",e.VKq(2,ee,t))}}function pn(o,n){1&o&&e.GkF(0)}function dn(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"a",9),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.select(r))}),e.YNc(1,pn,1,0,"ng-container",10),e.qZA()}if(2&o){const t=e.oxw().$implicit;e.oxw();const i=e.MAs(15);e.xp6(1),e.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",e.VKq(2,ee,t))}}function mn(o,n){if(1&o&&(e.ynx(0),e.YNc(1,dn,2,4,"a",11),e.BQk()),2&o){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf",!t.over)}}function fn(o,n){1&o&&e.GkF(0)}function un(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"a",9),e.NdJ("click",function(){e.CHM(t);const r=e.oxw().$implicit,s=e.oxw();return e.KtG(s.select(r))}),e.YNc(1,fn,1,0,"ng-container",10),e.qZA()}if(2&o){const t=e.oxw().$implicit;e.oxw();const i=e.MAs(15);e.xp6(1),e.Q6J("ngTemplateOutlet",i)("ngTemplateOutletContext",e.VKq(2,ee,t))}}function _n(o,n){if(1&o&&(e.ynx(0),e.YNc(1,un,2,4,"a",11),e.BQk()),2&o){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf",t.over)}}function gn(o,n){1&o&&e._UZ(0,"i",16),2&o&&e.Q6J("ngbTooltip","You WON!")}function bn(o,n){1&o&&e._UZ(0,"i",17),2&o&&e.Q6J("ngbTooltip","You LOST!")}function Cn(o,n){if(1&o&&(e.TgZ(0,"div",12),e.YNc(1,gn,1,1,"i",13),e.YNc(2,bn,1,1,"i",14),e._uU(3),e._UZ(4,"div",15),e.TgZ(5,"small"),e._uU(6),e.qZA()()),2&o){const t=n.$implicit;e.xp6(1),e.Q6J("ngIf",t.over&&t.winner===t.player.side),e.xp6(1),e.Q6J("ngIf",t.over&&t.winner!==t.player.side),e.xp6(1),e.AsE(" ",t.player.playerName," v. ",t.opponent.playerName," "),e.xp6(3),e.Oqu(t.id)}}function vn(o,n){if(1&o&&(e.TgZ(0,"div",12),e._UZ(1,"i",18),e._uU(2),e._UZ(3,"div",15),e.TgZ(4,"small"),e._uU(5),e.qZA()()),2&o){const t=n.$implicit;let i;e.xp6(2),e.AsE(" ",t.leftPlayerName," v. ",null!==(i=t.rightPlayerName)&&void 0!==i?i:"???"," "),e.xp6(3),e.Oqu(t.id)}}let yn=(()=>{class o{constructor(t,i,r){this.combatController=t,this.identityService=i,this.router=r,this.combats=[],this.combatsInPreparation=[],this.refreshing=!1}ngOnInit(){this.loadCombats().subscribe()}refresh(){this.loadCombats().subscribe()}create(){const t=this.identityService.getIdentity();this.combatController.createCombat(t).pipe((0,P.U)(i=>{this.router.toCombatConfiguration(i.id).then()})).subscribe()}select(t){t instanceof h.fQ?this.router.toCombatConfiguration(t.id).then():this.router.toCombat(t.id).then()}loadCombats(){const t=this.identityService.getIdentity();return this.refreshing=!0,(0,an.D)([this.combatController.getCombatsOfPlayer(t).pipe((0,P.U)(i=>{this.combats=i})),this.combatController.getCombatsInPreparationOfPlayer(t).pipe((0,P.U)(i=>{this.combatsInPreparation=i}))]).pipe((0,cn.l)(),(0,ye.x)(()=>this.refreshing=!1))}static#e=this.\u0275fac=function(i){return new(i||o)(e.Y36(h.cP),e.Y36(R.P),e.Y36(w.F0))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["ng-component"]],decls:18,vars:3,consts:[[1,"container"],[1,"btn","btn-secondary",3,"click"],[1,"bi","bi-plus"],[1,"list-group"],["class","list-group-item list-group-item-action",3,"click",4,"ngFor","ngForOf"],[4,"ngFor","ngForOf"],[1,"mt-5"],["combatEntry",""],["combatInPreparationEntry",""],[1,"list-group-item","list-group-item-action",3,"click"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],["class","list-group-item list-group-item-action",3,"click",4,"ngIf"],[1,"hstack","gap-2"],["class","bi bi-trophy-fill",3,"ngbTooltip",4,"ngIf"],["class","bi bi-x",3,"ngbTooltip",4,"ngIf"],[1,"flex-fill"],[1,"bi","bi-trophy-fill",3,"ngbTooltip"],[1,"bi","bi-x",3,"ngbTooltip"],["ngbTooltip","In preparation",1,"bi","bi-hourglass-split"]],template:function(i,r){1&i&&(e.TgZ(0,"section",0)(1,"h1"),e._uU(2," Combats "),e.TgZ(3,"button",1),e.NdJ("click",function(){return r.create()}),e._UZ(4,"i",2),e._uU(5," Create"),e.qZA()(),e.TgZ(6,"div",3),e.YNc(7,hn,2,4,"a",4),e.YNc(8,mn,2,1,"ng-container",5),e.qZA(),e.TgZ(9,"div",6)(10,"h2"),e._uU(11,"History"),e.qZA(),e.TgZ(12,"div",3),e.YNc(13,_n,2,1,"ng-container",5),e.qZA()()(),e.YNc(14,Cn,7,5,"ng-template",null,7,e.W1O),e.YNc(16,vn,6,3,"ng-template",null,8,e.W1O)),2&i&&(e.xp6(7),e.Q6J("ngForOf",r.combatsInPreparation),e.xp6(1),e.Q6J("ngForOf",r.combats),e.xp6(5),e.Q6J("ngForOf",r.combats))},dependencies:[u.sg,u.O5,u.tP,T._L],encapsulation:2})}return o})();w.F0.prototype.toCombatSelection=function(){return this.navigate(["/","combat","selection"])};var xn=d(2181);class Se{static getAllyTargets(n,t){switch(n){case h.Ct.Self:return t;case h.Ct.OtherAlly:return"front"===t?"back":"front";case h.Ct.FrontAlly:return"front";case h.Ct.BackAlly:return"back";case h.Ct.AllAllies:return"both";case h.Ct.None:case h.Ct.FrontOpponent:case h.Ct.BackOpponent:case h.Ct.AllOpponents:return"none"}}static getEnemyTargets(n){switch(n){case h.Ct.FrontOpponent:return"front";case h.Ct.BackOpponent:return"back";case h.Ct.AllOpponents:return"both";case h.Ct.None:case h.Ct.Self:case h.Ct.OtherAlly:case h.Ct.FrontAlly:case h.Ct.BackAlly:case h.Ct.AllAllies:return"none"}}}let U=(()=>{class o{set(t){this.combat=t}get(){return this.combat}getCharacter(t,i){if(this.combat&&i!==h.E1.None)return this.getCharacterOfSide(this.combat.player.side===i?this.combat.player:this.combat.opponent,t)}getPlayerName(t){if(this.combat&&t!==h.E1.None)return this.combat.player.side===t?this.combat.player.playerName:this.combat.opponent.playerName}getCharacterOfSide(t,i){return t.frontCharacter?.character.identity.name===i?t.frontCharacter:t.backCharacter?.character.identity.name===i?t.backCharacter:t.deadCharacters.find(r=>r.character.identity.name===i)}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275prov=e.Yz7({token:o,factory:o.\u0275fac})}return o})();var wn=d(5618),Sn=d(2748);const Tn=function(o){return{"width.%":o,backgroundColor:"var(--health-color)"}},In=function(o){return{"width.%":o,backgroundColor:"var(--shield-color)"}};let kn=(()=>{class o{constructor(){this._value=0,this._maxValue=0,this._shield=0,this.tooltipPlacement="bottom",this.healthPercent=0,this.shieldPercent=0,this.PerformanceObserverEntryList=PerformanceObserverEntryList}get value(){return this._value}set value(t){this._value=t,this.update()}get maxValue(){return this._maxValue}set maxValue(t){this._maxValue=t,this.update()}get shield(){return this._shield}set shield(t){this._shield=t,this.update()}update(){0===this._maxValue&&(this.healthPercent=0,this.shieldPercent=0,this.tooltip=void 0),this.healthPercent=100*Math.max(0,Math.min(this._value/this._maxValue,1)),this.shieldPercent=100*Math.max(0,Math.min(this._shield/this._maxValue,1)),this.tooltip=this._shield>0?`${this._value} (+ ${this._shield} / ${this._maxValue} HP`:`${this._value} / ${this._maxValue} HP`}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-health-bar"]],inputs:{value:"value",maxValue:"maxValue",shield:"shield",tooltipPlacement:"tooltipPlacement"},decls:3,vars:8,consts:[[1,"w-100","h-100","bg-dark","position-relative",3,"ngbTooltip","placement"],[1,"position-absolute","start-0","top-0","bottom-0","animate-width",3,"ngStyle"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0),e._UZ(1,"div",1)(2,"div",1),e.qZA()),2&i&&(e.Q6J("ngbTooltip",r.tooltip)("placement",r.tooltipPlacement),e.xp6(1),e.Q6J("ngStyle",e.VKq(4,Tn,r.healthPercent)),e.xp6(1),e.Q6J("ngStyle",e.VKq(6,In,r.shieldPercent)))},dependencies:[u.PC,T._L],styles:[".animate-width[_ngcontent-%COMP%]{transition:width .25s}"]})}return o})();var N=d(7339),En=d(9569);class Te{static getIcon(n){const t=this.getIconFromKnownEnchantment(n.name);if(t)return t;const i=this.getIconFromPassives(n.passive);if(i)return i;return this.getIconFromTriggered(n.triggered)||void 0}static getIconFromKnownEnchantment(n){if("burn"===n.toLowerCase())return"fire"}static getIconFromPassives(n){for(const t of n){if(t instanceof h.eH)return N.I.getIcon(t.type);if(t instanceof h.F)return N.I.getIcon(t.type)}}static getIconFromTriggered(n){for(const t of n){const i=En.X.getIcon(t.effect);if(i)return i}}}var z=d(36),Pn=d(5811);function Zn(o,n){1&o&&e.GkF(0)}function An(o,n){if(1&o&&(e.TgZ(0,"div",6)(1,"span",7),e._uU(2),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.hij(" ",t.duration," ")}}function Nn(o,n){if(1&o&&e._UZ(0,"app-asset-icon",10),2&o){const t=e.oxw(2);e.Q6J("icon",t.icon)("size",t.iconSize)}}function On(o,n){if(1&o&&(e.TgZ(0,"div",11)(1,"i"),e._uU(2),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(t.name[0])}}function Dn(o,n){if(1&o&&(e.YNc(0,Nn,1,2,"app-asset-icon",8),e.YNc(1,On,3,1,"div",9)),2&o){const t=e.oxw();e.Q6J("ngIf",t.icon),e.xp6(1),e.Q6J("ngIf",!t.icon)}}function Jn(o,n){1&o&&e.GkF(0)}function Rn(o,n){if(1&o&&(e.TgZ(0,"div",12),e.YNc(1,Jn,1,0,"ng-container",1),e._uU(2),e.qZA()),2&o){const t=e.oxw(),i=e.MAs(4);e.xp6(1),e.Q6J("ngTemplateOutlet",i),e.xp6(1),e.hij(" ",t.name," ")}}function Un(o,n){1&o&&e.Hsn(0)}const Qn=function(o,n){return{"width.px":o,"height.px":n}},Fn=["*"];let Ln=(()=>{class o{constructor(){this._name="",this._duration=0,this._size="md",this.sizeInPx=this.getSize(this._size),this.iconSize=this.getIconSize(this._size),this.popoverVisible=!1}get name(){return this._name}set name(t){this._name=t,this.tooltip=this.getTooltip(this._name,this._duration)}get duration(){return this._duration}set duration(t){this._duration=t,this.tooltip=this.getTooltip(this._name,this._duration)}get size(){return this._size}set size(t){this._size=t,this.sizeInPx=this.getSize(t)}getSize(t){switch(t){case"sm":return 16;case"md":return 32;case"lg":case"xl":return 64}}getIconSize(t){switch(t){case"sm":return"xs";case"md":return"sm";case"lg":return"md";case"xl":return"lg"}}getTooltip(t,i){return i?`${t} (${i} turns)`:t}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-combat-effect"]],inputs:{icon:"icon",name:"name",duration:"duration",size:"size",source:"source"},ngContentSelectors:Fn,decls:9,vars:8,consts:[[1,"border","border-1","d-flex","align-items-center","justify-content-center","user-select-none","position-relative",3,"ngStyle","stickyPopover","popoverTitle","shown","hidden"],[4,"ngTemplateOutlet"],["class","small bg-white border border-secondary-subtle rounded-circle p-2 position-absolute start-100 top-100 translate-middle",4,"ngIf"],["iconTpl",""],["popoverTitle",""],["popoverBody",""],[1,"small","bg-white","border","border-secondary-subtle","rounded-circle","p-2","position-absolute","start-100","top-100","translate-middle"],[1,"small","position-absolute","translate-middle"],[3,"icon","size",4,"ngIf"],["class","fw-bold small",4,"ngIf"],[3,"icon","size"],[1,"fw-bold","small"],[1,"hstack","gap-2"]],template:function(i,r){if(1&i&&(e.F$t(),e.TgZ(0,"div",0),e.NdJ("shown",function(){return r.popoverVisible=!0})("hidden",function(){return r.popoverVisible=!1}),e.YNc(1,Zn,1,0,"ng-container",1),e.YNc(2,An,3,1,"div",2),e.qZA(),e.YNc(3,Dn,2,2,"ng-template",null,3,e.W1O),e.YNc(5,Rn,3,2,"ng-template",null,4,e.W1O),e.YNc(7,Un,1,0,"ng-template",null,5,e.W1O)),2&i){const s=e.MAs(4),a=e.MAs(6),l=e.MAs(8);e.Q6J("ngStyle",e.WLB(5,Qn,r.sizeInPx,r.sizeInPx))("stickyPopover",l)("popoverTitle",a),e.xp6(1),e.Q6J("ngTemplateOutlet",s),e.xp6(1),e.Q6J("ngIf",r.duration)}},dependencies:[u.O5,u.tP,u.PC,z.t,Pn.r],encapsulation:2})}return o})();var Yn=d(6166);function $n(o,n){if(1&o&&e._UZ(0,"app-passive-effect-line",1),2&o){const t=e.oxw();e.Q6J("effect",t.effect.effect)("overrideDuration",t.effect.remainingDuration)}}let Mn=(()=>{class o{get effect(){return this._effect}set effect(t){this._effect=t,this.update()}update(){this.icon=void 0,this.name=void 0,this._effect&&(this._effect.effect instanceof h.eH||this._effect.effect instanceof h.F)&&(this.icon=N.I.getIcon(this._effect.effect.type),this.name=N.I.getName(this._effect.effect.type))}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-passive-effect-instance-line"]],inputs:{effect:"effect"},decls:1,vars:1,consts:[[3,"effect","overrideDuration",4,"ngIf"],[3,"effect","overrideDuration"]],template:function(i,r){1&i&&e.YNc(0,$n,1,2,"app-passive-effect-line",0),2&i&&e.Q6J("ngIf",r.effect)},dependencies:[u.O5,Yn.D],encapsulation:2})}return o})();var Hn=d(1474);function jn(o,n){if(1&o&&(e.TgZ(0,"div",1)(1,"div"),e._uU(2),e.qZA(),e._UZ(3,"app-active-effect-line",2),e.qZA()),2&o){const t=e.oxw();e.xp6(2),e.hij("",t.triggerString,":"),e.xp6(1),e.Q6J("effect",t.effect.effect.effect)}}let zn=(()=>{class o{get effect(){return this._effect}set effect(t){this._effect=t,this.update()}update(){this.triggerString=void 0,this._effect&&this._effect.triggerState instanceof h.ZX&&this._effect.effect.trigger instanceof h.RR&&(this.triggerString=this.computeTurnTriggerString(this._effect.source.name,this._effect.triggerState,this._effect.effect.trigger),this.duration=this._effect.triggerState.triggersIn>0?this._effect.triggerState.triggersIn:this._effect.triggerState.remainingDuration)}computeTurnTriggerString(t,i,r){let s="";switch(r.moment){case h.ko.StartOfSourceTurn:s="start of "+t+" turn";break;case h.ko.EndOfSourceTurn:s="end of "+t+" turn";break;case h.ko.StartOfTargetTurn:s="start of turn";break;case h.ko.EndOfTargetTurn:s="end of turn"}return i.triggersIn>0?i.remainingDuration>1?`in ${i.triggersIn} turns, every ${s} for ${i.remainingDuration} turns`:`in ${i.triggersIn} turns, at `+s:i.remainingDuration>0?`every ${s} for ${i.remainingDuration} turns`:void 0}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-triggered-effect-instance-line"]],inputs:{effect:"effect"},decls:1,vars:1,consts:[["class","vstack",4,"ngIf"],[1,"vstack"],[3,"effect"]],template:function(i,r){1&i&&e.YNc(0,jn,4,2,"div",0),2&i&&e.Q6J("ngIf",r.effect)},dependencies:[u.O5,Hn.S],encapsulation:2})}return o})();function Wn(o,n){1&o&&e._UZ(0,"app-passive-effect-instance-line",3),2&o&&e.Q6J("effect",n.$implicit)}function qn(o,n){1&o&&e._UZ(0,"app-triggered-effect-instance-line",3),2&o&&e.Q6J("effect",n.$implicit)}function Bn(o,n){if(1&o&&(e.TgZ(0,"app-combat-effect",1),e.YNc(1,Wn,1,1,"app-passive-effect-instance-line",2),e.YNc(2,qn,1,1,"app-triggered-effect-instance-line",2),e.qZA()),2&o){const t=e.oxw();e.Q6J("name",t.effect.enchantment.name)("icon",t.icon)("duration",t.duration),e.xp6(1),e.Q6J("ngForOf",t.effect.passive),e.xp6(1),e.Q6J("ngForOf",t.effect.triggered)}}let Gn=(()=>{class o{get effect(){return this._effect}set effect(t){this._effect=t,this.update()}update(){if(!this._effect)return this.icon=void 0,void(this.duration=void 0);this.icon=Te.getIcon(this._effect.enchantment);let t=0;for(const i of this._effect.passive)t=Math.max(t,i.remainingDuration);for(const i of this._effect.triggered)i.triggerState instanceof h.ZX&&(t=Math.max(t,i.triggerState.triggersIn+i.triggerState.remainingDuration));this.duration=t>0?t:void 0}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-enchantment-effect-instance"]],inputs:{effect:"effect"},decls:1,vars:1,consts:[[3,"name","icon","duration",4,"ngIf"],[3,"name","icon","duration"],[3,"effect",4,"ngFor","ngForOf"],[3,"effect"]],template:function(i,r){1&i&&e.YNc(0,Bn,3,5,"app-combat-effect",0),2&i&&e.Q6J("ngIf",r.effect)},dependencies:[u.sg,u.O5,Ln,Mn,zn],encapsulation:2})}return o})();function Kn(o,n){1&o&&e.GkF(0)}function Xn(o,n){if(1&o&&(e.TgZ(0,"div",3),e.YNc(1,Kn,1,0,"ng-container",4),e.qZA()),2&o){e.oxw();const t=e.MAs(3);e.xp6(1),e.Q6J("ngTemplateOutlet",t)}}function Vn(o,n){1&o&&e.GkF(0)}function eo(o,n){if(1&o&&(e.TgZ(0,"div",5),e.YNc(1,Vn,1,0,"ng-container",4),e.qZA()),2&o){e.oxw();const t=e.MAs(3);e.xp6(1),e.Q6J("ngTemplateOutlet",t)}}function to(o,n){1&o&&e._UZ(0,"app-enchantment-effect-instance",7),2&o&&e.Q6J("effect",n.$implicit)}function no(o,n){if(1&o&&e.YNc(0,to,1,1,"app-enchantment-effect-instance",6),2&o){const t=e.oxw();e.Q6J("ngForOf",null==t.character?null:t.character.enchantments)}}let oo=(()=>{class o{constructor(){this.size="md",this.mode="row"}get character(){return this._character}set character(t){this._character=t,this.update()}update(){}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-character-combat-effects"]],inputs:{character:"character",size:"size",mode:"mode"},decls:4,vars:2,consts:[["class","h-100 d-flex flex-column flex-wrap gap-1",4,"ngIf"],["class","w-100 d-flex flex-wrap flex-wrap-reverse gap-1",4,"ngIf"],["content",""],[1,"h-100","d-flex","flex-column","flex-wrap","gap-1"],[4,"ngTemplateOutlet"],[1,"w-100","d-flex","flex-wrap","flex-wrap-reverse","gap-1"],[3,"effect",4,"ngFor","ngForOf"],[3,"effect"]],template:function(i,r){1&i&&(e.YNc(0,Xn,2,1,"div",0),e.YNc(1,eo,2,1,"div",1),e.YNc(2,no,1,1,"ng-template",null,2,e.W1O)),2&i&&(e.Q6J("ngIf","col"===r.mode),e.xp6(1),e.Q6J("ngIf","row"===r.mode))},dependencies:[u.sg,u.O5,u.tP,Gn],styles:["[_nghost-%COMP%]{display:contents}"]})}return o})();const Ie=function(o){return{boxShadow:o}};function io(o,n){if(1&o&&e._UZ(0,"div",10),2&o){const t=e.oxw(2);e.Q6J("ngStyle",e.VKq(1,Ie,t.innerShadowCssValue))}}function ro(o,n){if(1&o&&e._UZ(0,"div",10),2&o){const t=e.oxw(2);e.Q6J("ngStyle",e.VKq(1,Ie,t.outerShadowCssValue))}}function so(o,n){if(1&o&&(e.ynx(0),e.TgZ(1,"div",1)(2,"div",2)(3,"div",3),e._UZ(4,"app-character-combat-effects",4),e.qZA(),e.TgZ(5,"div",5)(6,"div",6),e._UZ(7,"app-character-img",7),e.YNc(8,io,1,3,"div",8),e.YNc(9,ro,1,3,"div",8),e.qZA(),e._UZ(10,"app-health-bar",9),e.qZA()()(),e.BQk()),2&o){const t=e.oxw();e.xp6(2),e.ekj("flex-column-reverse",t.invert),e.xp6(2),e.Q6J("character",t.character)("size",t.size),e.xp6(3),e.Q6J("character",t.character.character)("size",t.size)("enablePopoverDetails",!0)("popoverPlacement",t.popoverPlacement)("footer",t.footer),e.xp6(1),e.Q6J("ngIf",t.innerShadowCssValue),e.xp6(1),e.Q6J("ngIf",t.outerShadowCssValue),e.xp6(1),e.Q6J("value",t.character.health)("maxValue",t.character.character.statistics.maxHealth)("shield",t.character.shield)}}let ao=(()=>{class o{constructor(){this.size="md",this.popoverPlacement="auto",this.invert=!1,this.innerShadowCssValue=this.getShadowCssValue(this.innerShadow,"inset "),this.outerShadowCssValue=this.getShadowCssValue(this.outerShadow)}get innerShadow(){return this._innerShadow}set innerShadow(t){this._innerShadow=t,this.innerShadowCssValue=this.getShadowCssValue(t,"inset ")}get outerShadow(){return this._outerShadow}set outerShadow(t){this._outerShadow=t,this.outerShadowCssValue=this.getShadowCssValue(t)}getShadowCssValue(t,i){if(!t)return;const r=(0,Sn.p)(t.color);return(i??"")+`0 0 ${t.blurInRem}rem ${r}`}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-combat-character-img"]],inputs:{character:"character",size:"size",popoverPlacement:"popoverPlacement",footer:"footer",invert:"invert",innerShadow:"innerShadow",outerShadow:"outerShadow"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"d-flex"],[1,"vstack","gap-1"],[1,"w-100","z-3"],["mode","row",3,"character","size"],[1,"vstack"],[1,"position-relative"],[3,"character","size","enablePopoverDetails","popoverPlacement","footer"],["class","position-absolute top-0 bottom-0 start-0 end-0",3,"ngStyle",4,"ngIf"],[1,"w-100",2,"height","0.5rem",3,"value","maxValue","shield"],[1,"position-absolute","top-0","bottom-0","start-0","end-0",3,"ngStyle"]],template:function(i,r){1&i&&e.YNc(0,so,11,14,"ng-container",0),2&i&&e.Q6J("ngIf",r.character)},dependencies:[u.O5,u.PC,X.o,kn,oo],encapsulation:2})}return o})();const ke=function(){return{blurInRem:3,color:"color-mix(in srgb, var(--self-color) 17.5%, transparent)"}},Ee=function(){return{blurInRem:3,color:"color-mix(in srgb, var(--enemy-color) 17.5%, transparent)"}},Pe=function(){return{blurInRem:3,color:"color-mix(in srgb, var(--ally-color) 17.5%, transparent)"}};function po(o,n){if(1&o&&e._UZ(0,"app-combat-character-img",13),2&o){const t=e.oxw(2);e.Q6J("character",t.side.backCharacter)("innerShadow",t.highlightSource===t.side.backCharacter.character.identity.name?e.DdM(4,ke):void 0)("outerShadow",t.highlightEnemies.includes(t.side.backCharacter.character.identity.name)?e.DdM(5,Ee):t.highlightAllies.includes(t.side.backCharacter.character.identity.name)?e.DdM(6,Pe):void 0)("invert",t.invert)}}function mo(o,n){if(1&o&&e._UZ(0,"app-combat-character-img",14),2&o){const t=e.oxw(2);e.Q6J("character",t.side.frontCharacter)("innerShadow",t.highlightSource===t.side.frontCharacter.character.identity.name?e.DdM(4,ke):void 0)("outerShadow",t.highlightEnemies.includes(t.side.frontCharacter.character.identity.name)?e.DdM(5,Ee):t.highlightAllies.includes(t.side.frontCharacter.character.identity.name)?e.DdM(6,Pe):void 0)("invert",t.invert)}}function fo(o,n){1&o&&e._UZ(0,"i",15),2&o&&e.ekj("text-secondary","empty"===n.$implicit)("text-primary","filled")}function uo(o,n){1&o&&e._UZ(0,"i",16)}function _o(o,n){if(1&o&&(e.ynx(0),e.TgZ(1,"div",1)(2,"div",2),e.YNc(3,po,1,7,"app-combat-character-img",3),e.YNc(4,mo,1,7,"app-combat-character-img",4),e.qZA(),e.TgZ(5,"div",5)(6,"div",6)(7,"div",7),e._UZ(8,"app-action-points-icon"),e.TgZ(9,"div",8),e._uU(10),e.qZA(),e.TgZ(11,"div",9),e.YNc(12,fo,1,4,"i",10),e.qZA()(),e.TgZ(13,"div",7)(14,"i",11),e._uU(15),e.qZA(),e.YNc(16,uo,1,0,"i",12),e.qZA()()()(),e.BQk()),2&o){const t=e.oxw();e.xp6(1),e.ekj("flex-row-reverse",t.invert),e.xp6(1),e.ekj("flex-row-reverse",t.invert),e.xp6(1),e.Q6J("ngIf",t.side.backCharacter),e.xp6(1),e.Q6J("ngIf",t.side.frontCharacter),e.xp6(1),e.ekj("flex-column-reverse",t.invert),e.xp6(1),e.ekj("flex-row-reverse",t.invert),e.xp6(4),e.AsE("",t.side.ap,"/",t.combat.maxAp,""),e.xp6(2),e.Q6J("ngForOf",t.aps),e.xp6(3),e.Oqu(t.side.playerName),e.xp6(1),e.Q6J("ngIf",t.isAi)}}let go=(()=>{class o{constructor(){this.isAi=!1,this.highlightEnemies=[],this.highlightAllies=[],this.invert=!1,this.aps=[]}get combat(){return this._combat}set combat(t){this._combat=t,this.update()}get side(){return this._side}set side(t){this._side=t,this.update()}update(){this.updateAps()}updateAps(){if(this.aps=[],this._combat&&this._side)for(let t=0;t<this._combat.maxAp;t++)this.aps.push(t<this._side.ap?"filled":"empty")}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-combat-side-common-elements"]],inputs:{combat:"combat",side:"side",isAi:"isAi",highlightSource:"highlightSource",highlightEnemies:"highlightEnemies",highlightAllies:"highlightAllies",invert:"invert"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"h-100","container-fluid","hstack"],[1,"hstack","w-50","justify-content-around"],["footer","Back","size","xl",3,"character","innerShadow","outerShadow","invert",4,"ngIf"],["footer","Front","size","xl",3,"character","innerShadow","outerShadow","invert",4,"ngIf"],[1,"w-50","vstack","justify-content-end"],[1,"hstack","m-4","gap-4","align-items-center","justify-content-end"],[1,"hstack","gap-2"],[1,"me-2"],[1,"hstack"],["class","bi bi-diamond-fill",3,"text-secondary","text-primary",4,"ngFor","ngForOf"],[1,"text-truncate","fw-bold","fs-3"],["class","bi bi-cpu","ngbTooltip","AI Player",4,"ngIf"],["footer","Back","size","xl",3,"character","innerShadow","outerShadow","invert"],["footer","Front","size","xl",3,"character","innerShadow","outerShadow","invert"],[1,"bi","bi-diamond-fill"],["ngbTooltip","AI Player",1,"bi","bi-cpu"]],template:function(i,r){1&i&&e.YNc(0,_o,17,15,"ng-container",0),2&i&&e.Q6J("ngIf",r.combat&&r.side)},dependencies:[u.sg,u.O5,wn.W,T._L,ao],styles:[".highlight-source[_ngcontent-%COMP%]{box-shadow:inset 0 0 3rem color-mix(in srgb,var(--self-color) 17.5%,transparent)}.highlight-ally[_ngcontent-%COMP%]{box-shadow:0 0 6rem color-mix(in srgb,var(--ally-color) 17.5%,transparent)}.highlight-enemy[_ngcontent-%COMP%]{box-shadow:0 0 6rem color-mix(in srgb,var(--enemy-color) 17.5%,transparent)}"]})}return o})();var bo=d(2606);function Co(o,n){if(1&o&&e._UZ(0,"app-character-img",3),2&o){const t=e.oxw();e.Q6J("character",t.character)}}let vo=(()=>{class o{constructor(){this.size="md",this._characters=[]}get card(){return this._card}set card(t){this._card=t,this.update()}get characters(){return this._characters}set characters(t){this._characters=t,this.update()}update(){this.character=this._card?this._characters.find(t=>t.identity.name===this._card.character):void 0}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-action-card-instance"]],inputs:{card:"card",size:"size",characters:"characters"},decls:3,vars:3,consts:[[1,"h-100","position-relative"],[3,"card","size"],["class","position-absolute bottom-0 end-0 m-2","size","sm",3,"character",4,"ngIf"],["size","sm",1,"position-absolute","bottom-0","end-0","m-2",3,"character"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0),e._UZ(1,"app-action-card",1),e.YNc(2,Co,1,1,"app-character-img",2),e.qZA()),2&i&&(e.xp6(1),e.Q6J("card",null==r.card?null:r.card.card)("size",r.size),e.xp6(1),e.Q6J("ngIf",r.character))},dependencies:[u.O5,X.o,bo.o],encapsulation:2})}return o})();function yo(o,n){1&o&&e._UZ(0,"div",8)}function xo(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"button",5),e.NdJ("click",function(){const s=e.CHM(t).index,a=e.oxw(2);return e.KtG(a.sendPlay(s))}),e.TgZ(1,"app-action-card-instance",6),e.NdJ("mouseenter",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.mouseEnter(s))})("mouseleave",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.mouseLeave(s))}),e.qZA(),e.YNc(2,yo,1,0,"div",7),e.qZA()}if(2&o){const t=n.$implicit,i=e.oxw(2);e.ekj("highlight",i.hoveredCharacter===t.character),e.xp6(1),e.Q6J("card",t)("characters",i.characters),e.xp6(1),e.Q6J("ngIf",i.disabled||t.card.apCost>i.combat.player.ap)}}function wo(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.TgZ(1,"div",1)(2,"div",2),e.YNc(3,xo,3,5,"button",3),e.qZA(),e.TgZ(4,"button",4),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.sendEndTurn())}),e._uU(5," End Turn "),e.qZA()(),e.BQk()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngForOf",t.combat.player.hand),e.xp6(1),e.ekj("btn-primary",t.combat.currentSide===t.combat.player.side)("btn-disabled",t.combat.currentSide!==t.combat.player.side),e.Q6J("disabled",t.disabled)}}let So=(()=>{class o{get disabled(){return this._disabled}set disabled(t){this._disabled=t,this.clearMouseHover()}constructor(t){this.charactersService=t,this._disabled=!1,this.play=new e.vpe,this.endTurn=new e.vpe,this.hover=new e.vpe,this.characters=[],this.CombatSide=h.E1}ngOnInit(){this.charactersService.getAll().subscribe(t=>this.characters=t)}sendPlay(t){this.disabled||this.play.emit(t)}sendEndTurn(){this.disabled||this.endTurn.emit()}mouseEnter(t){this.hoveredCharacter=t.character,this.hover.emit(t)}mouseLeave(t){this.hoveredCharacter===t.character&&this.clearMouseHover()}clearMouseHover(){this.hoveredCharacter=void 0,this.hover.emit(void 0)}static#e=this.\u0275fac=function(i){return new(i||o)(e.Y36(h.R))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-player-side-elements"]],inputs:{combat:"combat",disabled:"disabled"},outputs:{play:"play",endTurn:"endTurn",hover:"hover"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"h-100","w-100","container-fluid","hstack","p-4"],[1,"flex-fill","hstack","justify-content-center","gap-2"],["class","btn m-0 p-0 position-relative","style","height: 100%; width: 175px",3,"highlight","click",4,"ngFor","ngForOf"],[1,"btn","p-4",3,"disabled","click"],[1,"btn","m-0","p-0","position-relative",2,"height","100%","width","175px",3,"click"],["size","sm",3,"card","characters","mouseenter","mouseleave"],["class","rounded-3 position-absolute top-0 bottom-0 start-0 end-0 pe-none","style","background-color: rgba(0, 0, 0, 0.05)",4,"ngIf"],[1,"rounded-3","position-absolute","top-0","bottom-0","start-0","end-0","pe-none",2,"background-color","rgba(0, 0, 0, 0.05)"]],template:function(i,r){1&i&&e.YNc(0,wo,6,6,"ng-container",0),2&i&&e.Q6J("ngIf",r.combat)},dependencies:[u.sg,u.O5,vo],styles:[".highlight[_ngcontent-%COMP%]{box-shadow:0 .5rem 1rem #0000002d}"]})}return o})();function To(o,n){if(1&o&&(e.TgZ(0,"i",5),e._uU(1),e.qZA()),2&o){const t=e.oxw(2);e.xp6(1),e.Oqu(t.currentPlayer)}}function Io(o,n){if(1&o&&(e.TgZ(0,"div",6)(1,"span",7),e._uU(2,"Combat over"),e.qZA(),e.TgZ(3,"span",8),e._uU(4),e.qZA()()),2&o){const t=e.oxw(2);e.xp6(4),e.hij(" ",t.combat.winner===t.combat.player.side?"You WON!":"You LOST!"," ")}}function ko(o,n){if(1&o&&(e.TgZ(0,"div",1),e.YNc(1,To,2,1,"i",2),e._UZ(2,"div",3),e.YNc(3,Io,5,1,"div",4),e._UZ(4,"div",3),e.TgZ(5,"h2"),e._uU(6),e.qZA()()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.currentPlayer),e.xp6(2),e.Q6J("ngIf",t.combat.over),e.xp6(3),e.hij("Turn ",t.combat.turn,"")}}let Eo=(()=>{class o{constructor(){this.TurnTriggerView=h.RR}get combat(){return this._combat}set combat(t){this._combat=t,this.update()}update(){this.currentPlayer=this._combat?this._combat.currentSide==h.E1.Left?this._combat.leftPlayerName:this._combat.currentSide==h.E1.Right?this._combat.rightPlayerName:void 0:void 0}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-combat-common-elements"]],inputs:{combat:"combat"},decls:1,vars:1,consts:[["class","hstack gap-2 position-relative px-4",4,"ngIf"],[1,"hstack","gap-2","position-relative","px-4"],["class","fw-bold fs-4",4,"ngIf"],[1,"flex-fill"],["class","position-absolute top-0 bottom-0 start-0 end-0 d-flex flex-column justify-content-center align-items-center pe-none",4,"ngIf"],[1,"fw-bold","fs-4"],[1,"position-absolute","top-0","bottom-0","start-0","end-0","d-flex","flex-column","justify-content-center","align-items-center","pe-none"],[1,"pe-auto"],[1,"fw-bold","fs-2","pe-auto"]],template:function(i,r){1&i&&e.YNc(0,ko,7,3,"div",0),2&i&&e.Q6J("ngIf",r.combat)},dependencies:[u.O5],encapsulation:2})}return o})();var Po=d(9953);class Q{static computeEffectGroups(n,t){const i=[];let r,s=[];for(const a of t){const l=this.getEffect(a);l&&(r&&(this.effectEquals(l,r)?s.push(a.character):(i.push({effect:r,targets:s.map(p=>({character:p,identity:this.getCharacterState(n,p)})).filter(p=>!!p.identity).map(p=>({character:p.character,identity:p.identity})).map(p=>({...p.character,...p.identity}))}),r=void 0,s=[])),r||(r=l,s=[a.character]))}return null!=r&&i.push({effect:r,targets:s.map(a=>({character:a,identity:this.getCharacterState(n,a)})).filter(a=>!!a.identity).map(a=>({character:a.character,identity:a.identity})).map(a=>({...a.character,...a.identity}))}),i}static getCharacterState(n,t){const i=n.getCharacter(t.name,t.side);if(i)return{...t,...i}}static getEffect(n){return n instanceof h.q5?{...n.damage,type:"damage"}:n instanceof h.BV?{...n.heal,type:"heal"}:n instanceof h.Fl?{...n.shield,type:"shield"}:n instanceof h.Ki?{...n.enchantment,type:"enchantment"}:n instanceof h.tn?{type:"death"}:void 0}static effectEquals(n,t){return"damage"===n.type&&"damage"===t.type?n.shield===t.shield&&n.health===t.health:"heal"===n.type&&"heal"===t.type?n.health===t.health:"shield"===n.type&&"shield"===t.type?n.shield===t.shield:"enchantment"===n.type&&"enchantment"===t.type?n.name===t.name:"death"===n.type&&"death"===t.type||void 0}}var Zo=d(152),F=d(6567);let Ao=(()=>{class o{get card(){return this._card}set card(t){this._card=t,this.update()}update(){if(this._card)switch(Zo.N.getType(this._card)){case F.eT.None:this.elementClass=void 0;break;case F.eT.Damage:switch(this._card.mainEffect.element){case h.W_.Neutral:this.elementClass="neutral-color";break;case h.W_.Fire:this.elementClass="fire-color";break;case h.W_.Earth:this.elementClass="earth-color";break;case h.W_.Water:this.elementClass="water-color";break;case h.W_.Wind:this.elementClass="wind-color"}break;case F.eT.Heal:this.elementClass="heal-card-color";break;case F.eT.Shield:this.elementClass="shield-card-color";break;case F.eT.Enchantment:this.elementClass="enchantment-card-color"}else this.elementClass=void 0}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275dir=e.lG2({type:o,selectors:[["","textColorFromCard",""]],hostVars:2,hostBindings:function(i,r){2&i&&e.Tol(r.elementClass)},inputs:{card:["textColorFromCard","card"]}})}return o})();var No=d(912),Oo=d(4561),Ze=d(258);let Ae=(()=>{class o{constructor(){this.size="md",this.noColor=!1,this.pxOffsetX=0,this.pxOffsetY=0}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-health-icon"]],inputs:{size:"size",noColor:"noColor",pxOffsetX:"pxOffsetX",pxOffsetY:"pxOffsetY"},decls:1,vars:4,consts:[["icon","heart","ngbTooltip","Health",3,"color","size","pxOffsetX","pxOffsetY"]],template:function(i,r){1&i&&e._UZ(0,"app-asset-icon",0),2&i&&e.Q6J("color",r.noColor?void 0:"--health-color")("size",r.size)("pxOffsetX",r.pxOffsetX)("pxOffsetY",r.pxOffsetY)},dependencies:[T._L,z.t],encapsulation:2})}return o})();var te=d(1939);function Do(o,n){if(1&o&&(e.TgZ(0,"span",3)(1,"span",4),e._uU(2),e.ALo(3,"sign"),e.qZA(),e._UZ(4,"app-shield-icon",5),e.qZA()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,2,-t.damageReceived.shield)),e.xp6(2),e.Q6J("pxOffsetY",2)}}function Jo(o,n){if(1&o&&(e.TgZ(0,"span",3)(1,"span",6),e._uU(2),e.ALo(3,"sign"),e.qZA(),e._UZ(4,"app-health-icon",5),e.qZA()),2&o){const t=e.oxw(2);e.xp6(2),e.Oqu(e.lcZ(3,2,-t.damageReceived.health)),e.xp6(2),e.Q6J("pxOffsetY",2)}}function Ro(o,n){if(1&o&&(e.TgZ(0,"div",1),e.YNc(1,Do,5,4,"span",2),e.YNc(2,Jo,5,4,"span",2),e.qZA()),2&o){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",t.damageReceived.shield>0),e.xp6(1),e.Q6J("ngIf",t.damageReceived.health>0)}}let Uo=(()=>{class o{static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-damage-received"]],inputs:{damageReceived:"damageReceived"},decls:1,vars:1,consts:[["class","hstack gap-2 align-items-center",4,"ngIf"],[1,"hstack","gap-2","align-items-center"],["class","hstack gap-1",4,"ngIf"],[1,"hstack","gap-1"],[1,"shield-color"],["size","sm",3,"pxOffsetY"],[1,"health-color"]],template:function(i,r){1&i&&e.YNc(0,Ro,3,2,"div",0),2&i&&e.Q6J("ngIf",r.damageReceived)},dependencies:[u.O5,Ze.X,Ae,te.F],encapsulation:2})}return o})();function Qo(o,n){if(1&o&&(e.TgZ(0,"div",1)(1,"span",2)(2,"span",3),e._uU(3),e.ALo(4,"sign"),e.qZA(),e._UZ(5,"app-shield-icon",4),e.qZA()()),2&o){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,2,t.shieldReceived.shield)),e.xp6(2),e.Q6J("pxOffsetY",2)}}let Fo=(()=>{class o{static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-shield-received"]],inputs:{shieldReceived:"shieldReceived"},decls:1,vars:1,consts:[["class","hstack gap-2 align-items-center",4,"ngIf"],[1,"hstack","gap-2","align-items-center"],[1,"hstack","gap-1"],[1,"shield-color"],["size","sm",3,"pxOffsetY"]],template:function(i,r){1&i&&e.YNc(0,Qo,6,4,"div",0),2&i&&e.Q6J("ngIf",r.shieldReceived)},dependencies:[u.O5,Ze.X,te.F],encapsulation:2})}return o})();function Lo(o,n){if(1&o&&(e.TgZ(0,"div",1)(1,"span",2)(2,"span",3),e._uU(3),e.ALo(4,"sign"),e.qZA(),e._UZ(5,"app-health-icon",4),e.qZA()()),2&o){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,2,t.healReceived.health)),e.xp6(2),e.Q6J("pxOffsetY",2)}}let Yo=(()=>{class o{static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-heal-received"]],inputs:{healReceived:"healReceived"},decls:1,vars:1,consts:[["class","hstack gap-2 align-items-center",4,"ngIf"],[1,"hstack","gap-2","align-items-center"],[1,"hstack","gap-1"],[1,"health-color"],["size","sm",3,"pxOffsetY"]],template:function(i,r){1&i&&e.YNc(0,Lo,6,4,"div",0),2&i&&e.Q6J("ngIf",r.healReceived)},dependencies:[u.O5,Ae,te.F],encapsulation:2})}return o})();function $o(o,n){if(1&o&&e._UZ(0,"app-asset-icon",1),2&o){const t=e.oxw();e.Q6J("icon",t.assetIcon)("color",t.noColor?void 0:"--enchantment-color")("size",t.size)("pxOffsetX",t.pxOffsetX)("pxOffsetY",t.pxOffsetY)}}let Mo=(()=>{class o{constructor(){this.size="md",this.noColor=!1,this.pxOffsetX=0,this.pxOffsetY=0}get enchantment(){return this._enchantment}set enchantment(t){this._enchantment=t,this.update()}update(){this.assetIcon=void 0,this._enchantment&&(this.assetIcon=Te.getIcon(this._enchantment))}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-enchantment-icon"]],inputs:{enchantment:"enchantment",size:"size",noColor:"noColor",pxOffsetX:"pxOffsetX",pxOffsetY:"pxOffsetY"},decls:1,vars:1,consts:[[3,"icon","color","size","pxOffsetX","pxOffsetY",4,"ngIf"],[3,"icon","color","size","pxOffsetX","pxOffsetY"]],template:function(i,r){1&i&&e.YNc(0,$o,1,5,"app-asset-icon",0),2&i&&e.Q6J("ngIf",r.assetIcon)},dependencies:[u.O5,z.t],encapsulation:2})}return o})();var Ne=d(2122);function Ho(o,n){if(1&o&&(e.TgZ(0,"app-with-enchantment-popover",1)(1,"span",2)(2,"span"),e._uU(3),e.qZA(),e._UZ(4,"app-enchantment-icon",3),e.qZA()()),2&o){const t=e.oxw();e.Q6J("enchantment",t.enchantment),e.xp6(3),e.Oqu(t.enchantment.name),e.xp6(1),e.Q6J("enchantment",t.enchantment)("noColor",!0)("pxOffsetY",2)}}let jo=(()=>{class o{static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-enchantment-received"]],inputs:{enchantment:"enchantment"},decls:1,vars:1,consts:[[3,"enchantment",4,"ngIf"],[3,"enchantment"],[1,"hstack","gap-1"],["size","sm",3,"enchantment","noColor","pxOffsetY"]],template:function(i,r){1&i&&e.YNc(0,Ho,5,5,"app-with-enchantment-popover",0),2&i&&e.Q6J("ngIf",r.enchantment)},dependencies:[u.O5,Mo,Ne.t],encapsulation:2})}return o})(),zo=(()=>{class o{constructor(){this.size="md",this.pxOffsetX=0,this.pxOffsetY=0}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-death-icon"]],inputs:{size:"size",color:"color",pxOffsetX:"pxOffsetX",pxOffsetY:"pxOffsetY"},decls:1,vars:4,consts:[["icon","death-skull","ngbTooltip","Dead",3,"color","size","pxOffsetX","pxOffsetY"]],template:function(i,r){1&i&&e._UZ(0,"app-asset-icon",0),2&i&&e.Q6J("color",r.color)("size",r.size)("pxOffsetX",r.pxOffsetX)("pxOffsetY",r.pxOffsetY)},dependencies:[T._L,z.t],encapsulation:2})}return o})(),Wo=(()=>{class o{static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-character-died"]],decls:3,vars:1,consts:[[1,"hstack","gap-1"],["size","sm",3,"pxOffsetY"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0),e._uU(1," died "),e._UZ(2,"app-death-icon",1),e.qZA()),2&i&&(e.xp6(2),e.Q6J("pxOffsetY",2))},dependencies:[zo],encapsulation:2})}return o})();function qo(o,n){1&o&&(e.ynx(0),e._uU(1,",\xa0"),e.BQk())}function Bo(o,n){if(1&o){const t=e.EpF();e.ynx(0),e.YNc(1,qo,2,0,"ng-container",10),e.TgZ(2,"span",11),e.NdJ("mouseenter",function(){const s=e.CHM(t).$implicit,a=e.oxw(2);return e.KtG(a.highlight.emit(s))})("mouseleave",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.highlight.emit(void 0))}),e._uU(3),e.qZA(),e.BQk()}if(2&o){const t=n.$implicit,i=n.index;e.xp6(1),e.Q6J("ngIf",i>0),e.xp6(2),e.hij(" ",t.character.identity.displayName," ")}}function Go(o,n){if(1&o&&e._UZ(0,"app-damage-received",12),2&o){const t=e.oxw().$implicit;e.Q6J("damageReceived",t.effect)}}function Ko(o,n){if(1&o&&e._UZ(0,"app-shield-received",13),2&o){const t=e.oxw().$implicit;e.Q6J("shieldReceived",t.effect)}}function Xo(o,n){if(1&o&&e._UZ(0,"app-heal-received",14),2&o){const t=e.oxw().$implicit;e.Q6J("healReceived",t.effect)}}function Vo(o,n){if(1&o&&e._UZ(0,"app-enchantment-received",15),2&o){const t=e.oxw().$implicit;e.Q6J("enchantment",t.effect)}}function ei(o,n){1&o&&e._UZ(0,"app-character-died")}function ti(o,n){if(1&o&&(e.TgZ(0,"div",1),e.YNc(1,Bo,4,2,"ng-container",2),e._UZ(2,"span",3),e.ynx(3,4),e.YNc(4,Go,1,1,"app-damage-received",5),e.YNc(5,Ko,1,1,"app-shield-received",6),e.YNc(6,Xo,1,1,"app-heal-received",7),e.YNc(7,Vo,1,1,"app-enchantment-received",8),e.YNc(8,ei,1,0,"app-character-died",9),e.BQk(),e.qZA()),2&o){const t=n.$implicit;e.xp6(1),e.Q6J("ngForOf",t.targets),e.xp6(2),e.Q6J("ngSwitch",t.effect.type),e.xp6(1),e.Q6J("ngSwitchCase","damage"),e.xp6(1),e.Q6J("ngSwitchCase","shield"),e.xp6(1),e.Q6J("ngSwitchCase","heal"),e.xp6(1),e.Q6J("ngSwitchCase","enchantment"),e.xp6(1),e.Q6J("ngSwitchCase","death")}}let Oe=(()=>{class o{constructor(){this.effects=[],this.highlight=new e.vpe}static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-combat-log-effect-group"]],inputs:{effects:"effects"},outputs:{highlight:"highlight"},decls:1,vars:1,consts:[["class","hstack flex-wrap",4,"ngFor","ngForOf"],[1,"hstack","flex-wrap"],[4,"ngFor","ngForOf"],[2,"width","0.5rem"],[3,"ngSwitch"],[3,"damageReceived",4,"ngSwitchCase"],[3,"shieldReceived",4,"ngSwitchCase"],[3,"healReceived",4,"ngSwitchCase"],[3,"enchantment",4,"ngSwitchCase"],[4,"ngSwitchCase"],[4,"ngIf"],[1,"fw-semibold",3,"mouseenter","mouseleave"],[3,"damageReceived"],[3,"shieldReceived"],[3,"healReceived"],[3,"enchantment"]],template:function(i,r){1&i&&e.YNc(0,ti,9,7,"div",0),2&i&&e.Q6J("ngForOf",r.effects)},dependencies:[u.sg,u.O5,u.RF,u.n9,Uo,Fo,Yo,jo,Wo],encapsulation:2})}return o})();const ni=function(){return["left","right"]};function oi(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"div",1)(2,"div",2)(3,"span",3),e.NdJ("mouseenter",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.highlight.emit(r.source))})("mouseleave",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.highlight.emit(void 0))}),e._uU(4),e.qZA(),e._uU(5," used "),e.TgZ(6,"app-with-card-popover",4)(7,"span",5),e._uU(8),e.qZA()(),e._UZ(9,"app-action-card-type-icon",6),e.qZA()(),e.TgZ(10,"app-combat-log-effect-group",7),e.NdJ("highlight",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.highlight.emit(r))}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(4),e.hij(" ",null==t.source||null==t.source.character||null==t.source.character.identity?null:t.source.character.identity.displayName," "),e.xp6(2),e.Q6J("card",t.entry.card)("placement",e.DdM(7,ni)),e.xp6(1),e.Q6J("textColorFromCard",t.entry.card),e.xp6(1),e.Oqu(t.entry.card.name),e.xp6(1),e.Q6J("card",t.entry.card),e.xp6(1),e.Q6J("effects",t.effects)}}let ii=(()=>{class o{get entry(){return this._entry}set entry(t){this._entry=t,this.update()}constructor(t){this.currentCombatService=t,this.highlight=new e.vpe,this.effects=[],this.playerSide=h.E1.None,this.left=Po.t$}ngOnInit(){this.playerSide=this.currentCombatService.get()?.player.side??h.E1.None}update(){this.effects=[],this._entry&&(this.source=Q.getCharacterState(this.currentCombatService,this._entry.source),this.effects=Q.computeEffectGroups(this.currentCombatService,this._entry.effects))}static#e=this.\u0275fac=function(i){return new(i||o)(e.Y36(U))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-card-played-log-entry"]],inputs:{entry:"entry"},outputs:{highlight:"highlight"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"hstack"],[1,"hstack","gap-1"],[1,"fw-semibold",3,"mouseenter","mouseleave"],[3,"card","placement"],[1,"fw-semibold",3,"textColorFromCard"],[3,"card"],[3,"effects","highlight"]],template:function(i,r){1&i&&e.YNc(0,oi,11,8,"div",0),2&i&&e.Q6J("ngIf",r.entry)},dependencies:[u.O5,Ao,No.W,Oo.c,Oe],encapsulation:2})}return o})();function ri(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div")(1,"div",1)(2,"div",2)(3,"app-with-enchantment-popover",3)(4,"span",4),e._uU(5),e.qZA()(),e._uU(6," triggered on "),e.TgZ(7,"span",5),e.NdJ("mouseenter",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.highlight.emit(r.target))})("mouseleave",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.highlight.emit(void 0))}),e._uU(8),e.qZA()()(),e.TgZ(9,"app-combat-log-effect-group",6),e.NdJ("highlight",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.highlight.emit(r))}),e.qZA()()}if(2&o){const t=e.oxw();e.xp6(3),e.Q6J("enchantment",t.entry.enchantment),e.xp6(2),e.Oqu(t.entry.enchantment.name),e.xp6(3),e.hij(" ",null==t.target||null==t.target.character||null==t.target.character.identity?null:t.target.character.identity.displayName," "),e.xp6(1),e.Q6J("effects",t.effects)}}let si=(()=>{class o{get entry(){return this._entry}set entry(t){this._entry=t,this.update()}constructor(t){this.currentCombatService=t,this.highlight=new e.vpe,this.effects=[]}update(){this.effects=[],this._entry&&(this.source=Q.getCharacterState(this.currentCombatService,this._entry.source),this.target=Q.getCharacterState(this.currentCombatService,this._entry.target),this.effects=Q.computeEffectGroups(this.currentCombatService,this._entry.effectsOnCharacters))}static#e=this.\u0275fac=function(i){return new(i||o)(e.Y36(U))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-triggered-effect-log-entry"]],inputs:{entry:"entry"},outputs:{highlight:"highlight"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"hstack"],[1,"hstack","gap-1"],[3,"enchantment"],[1,"fw-semibold"],[1,"fw-semibold",3,"mouseenter","mouseleave"],[3,"effects","highlight"]],template:function(i,r){1&i&&e.YNc(0,ri,10,4,"div",0),2&i&&e.Q6J("ngIf",r.entry)},dependencies:[u.O5,Ne.t,Oe],encapsulation:2})}return o})();function ai(o,n){1&o&&(e.ynx(0),e._uU(1," Your turn "),e.BQk())}function ci(o,n){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const t=e.oxw(5);e.xp6(1),e.hij(" ",t.opponentName,"'s turn ")}}function li(o,n){if(1&o&&(e.TgZ(0,"div",2),e.YNc(1,ai,2,0,"ng-container",9),e.YNc(2,ci,2,1,"ng-container",9),e.qZA()),2&o){const t=e.oxw().$implicit,i=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.side===i.playerSide),e.xp6(1),e.Q6J("ngIf",t.side===i.opponentSide)}}function hi(o,n){1&o&&(e.ynx(0),e._uU(1," Waiting for you to play... "),e.BQk())}function pi(o,n){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const t=e.oxw(5);e.xp6(1),e.hij(" Waiting for ",t.opponentName," to play... ")}}function di(o,n){if(1&o&&(e.TgZ(0,"div",2),e.YNc(1,hi,2,0,"ng-container",9),e.YNc(2,pi,2,1,"ng-container",9),e.qZA()),2&o){const t=e.oxw().$implicit,i=e.oxw(3);e.xp6(1),e.Q6J("ngIf",t.side===i.playerSide),e.xp6(1),e.Q6J("ngIf",t.side===i.opponentSide)}}function mi(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"app-card-played-log-entry",11),e.NdJ("highlight",function(r){e.CHM(t);const s=e.oxw(5);return e.KtG(s.highlight.emit(r))}),e.qZA()}if(2&o){const t=e.oxw().$implicit;e.Q6J("entry",t)}}function fi(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"app-triggered-effect-log-entry",11),e.NdJ("highlight",function(r){e.CHM(t);const s=e.oxw(5);return e.KtG(s.highlight.emit(r))}),e.qZA()}if(2&o){const t=e.oxw().$implicit;e.Q6J("entry",t)}}function ui(o,n){1&o&&(e.ynx(0),e._uU(1," DRAW!"),e.BQk())}function _i(o,n){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const t=e.oxw(2).$implicit,i=e.oxw(4);e.xp6(1),e.hij(" ",i.getWinner(t)," WON!")}}function gi(o,n){if(1&o&&(e.TgZ(0,"div",2)(1,"div",2),e._uU(2,"Combat ended"),e.qZA(),e.YNc(3,ui,2,0,"ng-container",9),e.YNc(4,_i,2,1,"ng-container",9),e.qZA()),2&o){const t=e.oxw().$implicit,i=e.oxw(4);e.xp6(3),e.Q6J("ngIf",t.winner===i.CombatSide.None),e.xp6(1),e.Q6J("ngIf",t.winner!==i.CombatSide.None)}}function bi(o,n){if(1&o&&(e.ynx(0)(1,7),e.YNc(2,mi,1,1,"app-card-played-log-entry",10),e.YNc(3,fi,1,1,"app-triggered-effect-log-entry",10),e.YNc(4,gi,5,2,"div",8),e.BQk()()),2&o){const t=n.$implicit,i=e.oxw(4);e.xp6(1),e.Q6J("ngSwitch",i.getType(t)),e.xp6(1),e.Q6J("ngSwitchCase",i.EntryType.PlayCard),e.xp6(1),e.Q6J("ngSwitchCase",i.EntryType.TriggeredEffect),e.xp6(1),e.Q6J("ngSwitchCase",i.EntryType.CombatEnded)}}function Ci(o,n){if(1&o&&(e.ynx(0)(1,7),e.YNc(2,li,3,2,"div",8),e.YNc(3,di,3,2,"div",8),e.BQk(),e.YNc(4,bi,5,4,"ng-container",3),e.BQk()),2&o){const t=n.$implicit,i=e.oxw(3);e.xp6(1),e.Q6J("ngSwitch",t.phase),e.xp6(1),e.Q6J("ngSwitchCase",i.CombatSideTurnPhase.StartOfTurn),e.xp6(1),e.Q6J("ngSwitchCase",i.CombatSideTurnPhase.Play),e.xp6(1),e.Q6J("ngForOf",t.entries)}}function vi(o,n){1&o&&(e.TgZ(0,"div",2),e._uU(1,"End of turn"),e.qZA())}function yi(o,n){if(1&o&&(e.ynx(0),e.TgZ(1,"div",4)(2,"span",2),e._uU(3),e.qZA(),e._UZ(4,"hr",5),e.qZA(),e.YNc(5,Ci,5,4,"ng-container",3),e.YNc(6,vi,2,0,"div",6),e.BQk()),2&o){const t=n.$implicit,i=n.last;e.xp6(3),e.hij("Turn ",t.turn,""),e.xp6(2),e.Q6J("ngForOf",t.phases),e.xp6(1),e.Q6J("ngIf",!i)}}function xi(o,n){if(1&o&&(e.TgZ(0,"div",1)(1,"div",2),e._uU(2,"Combat started"),e.qZA(),e.YNc(3,yi,7,3,"ng-container",3),e.qZA()),2&o){const t=e.oxw();e.xp6(3),e.Q6J("ngForOf",t.log.turns)}}let wi=(()=>{class o{get log(){return this._log}set log(t){this._log=t,this.update()}constructor(t){this.currentCombatService=t,this.highlight=new e.vpe,this.EntryType=L,this.CombatSide=h.E1,this.CombatSideTurnPhase=h.S7}getType(t){return t instanceof h.HW?L.PlayCard:t instanceof h.lY?L.TriggeredEffect:t instanceof h.vf?L.CombatEnded:void 0}getWinner(t){if(t.winner!==h.E1.None)return this.currentCombatService.getPlayerName(t.winner)}update(){const t=this.currentCombatService.get();this.playerSide=t?.player.side,this.playerName=t?.player.playerName,this.opponentSide=t?.opponent.side,this.opponentName=t?.opponent.playerName}static#e=this.\u0275fac=function(i){return new(i||o)(e.Y36(U))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-combat-log"]],inputs:{log:"log"},outputs:{highlight:"highlight"},decls:1,vars:1,consts:[["class","container-fluid",4,"ngIf"],[1,"container-fluid"],[1,"fw-bold"],[4,"ngFor","ngForOf"],[1,"hstack","gap-2"],[1,"flex-fill"],["class","fw-bold",4,"ngIf"],[3,"ngSwitch"],["class","fw-bold",4,"ngSwitchCase"],[4,"ngIf"],[3,"entry","highlight",4,"ngSwitchCase"],[3,"entry","highlight"]],template:function(i,r){1&i&&e.YNc(0,xi,4,1,"div",0),2&i&&e.Q6J("ngIf",r.log)},dependencies:[u.sg,u.O5,u.RF,u.n9,ii,si],encapsulation:2})}return o})();var L=function(o){return o.PlayCard="play-card",o.TriggeredEffect="triggered-effect",o.CombatEnded="combat-ended",o}(L||{});const Si=["combatLog"];function Ti(o,n){if(1&o&&(e.ynx(0),e._uU(1),e.BQk()),2&o){const t=e.oxw(2);e.xp6(1),e.hij(" - ",t.combat.winner===t.combat.player.side?"Winner: "+t.combat.player.playerName:t.combat.winner===t.combat.opponent.side?"Winner: "+t.combat.opponent.playerName:"DRAW"," ")}}function Ii(o,n){if(1&o&&(e.TgZ(0,"div",7)(1,"div"),e._uU(2),e.qZA(),e.TgZ(3,"div"),e._uU(4),e.YNc(5,Ti,2,1,"ng-container",8),e.qZA()()),2&o){const t=e.oxw();e.xp6(2),e.hij("Combat ",t.combat.id,""),e.xp6(2),e.xDo(" ",t.combat.player.playerName," ",t.combat.playerIsAi?"(AI)":""," v. ",t.combat.opponent.playerName," ",t.combat.opponentIsAi?"(AI)":""," - ",t.combat.ongoing?"Ongoing":"Over"," "),e.xp6(1),e.Q6J("ngIf",!t.combat.ongoing)}}const De=function(){return{"height.%":35}};function ki(o,n){if(1&o){const t=e.EpF();e.TgZ(0,"div",9)(1,"div",10)(2,"div",11),e._UZ(3,"app-combat-side-common-elements",12),e.qZA(),e._UZ(4,"hr")(5,"app-combat-common-elements",13)(6,"hr"),e.TgZ(7,"div",11),e._UZ(8,"app-combat-side-common-elements",14),e.qZA(),e.TgZ(9,"div",4)(10,"app-player-side-elements",15),e.NdJ("play",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.play(r))})("endTurn",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.endTurn())})("hover",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.hoverCard(r))}),e.qZA()()(),e._UZ(11,"div",16),e.TgZ(12,"div",17,18)(14,"app-combat-log",19),e.NdJ("highlight",function(r){e.CHM(t);const s=e.oxw();return e.KtG(s.hoverCharacter(r))}),e.qZA()()()}if(2&o){const t=e.oxw();e.xp6(2),e.Q6J("ngStyle",e.DdM(17,De)),e.xp6(1),e.Q6J("combat",t.combat)("side",t.combat.opponent)("isAi",t.combat.opponentIsAi)("highlightEnemies",t.enemyTargets)("highlightSource",t.source&&t.source.side===t.combat.player.side?void 0:null==t.source?null:t.source.name)("invert",!0),e.xp6(2),e.Q6J("combat",t.combat),e.xp6(2),e.Q6J("ngStyle",e.DdM(18,De)),e.xp6(1),e.Q6J("combat",t.combat)("side",t.combat.player)("isAi",t.combat.playerIsAi)("highlightAllies",t.allyTargets)("highlightSource",t.source&&t.source.side===t.combat.player.side?null==t.source?null:t.source.name:void 0),e.xp6(2),e.Q6J("combat",t.combat)("disabled",t.combat.currentSide!==t.combat.player.side||t.combat.over),e.xp6(4),e.Q6J("log",t.combat.log)}}const Ei=function(){return["..","selection"]};let Pi=(()=>{class o{constructor(t,i,r,s,a,l){this.identityService=t,this.signalrService=i,this.combatsService=r,this.activatedRoute=s,this.router=a,this.currentCombatService=l,this.scrollCombatLogRequested=!1,this.allyTargets=[],this.enemyTargets=[],this.CombatSide=h.E1}ngOnInit(){const t=this.identityService.getIdentity();this.signalrService.listen("combats","CombatUpdated",h.LS.fromJS).subscribe(i=>this.setCombat(i)),this.signalrService.listen("combats","CombatEnded",h.LS.fromJS).subscribe(i=>this.setCombat(i)),this.activatedRoute.paramMap.pipe((0,Z.w)(i=>{const r=i.get("id");return null==r?(this.router.to404().then(),(0,$.of)(void 0)):this.combatsService.getCombat(r,t)}),(0,M.K)(i=>(console.error(i),(0,D.D)(this.router.to404().then(r=>{})))),(0,xn.h)(Boolean),(0,P.U)(i=>this.setCombat(i))).subscribe()}play(t){if(!this.combat||this.combat.currentSide!==this.combat.player.side)return;const i=this.combat.player.hand[t];!i||i.card.apCost>this.combat.player.ap||this.combatsService.playCard(this.combat.id,t,this.identityService.getIdentity()).subscribe()}endTurn(){!this.combat||this.combat.currentSide!==this.combat.player.side||this.combatsService.endTurn(this.combat.id,this.identityService.getIdentity()).subscribe()}hoverCard(t){if(this.source=void 0,this.allyTargets=[],this.enemyTargets=[],t&&this.combat){switch(this.source={name:t.character,side:this.combat.player.side},Se.getAllyTargets(t.card.target,t.character===this.combat.player.frontCharacter?.character.identity.name?"front":"back")){case"none":break;case"front":this.combat.player.frontCharacter&&this.allyTargets.push(this.combat.player.frontCharacter.character.identity.name);break;case"back":this.combat.player.backCharacter&&this.allyTargets.push(this.combat.player.backCharacter.character.identity.name);break;case"both":this.combat.player.frontCharacter&&this.allyTargets.push(this.combat.player.frontCharacter.character.identity.name),this.combat.player.backCharacter&&this.allyTargets.push(this.combat.player.backCharacter.character.identity.name)}switch(Se.getEnemyTargets(t.card.target)){case"none":break;case"front":this.combat.opponent.frontCharacter&&this.enemyTargets.push(this.combat.opponent.frontCharacter.character.identity.name);break;case"back":this.combat.opponent.backCharacter&&this.enemyTargets.push(this.combat.opponent.backCharacter.character.identity.name);break;case"both":this.combat.opponent.frontCharacter&&this.enemyTargets.push(this.combat.opponent.frontCharacter.character.identity.name),this.combat.opponent.backCharacter&&this.enemyTargets.push(this.combat.opponent.backCharacter.character.identity.name)}}}hoverCharacter(t){this.source=t}ngAfterViewChecked(){this.scrollCombatLogRequested&&(this.combatLogElementRef&&this.scrollToBottom(this.combatLogElementRef),this.scrollCombatLogRequested=!1)}setCombat(t){this.combat=t,this.currentCombatService.set(t),this.scrollCombatLogRequested=!0}scrollToBottom(t){try{t.nativeElement.scrollTop=t.nativeElement.scrollHeight}catch{}}static#e=this.\u0275fac=function(i){return new(i||o)(e.Y36(R.P),e.Y36(xe),e.Y36(h.cP),e.Y36(w.gz),e.Y36(w.F0),e.Y36(U))};static#t=this.\u0275cmp=e.Xpm({type:o,selectors:[["app-combat"]],viewQuery:function(i,r){if(1&i&&e.Gf(Si,5),2&i){let s;e.iGM(s=e.CRH())&&(r.combatLogElementRef=s.first)}},features:[e._Bn([U])],decls:8,vars:4,consts:[[1,"h-100","w-100","vstack"],[1,"px-2","py-2","border-bottom","hstack","gap-2"],[1,"btn","btn-outline-secondary",3,"routerLink"],[1,"bi","bi-arrow-left"],[1,"flex-fill"],["class","small flex-grow-0 flex-shrink-1 vstack align-items-end",4,"ngIf"],["class","w-100 hstack overflow-auto",4,"ngIf"],[1,"small","flex-grow-0","flex-shrink-1","vstack","align-items-end"],[4,"ngIf"],[1,"w-100","hstack","overflow-auto"],[1,"flex-fill","vstack"],[3,"ngStyle"],[3,"combat","side","isAi","highlightEnemies","highlightSource","invert"],[3,"combat"],[3,"combat","side","isAi","highlightAllies","highlightSource"],[3,"combat","disabled","play","endTurn","hover"],[1,"vr"],[1,"h-100","w-25","overflow-auto"],["combatLog",""],[3,"log","highlight"]],template:function(i,r){1&i&&(e.TgZ(0,"div",0)(1,"header",1)(2,"button",2),e._UZ(3,"i",3),e._uU(4," Combats "),e.qZA(),e._UZ(5,"div",4),e.YNc(6,Ii,6,7,"div",5),e.qZA(),e.YNc(7,ki,15,19,"div",6),e.qZA()),2&i&&(e.xp6(2),e.Q6J("routerLink",e.DdM(3,Ei)),e.xp6(4),e.Q6J("ngIf",r.combat),e.xp6(1),e.Q6J("ngIf",r.combat))},dependencies:[u.O5,u.PC,w.rH,go,So,Eo,wi],encapsulation:2})}return o})();w.F0.prototype.toCombat=function(o){return this.navigate(["/","combat",o])};const Zi=[{path:"",pathMatch:"full",redirectTo:"selection"},{path:"configure/:id",component:V},{path:"join/:id",component:sn},{path:"selection",component:yn},{path:":id",component:Pi}];let Ai=(()=>{class o{static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275mod=e.oAB({type:o});static#n=this.\u0275inj=e.cJS({imports:[w.Bz.forChild(Zi),w.Bz]})}return o})(),Ni=(()=>{class o{static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275mod=e.oAB({type:o});static#n=this.\u0275inj=e.cJS({imports:[u.ez]})}return o})(),Oi=(()=>{class o{static#e=this.\u0275fac=function(i){return new(i||o)};static#t=this.\u0275mod=e.oAB({type:o});static#n=this.\u0275inj=e.cJS({imports:[u.ez,ie.I,Ai,E.u5,ie.I,T.xm,Ni]})}return o})()},8656:()=>{String.prototype.trimEndChars=function(...oe){let k=this.length-1;for(;k>=0&&oe.includes(this[k]);)k++;return this.substring(k)}}}]);